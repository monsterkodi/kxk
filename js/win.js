/*
000   000  000  000   000  
000 0 000  000  0000  000  
000000000  000  000 0 000  
000   000  000  000  0000  
00     00  000  000   000  
*/
var $, Win, _, elem, empty, fs, keyinfo, log, popup, pos, post, prefs, scheme, slash, stopEvent, str, title, valid;

({post, keyinfo, title, scheme, stopEvent, prefs, slash, elem, empty, valid, popup, pos, str, fs, log, $, _} = require('./kxk'));

Win = class Win {
  constructor(opt) {
    var electron, onLoad, onShow;
    
    // 00     00  00000000  000   000  000   000   0000000    0000000  000000000  000   0000000   000   000  
    // 000   000  000       0000  000  000   000  000   000  000          000     000  000   000  0000  000  
    // 000000000  0000000   000 0 000  000   000  000000000  000          000     000  000   000  000 0 000  
    // 000 0 000  000       000  0000  000   000  000   000  000          000     000  000   000  000  0000  
    // 000   000  00000000  000   000   0000000   000   000   0000000     000     000   0000000   000   000  
    this.onMenuAction = this.onMenuAction.bind(this);
    //  0000000   0000000   000   000  000000000  00000000  000   000  000000000  
    // 000       000   000  0000  000     000     000        000 000      000     
    // 000       000   000  000 0 000     000     0000000     00000       000     
    // 000       000   000  000  0000     000     000        000 000      000     
    //  0000000   0000000   000   000     000     00000000  000   000     000     
    this.onContextMenu = this.onContextMenu.bind(this);
    
    // 000   000  00000000  000   000
    // 000  000   000        000 000
    // 0000000    0000000     00000
    // 000  000   000          000
    // 000   000  00000000     000
    this.onKeyDown = this.onKeyDown.bind(this);
    this.onKeyUp = this.onKeyUp.bind(this);
    this.opt = opt;
    window.onerror = function(msg, source, line, col, err) {
      var srcmap;
      srcmap = require('./srcmap');
      srcmap.logErr(err);
      return true;
    };
    prefs.init();
    if (this.opt.icon) {
      log.slog.icon = slash.fileUrl(slash.join(this.opt.dir, this.opt.icon));
    }
    electron = require('electron');
    this.win = window.win = electron.remote.getCurrentWindow();
    this.id = window.winID = this.win.id;
    this.modifiers = '';
    this.userData = slash.userData();
    post.on('menuAction', this.onMenuAction);
    window.titlebar = new title(this.opt);
    document.body.addEventListener('contextmenu', this.onContextMenu);
    if (!this.opt.nokeys) {
      document.addEventListener('keydown', this.onKeyDown);
      document.addEventListener('keyup', this.onKeyUp);
    }
    if (this.opt.scheme !== false) {
      scheme.set(prefs.get('scheme', 'dark'));
    }
    if (_.isFunction(this.opt.onShow)) {
      onShow = () => {
        this.opt.onShow();
        return this.win.removeListener('ready-to-show', onShow);
      };
      this.win.on('ready-to-show', onShow);
    }
    if (_.isFunction(this.opt.onLoad)) {
      onLoad = () => {
        this.opt.onLoad();
        return this.win.webContents.removeListener('did-finish-load', onLoad);
      };
      this.win.webContents.on('did-finish-load', onLoad);
    }
  }

  
  // 0000000   0000000  00000000   00000000  00000000  000   000   0000000  000   000   0000000   000000000
  //000       000       000   000  000       000       0000  000  000       000   000  000   000     000
  //0000000   000       0000000    0000000   0000000   000 0 000  0000000   000000000  000   000     000
  //     000  000       000   000  000       000       000  0000       000  000   000  000   000     000
  //0000000    0000000  000   000  00000000  00000000  000   000  0000000   000   000   0000000      000
  screenshot() {
    return this.win.capturePage((img) => {
      var file;
      file = slash.resolve(`~/Desktop/${this.opt.pkg.name}-screenshot.png`);
      return fs.writeFile(file, img.toPNG(), function(err) {
        if (valid(err)) {
          return log('saving screenshot failed', err);
        } else {
          return log(`screenshot saved to ${file}`);
        }
      });
    });
  }

  onMenuAction(action, args) {
    switch (action) {
      case 'Screenshot':
        return this.screenshot();
      case 'About':
        return post.toMain('showAbout');
      case 'Save':
        return post.toMain('saveBuffer');
      case 'Quit':
        return post.toMain('quitApp');
    }
  }

  onContextMenu(event) {
    var absPos, items;
    this.win.focus();
    absPos = pos(event);
    if (absPos == null) {
      absPos = pos($("#main").getBoundingClientRect().left, $("#main").getBoundingClientRect().top);
    }
    items = _.clone(window.titlebar.menuTemplate());
    if (_.isFunction(this.opt.context)) {
      items = this.opt.context(items);
      if (empty(items)) {
        return;
      }
    } else {
      items.unshift({
        text: 'Clear',
        accel: 'cmdctrl+k'
      });
    }
    return popup.menu({
      items: items,
      x: absPos.x,
      y: absPos.y,
      onClose: function() {
        return post.emit('contextClosed');
      }
    });
  }

  onKeyDown(event) {
    var info;
    if ('unhandled' !== window.titlebar.handleKey(event, true)) {
      return stopEvent(event);
    }
    info = keyinfo.forEvent(event);
    this.modifiers = info.mod;
    
    // if info.combo
    info.event = event;
    return post.emit('combo', info.combo, info);
  }

  onKeyUp(event) {
    var info;
    info = keyinfo.forEvent(event);
    return this.modifiers = info.mod;
  }

};

module.exports = Win;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIi4uL2NvZmZlZS93aW4uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBQUEsSUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLFNBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBOztBQVFBLENBQUEsQ0FBRSxJQUFGLEVBQVEsT0FBUixFQUFpQixLQUFqQixFQUF3QixNQUF4QixFQUFnQyxTQUFoQyxFQUEyQyxLQUEzQyxFQUFrRCxLQUFsRCxFQUF5RCxJQUF6RCxFQUErRCxLQUEvRCxFQUFzRSxLQUF0RSxFQUE2RSxLQUE3RSxFQUFvRixHQUFwRixFQUF5RixHQUF6RixFQUE4RixFQUE5RixFQUFrRyxHQUFsRyxFQUF1RyxDQUF2RyxFQUEwRyxDQUExRyxDQUFBLEdBQWdILE9BQUEsQ0FBUSxPQUFSLENBQWhIOztBQUVNLE1BQU4sTUFBQSxJQUFBO0VBRUksV0FBYSxJQUFBLENBQUE7QUFFVCxRQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQTs7Ozs7OztRQStESixDQUFBLG1CQUFBLENBQUEsd0JBL0RJOzs7Ozs7UUE2RUosQ0FBQSxvQkFBQSxDQUFBLHlCQTdFSTs7Ozs7OztRQTBHSixDQUFBLGdCQUFBLENBQUE7UUFZQSxDQUFBLGNBQUEsQ0FBQTtJQXhIYyxJQUFDLENBQUE7SUFFWCxNQUFNLENBQUMsT0FBUCxHQUFpQixRQUFBLENBQUMsR0FBRCxFQUFNLE1BQU4sRUFBYyxJQUFkLEVBQW9CLEdBQXBCLEVBQXlCLEdBQXpCLENBQUE7QUFFYixVQUFBO01BQUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSO01BQ1QsTUFBTSxDQUFDLE1BQVAsQ0FB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LEtBQUEsRUFBTTtNQUFwQixDQUFkLEVBTEo7O1dBT0EsS0FBSyxDQUFDLElBQU4sQ0FDSTtNQUFBLEtBQUEsRUFBUyxLQUFUO01BQ0EsQ0FBQSxFQUFTLE1BQU0sQ0FBQyxDQURoQjtNQUVBLENBQUEsRUFBUyxNQUFNLENBQUMsQ0FGaEI7TUFHQSxPQUFBLEVBQVMsUUFBQSxDQUFBLENBQUE7ZUFBRyxJQUFJLENBQUMsSUFBTCxDQUFVLGVBQVY7TUFBSDtJQUhULENBREo7RUFqQlc7O0VBNkJmLFNBQVcsQ0FBQyxLQUFELENBQUE7QUFFUCxRQUFBO0lBQUEsSUFBMkIsV0FBQSxLQUFlLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBaEIsQ0FBMEIsS0FBMUIsRUFBaUMsSUFBakMsQ0FBMUM7QUFBQSxhQUFPLFNBQUEsQ0FBVSxLQUFWLEVBQVA7O0lBRUEsSUFBQSxHQUFPLE9BQU8sQ0FBQyxRQUFSLENBQWlCLEtBQWpCO0lBRVAsSUFBQyxDQUFBLFNBQUQsR0FBYSxJQUFJLENBQUMsSUFKbEI7OztJQU9BLElBQUksQ0FBQyxLQUFMLEdBQWE7V0FDYixJQUFJLENBQUMsSUFBTCxDQUFVLE9BQVYsRUFBbUIsSUFBSSxDQUFDLEtBQXhCLEVBQStCLElBQS9CO0VBVk87O0VBWVgsT0FBUyxDQUFDLEtBQUQsQ0FBQTtBQUVMLFFBQUE7SUFBQSxJQUFBLEdBQU8sT0FBTyxDQUFDLFFBQVIsQ0FBaUIsS0FBakI7V0FDUCxJQUFDLENBQUEsU0FBRCxHQUFhLElBQUksQ0FBQztFQUhiOztBQTFIYjs7QUErSEEsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIFxuMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMCAgXG4wMDAwMDAwMDAgIDAwMCAgMDAwIDAgMDAwICBcbjAwMCAgIDAwMCAgMDAwICAwMDAgIDAwMDAgIFxuMDAgICAgIDAwICAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyBwb3N0LCBrZXlpbmZvLCB0aXRsZSwgc2NoZW1lLCBzdG9wRXZlbnQsIHByZWZzLCBzbGFzaCwgZWxlbSwgZW1wdHksIHZhbGlkLCBwb3B1cCwgcG9zLCBzdHIsIGZzLCBsb2csICQsIF8gfSA9IHJlcXVpcmUgJy4va3hrJ1xuXG5jbGFzcyBXaW5cbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKEBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICB3aW5kb3cub25lcnJvciA9IChtc2csIHNvdXJjZSwgbGluZSwgY29sLCBlcnIpIC0+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHNyY21hcCA9IHJlcXVpcmUgJy4vc3JjbWFwJ1xuICAgICAgICAgICAgc3JjbWFwLmxvZ0VyciBlcnJcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgXG4gICAgICAgIHByZWZzLmluaXQoKVxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5pY29uXG4gICAgICAgICAgICBsb2cuc2xvZy5pY29uID0gc2xhc2guZmlsZVVybCBzbGFzaC5qb2luIEBvcHQuZGlyLCBAb3B0Lmljb25cbiAgICAgICAgXG4gICAgICAgIGVsZWN0cm9uID0gcmVxdWlyZSAnZWxlY3Ryb24nXG4gICAgICAgIFxuICAgICAgICBAd2luID0gd2luZG93LndpbiA9IGVsZWN0cm9uLnJlbW90ZS5nZXRDdXJyZW50V2luZG93KClcbiAgICAgICAgQGlkICA9IHdpbmRvdy53aW5JRCA9IEB3aW4uaWRcbiAgICAgICAgXG4gICAgICAgIEBtb2RpZmllcnMgPSAnJ1xuXG4gICAgICAgIEB1c2VyRGF0YSA9IHNsYXNoLnVzZXJEYXRhKClcbiAgICAgICAgXG4gICAgICAgIHBvc3Qub24gJ21lbnVBY3Rpb24nLCBAb25NZW51QWN0aW9uXG4gICAgICAgIFxuICAgICAgICB3aW5kb3cudGl0bGViYXIgPSBuZXcgdGl0bGUgQG9wdFxuICAgICAgICBcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyICdjb250ZXh0bWVudScsIEBvbkNvbnRleHRNZW51XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgQG9wdC5ub2tleXNcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJ2tleWRvd24nLCBAb25LZXlEb3duXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdrZXl1cCcsICAgQG9uS2V5VXBcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuc2NoZW1lICE9IGZhbHNlXG4gICAgICAgICAgICBzY2hlbWUuc2V0IHByZWZzLmdldCAnc2NoZW1lJywgJ2RhcmsnXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgXy5pc0Z1bmN0aW9uIEBvcHQub25TaG93XG4gICAgICAgICAgICBvblNob3cgPSA9PiBAb3B0Lm9uU2hvdygpOyBAd2luLnJlbW92ZUxpc3RlbmVyICdyZWFkeS10by1zaG93Jywgb25TaG93XG4gICAgICAgICAgICBAd2luLm9uICdyZWFkeS10by1zaG93Jywgb25TaG93XG5cbiAgICAgICAgaWYgXy5pc0Z1bmN0aW9uIEBvcHQub25Mb2FkXG4gICAgICAgICAgICBvbkxvYWQgPSA9PiBAb3B0Lm9uTG9hZCgpOyBAd2luLndlYkNvbnRlbnRzLnJlbW92ZUxpc3RlbmVyICdkaWQtZmluaXNoLWxvYWQnLCBvbkxvYWRcbiAgICAgICAgICAgIEB3aW4ud2ViQ29udGVudHMub24gJ2RpZC1maW5pc2gtbG9hZCcsIG9uTG9hZFxuICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIyAgICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgIDAwMFxuICAgIFxuICAgIHNjcmVlbnNob3Q6IC0+XG4gICAgXG4gICAgICAgIEB3aW4uY2FwdHVyZVBhZ2UgKGltZykgPT5cbiAgICAgICAgICAgIGZpbGUgPSBzbGFzaC5yZXNvbHZlIFwifi9EZXNrdG9wLyN7QG9wdC5wa2cubmFtZX0tc2NyZWVuc2hvdC5wbmdcIlxuICAgICAgICAgICAgZnMud3JpdGVGaWxlIGZpbGUsIGltZy50b1BORygpLCAoZXJyKSAtPlxuICAgICAgICAgICAgICAgIGlmIHZhbGlkIGVyclxuICAgICAgICAgICAgICAgICAgICBsb2cgJ3NhdmluZyBzY3JlZW5zaG90IGZhaWxlZCcsIGVyclxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgbG9nIFwic2NyZWVuc2hvdCBzYXZlZCB0byAje2ZpbGV9XCJcbiAgICAgICAgICAgIFxuICAgICMgMDAgICAgIDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiAgICBcbiAgICBvbk1lbnVBY3Rpb246IChhY3Rpb24sIGFyZ3MpID0+XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggYWN0aW9uXG4gICAgICAgICAgICB3aGVuICdTY3JlZW5zaG90JyB0aGVuIEBzY3JlZW5zaG90KClcbiAgICAgICAgICAgIHdoZW4gJ0Fib3V0JyAgICAgIHRoZW4gcG9zdC50b01haW4gJ3Nob3dBYm91dCdcbiAgICAgICAgICAgIHdoZW4gJ1NhdmUnICAgICAgIHRoZW4gcG9zdC50b01haW4gJ3NhdmVCdWZmZXInXG4gICAgICAgICAgICB3aGVuICdRdWl0JyAgICAgICB0aGVuIHBvc3QudG9NYWluICdxdWl0QXBwJ1xuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICAgIDAwMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIG9uQ29udGV4dE1lbnU6IChldmVudCkgPT5cblxuICAgICAgICBAd2luLmZvY3VzKClcbiAgICAgICAgXG4gICAgICAgIGFic1BvcyA9IHBvcyBldmVudFxuICAgICAgICBpZiBub3QgYWJzUG9zP1xuICAgICAgICAgICAgYWJzUG9zID0gcG9zICQoXCIjbWFpblwiKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LCAkKFwiI21haW5cIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgIFxuICAgICAgICBpdGVtcyA9IF8uY2xvbmUgd2luZG93LnRpdGxlYmFyLm1lbnVUZW1wbGF0ZSgpXG4gICAgICAgIFxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5jb250ZXh0XG4gICAgICAgICAgICBpdGVtcyA9IEBvcHQuY29udGV4dCBpdGVtc1xuICAgICAgICAgICAgaWYgZW1wdHkgaXRlbXMgXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGl0ZW1zLnVuc2hpZnQgdGV4dDonQ2xlYXInLCBhY2NlbDonY21kY3RybCtrJ1xuICAgICAgICAgICAgXG4gICAgICAgIHBvcHVwLm1lbnVcbiAgICAgICAgICAgIGl0ZW1zOiAgIGl0ZW1zXG4gICAgICAgICAgICB4OiAgICAgICBhYnNQb3MueFxuICAgICAgICAgICAgeTogICAgICAgYWJzUG9zLnlcbiAgICAgICAgICAgIG9uQ2xvc2U6IC0+IHBvc3QuZW1pdCAnY29udGV4dENsb3NlZCdcbiAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwXG4gICAgXG4gICAgb25LZXlEb3duOiAoZXZlbnQpID0+XG4gICAgXG4gICAgICAgIHJldHVybiBzdG9wRXZlbnQoZXZlbnQpIGlmICd1bmhhbmRsZWQnICE9IHdpbmRvdy50aXRsZWJhci5oYW5kbGVLZXkgZXZlbnQsIHRydWVcbiAgICAgICAgXG4gICAgICAgIGluZm8gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgXG4gICAgICAgIEBtb2RpZmllcnMgPSBpbmZvLm1vZFxuICAgICAgICBcbiAgICAgICAgIyBpZiBpbmZvLmNvbWJvXG4gICAgICAgIGluZm8uZXZlbnQgPSBldmVudFxuICAgICAgICBwb3N0LmVtaXQgJ2NvbWJvJywgaW5mby5jb21ibywgaW5mb1xuICAgIFxuICAgIG9uS2V5VXA6IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIGluZm8gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgICAgIEBtb2RpZmllcnMgPSBpbmZvLm1vZCBcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFdpblxuIl19
//# sourceURL=../coffee/win.coffee