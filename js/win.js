// koffee 1.14.0

/*
000   000  000  000   000  
000 0 000  000  0000  000  
000000000  000  000 0 000  
000   000  000  000  0000  
00     00  000  000   000
 */
var $, Win, _, args, empty, fs, keyinfo, klog, kpos, open, popup, post, prefs, ref, scheme, slash, srcmap, stopEvent, title, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('./kxk'), $ = ref.$, _ = ref._, args = ref.args, empty = ref.empty, fs = ref.fs, keyinfo = ref.keyinfo, klog = ref.klog, kpos = ref.kpos, open = ref.open, popup = ref.popup, post = ref.post, prefs = ref.prefs, scheme = ref.scheme, slash = ref.slash, srcmap = ref.srcmap, stopEvent = ref.stopEvent, title = ref.title, valid = ref.valid;

Win = (function() {
    function Win(opt) {
        var base, onLoad, onShow, ref1, sep;
        this.opt = opt;
        this.onKeyUp = bind(this.onKeyUp, this);
        this.onKeyDown = bind(this.onKeyDown, this);
        this.onContextMenu = bind(this.onContextMenu, this);
        this.onMenuAction = bind(this.onMenuAction, this);
        window.onerror = function(msg, source, line, col, err) {
            console.error('window.onerror', msg, source, line, col);
            srcmap.logErr(err);
            return true;
        };
        sep = (ref1 = this.opt.prefsSeperator) != null ? ref1 : 'â–¸';
        prefs.init({
            separator: sep
        });
        if (this.opt.icon) {
            klog.slog.icon = slash.fileUrl(slash.join(this.opt.dir, this.opt.icon));
        }
        this.id = window.winID = post.get('winID');
        this.modifiers = '';
        this.userData = post.get('userData');
        klog('kxk.Win id', this.id, 'userData', this.userData);
        post.on('menuAction', this.onMenuAction);
        if ((base = this.opt).title != null) {
            base.title;
        } else {
            base.title = process.argv[0].endsWith('Electron Helper') && ['version'] || [];
        }
        window.titlebar = new title(this.opt);
        if (this.opt.context !== false) {
            document.body.addEventListener('contextmenu', this.onContextMenu);
        }
        if (!this.opt.nokeys) {
            document.addEventListener('keydown', this.onKeyDown);
            document.addEventListener('keyup', this.onKeyUp);
        }
        if (this.opt.scheme !== false) {
            scheme.set(prefs.get('scheme', 'dark'));
        }
        if (_.isFunction(this.opt.onShow)) {
            onShow = (function(_this) {
                return function() {
                    _this.opt.onShow();
                    return _this.win.removeListener('ready-to-show', onShow);
                };
            })(this);
            this.win.on('ready-to-show', onShow);
        }
        if (_.isFunction(this.opt.onLoad)) {
            onLoad = (function(_this) {
                return function() {
                    _this.opt.onLoad();
                    return _this.win.webContents.removeListener('did-finish-load', onLoad);
                };
            })(this);
            this.win.webContents.on('did-finish-load', onLoad);
        }
    }

    Win.prototype.screenshot = function() {
        return this.win.webContents.capturePage().then((function(_this) {
            return function(img) {
                var file;
                file = slash.unused("~/Desktop/" + _this.opt.pkg.name + ".png");
                return fs.writeFile(file, img.toPNG(), function(err) {
                    if (valid(err)) {
                        return klog('saving screenshot failed', err);
                    } else {
                        return klog("screenshot saved to " + file);
                    }
                });
            };
        })(this));
    };

    Win.prototype.onMenuAction = function(action, args) {
        switch (action) {
            case 'Screenshot':
                return this.screenshot();
            case 'Preferences':
                return open(prefs.store.file);
            case 'Fullscreen':
                return this.win.setFullScreen(!this.win.isFullScreen());
            case 'About':
                return post.toMain('showAbout');
            case 'Quit':
                return post.toMain('quitApp');
        }
        post.toMain('menuAction', action, args);
        return 'unhandled';
    };

    Win.prototype.onContextMenu = function(event) {
        var absPos, items;
        this.win.focus();
        absPos = kpos(event);
        if (absPos == null) {
            absPos = kpos($("#main").getBoundingClientRect().left, $("#main").getBoundingClientRect().top);
        }
        items = _.clone(window.titlebar.menuTemplate());
        if (_.isFunction(this.opt.context)) {
            items = this.opt.context(items);
            if (empty(items)) {
                return;
            }
        } else {
            items.unshift({
                text: 'Clear',
                accel: 'cmdctrl+k'
            });
        }
        return popup.menu({
            items: items,
            x: absPos.x,
            y: absPos.y,
            onClose: function() {
                return post.emit('contextClosed');
            }
        });
    };

    Win.prototype.onKeyDown = function(event) {
        var info;
        if ('unhandled' !== window.titlebar.handleKey(event, true)) {
            return stopEvent(event);
        }
        info = keyinfo.forEvent(event);
        this.modifiers = info.mod;
        info.event = event;
        return post.emit('combo', info.combo, info);
    };

    Win.prototype.onKeyUp = function(event) {
        var info;
        info = keyinfo.forEvent(event);
        return this.modifiers = info.mod;
    };

    return Win;

})();

module.exports = Win;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luLmpzIiwic291cmNlUm9vdCI6Ii4uL2NvZmZlZSIsInNvdXJjZXMiOlsid2luLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSw4SEFBQTtJQUFBOztBQVFBLE1BQTJILE9BQUEsQ0FBUSxPQUFSLENBQTNILEVBQUUsU0FBRixFQUFLLFNBQUwsRUFBUSxlQUFSLEVBQWMsaUJBQWQsRUFBcUIsV0FBckIsRUFBeUIscUJBQXpCLEVBQWtDLGVBQWxDLEVBQXdDLGVBQXhDLEVBQThDLGVBQTlDLEVBQW9ELGlCQUFwRCxFQUEyRCxlQUEzRCxFQUFpRSxpQkFBakUsRUFBd0UsbUJBQXhFLEVBQWdGLGlCQUFoRixFQUF1RixtQkFBdkYsRUFBK0YseUJBQS9GLEVBQTBHLGlCQUExRyxFQUFpSDs7QUFFM0c7SUFFQyxhQUFDLEdBQUQ7QUFFQyxZQUFBO1FBRkEsSUFBQyxDQUFBLE1BQUQ7Ozs7O1FBRUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxHQUFELEVBQU0sTUFBTixFQUFjLElBQWQsRUFBb0IsR0FBcEIsRUFBeUIsR0FBekI7WUFFZCxPQUFBLENBQUMsS0FBRCxDQUFPLGdCQUFQLEVBQXdCLEdBQXhCLEVBQTZCLE1BQTdCLEVBQXFDLElBQXJDLEVBQTJDLEdBQTNDO1lBQ0MsTUFBTSxDQUFDLE1BQVAsQ0FBYyxHQUFkO21CQUNBO1FBSmE7UUFNakIsR0FBQSxxREFBNEI7UUFDNUIsS0FBSyxDQUFDLElBQU4sQ0FBVztZQUFBLFNBQUEsRUFBVSxHQUFWO1NBQVg7UUFFQSxJQUFHLElBQUMsQ0FBQSxHQUFHLENBQUMsSUFBUjtZQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBVixHQUFpQixLQUFLLENBQUMsT0FBTixDQUFjLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxHQUFoQixFQUFxQixJQUFDLENBQUEsR0FBRyxDQUFDLElBQTFCLENBQWQsRUFEckI7O1FBR0EsSUFBQyxDQUFB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OlsiIyMjXG4wMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICBcbjAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAgIFxuMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgXG4wMDAgICAwMDAgIDAwMCAgMDAwICAwMDAwICBcbjAwICAgICAwMCAgMDAwICAwMDAgICAwMDAgIFxuIyMjXG5cbnsgJCwgXywgYXJncywgZW1wdHksIGZzLCBrZXlpbmZvLCBrbG9nLCBrcG9zLCBvcGVuLCBwb3B1cCwgcG9zdCwgcHJlZnMsIHNjaGVtZSwgc2xhc2gsIHNyY21hcCwgc3RvcEV2ZW50LCB0aXRsZSwgdmFsaWQgfSA9IHJlcXVpcmUgJy4va3hrJ1xuXG5jbGFzcyBXaW5cbiAgICBcbiAgICBAOiAoQG9wdCkgLT5cbiAgICAgICAgXG4gICAgICAgIHdpbmRvdy5vbmVycm9yID0gKG1zZywgc291cmNlLCBsaW5lLCBjb2wsIGVycikgLT5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZXJyb3IgJ3dpbmRvdy5vbmVycm9yJyBtc2csIHNvdXJjZSwgbGluZSwgY29sXG4gICAgICAgICAgICBzcmNtYXAubG9nRXJyIGVyclxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICBcbiAgICAgICAgc2VwID0gQG9wdC5wcmVmc1NlcGVyYXRvciA/ICfilrgnXG4gICAgICAgIHByZWZzLmluaXQgc2VwYXJhdG9yOnNlcFxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5pY29uXG4gICAgICAgICAgICBrbG9nLnNsb2cuaWNvbiA9IHNsYXNoLmZpbGVVcmwgc2xhc2guam9pbiBAb3B0LmRpciwgQG9wdC5pY29uXG4gICAgICAgICAgICAgICBcbiAgICAgICAgQGlkID0gd2luZG93LndpbklEID0gcG9zdC5nZXQgJ3dpbklEJ1xuICAgICAgICBcbiAgICAgICAgQG1vZGlmaWVycyA9ICcnXG5cbiAgICAgICAgQHVzZXJEYXRhID0gcG9zdC5nZXQgJ3VzZXJEYXRhJ1xuICAgICAgICBcbiAgICAgICAga2xvZyAna3hrLldpbiBpZCcgQGlkLCAndXNlckRhdGEnIEB1c2VyRGF0YVxuICAgICAgICBcbiAgICAgICAgcG9zdC5vbiAnbWVudUFjdGlvbicgQG9uTWVudUFjdGlvblxuICAgICAgICBcbiAgICAgICAgQG9wdC50aXRsZSA/PSBwcm9jZXNzLmFyZ3ZbMF0uZW5kc1dpdGgoJ0VsZWN0cm9uIEhlbHBlcicpIGFuZCBbJ3ZlcnNpb24nXSBvciBbXVxuICAgICAgICBcbiAgICAgICAgd2luZG93LnRpdGxlYmFyID0gbmV3IHRpdGxlIEBvcHRcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuY29udGV4dCAhPSBmYWxzZVxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyICdjb250ZXh0bWVudScgQG9uQ29udGV4dE1lbnVcbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBAb3B0Lm5va2V5c1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAna2V5ZG93bicgQG9uS2V5RG93blxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAna2V5dXAnICAgQG9uS2V5VXBcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuc2NoZW1lICE9IGZhbHNlXG4gICAgICAgICAgICBzY2hlbWUuc2V0IHByZWZzLmdldCAnc2NoZW1lJyAnZGFyaydcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5vblNob3dcbiAgICAgICAgICAgIG9uU2hvdyA9ID0+IEBvcHQub25TaG93KCk7IEB3aW4ucmVtb3ZlTGlzdGVuZXIgJ3JlYWR5LXRvLXNob3cnIG9uU2hvd1xuICAgICAgICAgICAgQHdpbi5vbiAncmVhZHktdG8tc2hvdycgb25TaG93XG4gICAgICAgICMgZWxzZVxuICAgICAgICAgICAgIyBAd2luLm9uICdyZWFkeS10by1zaG93JyA9PiBAd2luLnNob3coKVxuXG4gICAgICAgIGlmIF8uaXNGdW5jdGlvbiBAb3B0Lm9uTG9hZFxuICAgICAgICAgICAgb25Mb2FkID0gPT4gQG9wdC5vbkxvYWQoKTsgQHdpbi53ZWJDb250ZW50cy5yZW1vdmVMaXN0ZW5lciAnZGlkLWZpbmlzaC1sb2FkJyBvbkxvYWRcbiAgICAgICAgICAgIEB3aW4ud2ViQ29udGVudHMub24gJ2RpZC1maW5pc2gtbG9hZCcgb25Mb2FkXG4gICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjICAgICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgICAwMDBcbiAgICBcbiAgICBzY3JlZW5zaG90OiAtPlxuICAgICAgICBcbiAgICAgICAgQHdpbi53ZWJDb250ZW50cy5jYXB0dXJlUGFnZSgpLnRoZW4gKGltZykgPT5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZmlsZSA9IHNsYXNoLnVudXNlZCBcIn4vRGVza3RvcC8je0BvcHQucGtnLm5hbWV9LnBuZ1wiXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZSBmaWxlLCBpbWcudG9QTkcoKSwgKGVycikgLT5cbiAgICAgICAgICAgICAgICBpZiB2YWxpZCBlcnJcbiAgICAgICAgICAgICAgICAgICAga2xvZyAnc2F2aW5nIHNjcmVlbnNob3QgZmFpbGVkJyBlcnJcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgXCJzY3JlZW5zaG90IHNhdmVkIHRvICN7ZmlsZX1cIlxuICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuICAgIFxuICAgIG9uTWVudUFjdGlvbjogKGFjdGlvbiwgYXJncykgPT5cblxuICAgICAgICBzd2l0Y2ggYWN0aW9uXG4gICAgICAgICAgICB3aGVuICdTY3JlZW5zaG90JyAgdGhlbiByZXR1cm4gQHNjcmVlbnNob3QoKVxuICAgICAgICAgICAgd2hlbiAnUHJlZmVyZW5jZXMnIHRoZW4gcmV0dXJuIG9wZW4gcHJlZnMuc3RvcmUuZmlsZVxuICAgICAgICAgICAgd2hlbiAnRnVsbHNjcmVlbicgIHRoZW4gcmV0dXJuIEB3aW4uc2V0RnVsbFNjcmVlbiAhQHdpbi5pc0Z1bGxTY3JlZW4oKVxuICAgICAgICAgICAgd2hlbiAnQWJvdXQnICAgICAgIHRoZW4gcmV0dXJuIHBvc3QudG9NYWluICdzaG93QWJvdXQnXG4gICAgICAgICAgICB3aGVuICdRdWl0JyAgICAgICAgdGhlbiByZXR1cm4gcG9zdC50b01haW4gJ3F1aXRBcHAnXG4gICAgICAgICAgXG4gICAgICAgIHBvc3QudG9NYWluICdtZW51QWN0aW9uJyBhY3Rpb24sIGFyZ3MgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAndW5oYW5kbGVkJ1xuXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgIDAwMCAwMDAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICAgIDAwMDAwICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIG9uQ29udGV4dE1lbnU6IChldmVudCkgPT5cblxuICAgICAgICBAd2luLmZvY3VzKClcbiAgICAgICAgXG4gICAgICAgIGFic1BvcyA9IGtwb3MgZXZlbnRcbiAgICAgICAgaWYgbm90IGFic1Bvcz9cbiAgICAgICAgICAgIGFic1BvcyA9IGtwb3MgJChcIiNtYWluXCIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQsICQoXCIjbWFpblwiKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3BcbiAgICAgICAgXG4gICAgICAgIGl0ZW1zID0gXy5jbG9uZSB3aW5kb3cudGl0bGViYXIubWVudVRlbXBsYXRlKClcbiAgICAgICAgXG4gICAgICAgIGlmIF8uaXNGdW5jdGlvbiBAb3B0LmNvbnRleHRcbiAgICAgICAgICAgIGl0ZW1zID0gQG9wdC5jb250ZXh0IGl0ZW1zXG4gICAgICAgICAgICBpZiBlbXB0eSBpdGVtcyBcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaXRlbXMudW5zaGlmdCB0ZXh0OidDbGVhcicgYWNjZWw6J2NtZGN0cmwraydcbiAgICAgICAgXG4gICAgICAgIHBvcHVwLm1lbnVcbiAgICAgICAgICAgIGl0ZW1zOiAgIGl0ZW1zXG4gICAgICAgICAgICB4OiAgICAgICBhYnNQb3MueFxuICAgICAgICAgICAgeTogICAgICAgYWJzUG9zLnlcbiAgICAgICAgICAgIG9uQ2xvc2U6IC0+IHBvc3QuZW1pdCAnY29udGV4dENsb3NlZCdcbiAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwXG4gICAgXG4gICAgb25LZXlEb3duOiAoZXZlbnQpID0+XG4gICAgXG4gICAgICAgIHJldHVybiBzdG9wRXZlbnQoZXZlbnQpIGlmICd1bmhhbmRsZWQnICE9IHdpbmRvdy50aXRsZWJhci5oYW5kbGVLZXkgZXZlbnQsIHRydWVcbiAgICAgICAgXG4gICAgICAgIGluZm8gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgXG4gICAgICAgIEBtb2RpZmllcnMgPSBpbmZvLm1vZFxuICAgICAgICBcbiAgICAgICAgaW5mby5ldmVudCA9IGV2ZW50XG4gICAgICAgIHBvc3QuZW1pdCAnY29tYm8nIGluZm8uY29tYm8sIGluZm9cbiAgICBcbiAgICBvbktleVVwOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2QgXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBXaW5cbiJdfQ==
//# sourceURL=../coffee/win.coffee