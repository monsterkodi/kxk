/*
000   000  000  000   000  
000 0 000  000  0000  000  
000000000  000  000 0 000  
000   000  000  000  0000  
00     00  000  000   000  
*/
var $, Win, _, elem, empty, fs, keyinfo, log, popup, pos, post, prefs, scheme, slash, stopEvent, str, title, valid;

({post, keyinfo, title, scheme, stopEvent, prefs, slash, elem, empty, valid, popup, pos, str, fs, log, $, _} = require('./kxk'));

Win = class Win {
  constructor(opt) {
    var electron, onLoad, onShow;
    
    // 00     00  00000000  000   000  000   000   0000000    0000000  000000000  000   0000000   000   000  
    // 000   000  000       0000  000  000   000  000   000  000          000     000  000   000  0000  000  
    // 000000000  0000000   000 0 000  000   000  000000000  000          000     000  000   000  000 0 000  
    // 000 0 000  000       000  0000  000   000  000   000  000          000     000  000   000  000  0000  
    // 000   000  00000000  000   000   0000000   000   000   0000000     000     000   0000000   000   000  
    this.onMenuAction = this.onMenuAction.bind(this);
    //  0000000   0000000   000   000  000000000  00000000  000   000  000000000  
    // 000       000   000  0000  000     000     000        000 000      000     
    // 000       000   000  000 0 000     000     0000000     00000       000     
    // 000       000   000  000  0000     000     000        000 000      000     
    //  0000000   0000000   000   000     000     00000000  000   000     000     
    this.onContextMenu = this.onContextMenu.bind(this);
    
    // 000   000  00000000  000   000
    // 000  000   000        000 000
    // 0000000    0000000     00000
    // 000  000   000          000
    // 000   000  00000000     000
    this.onKeyDown = this.onKeyDown.bind(this);
    this.onKeyUp = this.onKeyUp.bind(this);
    this.opt = opt;
    window.onerror = function(msg, source, line, col, err) {
      var srcmap;
      srcmap = require('./srcmap');
      srcmap.logErr(err);
      return true;
    };
    prefs.init();
    if (this.opt.icon) {
      log.slog.icon = slash.fileUrl(slash.join(this.opt.dir, this.opt.icon));
    }
    electron = require('electron');
    this.win = window.win = electron.remote.getCurrentWindow();
    this.id = window.winID = this.win.id;
    this.modifiers = '';
    this.userData = slash.userData();
    post.on('menuAction', this.onMenuAction);
    window.titlebar = new title(this.opt);
    document.body.addEventListener('contextmenu', this.onContextMenu);
    if (!this.opt.nokeys) {
      document.addEventListener('keydown', this.onKeyDown);
      document.addEventListener('keyup', this.onKeyUp);
    }
    if (this.opt.scheme !== false) {
      scheme.set(prefs.get('scheme', 'dark'));
    }
    if (_.isFunction(this.opt.onShow)) {
      onShow = () => {
        this.opt.onShow();
        return this.win.removeListener('ready-to-show', onShow);
      };
      this.win.on('ready-to-show', onShow);
    }
    if (_.isFunction(this.opt.onLoad)) {
      onLoad = () => {
        this.opt.onLoad();
        return this.win.webContents.removeListener('did-finish-load', onLoad);
      };
      this.win.webContents.on('did-finish-load', onLoad);
    }
  }

  
  // 0000000   0000000  00000000   00000000  00000000  000   000   0000000  000   000   0000000   000000000
  //000       000       000   000  000       000       0000  000  000       000   000  000   000     000
  //0000000   000       0000000    0000000   0000000   000 0 000  0000000   000000000  000   000     000
  //     000  000       000   000  000       000       000  0000       000  000   000  000   000     000
  //0000000    0000000  000   000  00000000  00000000  000   000  0000000   000   000   0000000      000
  screenshot() {
    return this.win.capturePage((img) => {
      var file;
      file = slash.resolve(`~/Desktop/${this.opt.pkg.name}-screenshot.png`);
      return fs.writeFile(file, img.toPNG(), function(err) {
        if (valid(err)) {
          return log('saving screenshot failed', err);
        } else {
          return log(`screenshot saved to ${file}`);
        }
      });
    });
  }

  onMenuAction(action, args) {
    switch (action) {
      case 'Screenshot':
        return this.screenshot();
      case 'About':
        return post.toMain('showAbout');
      case 'Save':
        return post.toMain('saveBuffer');
      case 'Quit':
        return post.toMain('quitApp');
    }
  }

  onContextMenu(event) {
    var absPos, items;
    this.win.focus();
    absPos = pos(event);
    if (absPos == null) {
      absPos = pos($("#main").getBoundingClientRect().left, $("#main").getBoundingClientRect().top);
    }
    items = _.clone(window.titlebar.menuTemplate());
    if (_.isFunction(this.opt.context)) {
      items = this.opt.context(items);
    } else {
      items.unshift({
        text: 'Clear',
        accel: 'cmdctrl+k'
      });
    }
    return popup.menu({
      items: items,
      x: absPos.x,
      y: absPos.y,
      onClose: function() {
        return post.emit('contextClosed');
      }
    });
  }

  onKeyDown(event) {
    var info;
    if ('unhandled' !== window.titlebar.handleKey(event, true)) {
      return stopEvent(event);
    }
    info = keyinfo.forEvent(event);
    this.modifiers = info.mod;
    
    // if info.combo
    info.event = event;
    return post.emit('combo', info.combo, info);
  }

  onKeyUp(event) {
    var info;
    info = keyinfo.forEvent(event);
    return this.modifiers = info.mod;
  }

};

module.exports = Win;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIi4uL2NvZmZlZS93aW4uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBQUEsSUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLFNBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBOztBQVFBLENBQUEsQ0FBRSxJQUFGLEVBQVEsT0FBUixFQUFpQixLQUFqQixFQUF3QixNQUF4QixFQUFnQyxTQUFoQyxFQUEyQyxLQUEzQyxFQUFrRCxLQUFsRCxFQUF5RCxJQUF6RCxFQUErRCxLQUEvRCxFQUFzRSxLQUF0RSxFQUE2RSxLQUE3RSxFQUFvRixHQUFwRixFQUF5RixHQUF6RixFQUE4RixFQUE5RixFQUFrRyxHQUFsRyxFQUF1RyxDQUF2RyxFQUEwRyxDQUExRyxDQUFBLEdBQWdILE9BQUEsQ0FBUSxPQUFSLENBQWhIOztBQUVNLE1BQU4sTUFBQSxJQUFBO0VBRUksV0FBYSxJQUFBLENBQUE7QUFFVCxRQUFBLFFBQUEsRUFBQSxNQUFBLEVBQUEsTUFBQTs7Ozs7OztRQStESixDQUFBLG1CQUFBLENBQUEsd0JBL0RJOzs7Ozs7UUE2RUosQ0FBQSxvQkFBQSxDQUFBLHlCQTdFSTs7Ozs7OztRQXVHSixDQUFBLGdCQUFBLENBQUE7UUFZQSxDQUFBLGNBQUEsQ0FBQTtJQXJIYyxJQUFDLENBQUE7SUFFWCxNQUFNLENBQUMsT0FBUCxHQUFpQixRQUFBLENBQUMsR0FBRCxFQUFNLE1BQU4sRUFBYyxJQUFkLEVBQW9CLEdBQXBCLEVBQXlCLEdBQXpCLENBQUE7QUFFYixVQUFBO01BQUEsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSO01BQ1QsTUFBTSxDQUFDLE1BQVAsQ0FB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QUMsSUFBTixDQUNJO01BQUEsS0FBQSxFQUFTLEtBQVQ7TUFDQSxDQUFBLEVBQVMsTUFBTSxDQUFDLENBRGhCO01BRUEsQ0FBQSxFQUFTLE1BQU0sQ0FBQyxDQUZoQjtNQUdBLE9BQUEsRUFBUyxRQUFBLENBQUEsQ0FBQTtlQUFHLElBQUksQ0FBQyxJQUFMLENBQVUsZUFBVjtNQUFIO0lBSFQsQ0FESjtFQWRXOztFQTBCZixTQUFXLENBQUMsS0FBRCxDQUFBO0FBRVAsUUFBQTtJQUFBLElBQTJCLFdBQUEsS0FBZSxNQUFNLENBQUMsUUFBUSxDQUFDLFNBQWhCLENBQTBCLEtBQTFCLEVBQWlDLElBQWpDLENBQTFDO0FBQUEsYUFBTyxTQUFBLENBQVUsS0FBVixFQUFQOztJQUVBLElBQUEsR0FBTyxPQUFPLENBQUMsUUFBUixDQUFpQixLQUFqQjtJQUVQLElBQUMsQ0FBQSxTQUFELEdBQWEsSUFBSSxDQUFDLElBSmxCOzs7SUFPQSxJQUFJLENBQUMsS0FBTCxHQUFhO1dBQ2IsSUFBSSxDQUFDLElBQUwsQ0FBVSxPQUFWLEVBQW1CLElBQUksQ0FBQyxLQUF4QixFQUErQixJQUEvQjtFQVZPOztFQVlYLE9BQVMsQ0FBQyxLQUFELENBQUE7QUFFTCxRQUFBO0lBQUEsSUFBQSxHQUFPLE9BQU8sQ0FBQyxRQUFSLENBQWlCLEtBQWpCO1dBQ1AsSUFBQyxDQUFBLFNBQUQsR0FBYSxJQUFJLENBQUM7RUFIYjs7QUF2SGI7O0FBNEhBLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICBcbjAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAgIFxuMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgXG4wMDAgICAwMDAgIDAwMCAgMDAwICAwMDAwICBcbjAwICAgICAwMCAgMDAwICAwMDAgICAwMDAgIFxuIyMjXG5cbnsgcG9zdCwga2V5aW5mbywgdGl0bGUsIHNjaGVtZSwgc3RvcEV2ZW50LCBwcmVmcywgc2xhc2gsIGVsZW0sIGVtcHR5LCB2YWxpZCwgcG9wdXAsIHBvcywgc3RyLCBmcywgbG9nLCAkLCBfIH0gPSByZXF1aXJlICcuL2t4aydcblxuY2xhc3MgV2luXG4gICAgXG4gICAgY29uc3RydWN0b3I6IChAb3B0KSAtPlxuICAgICAgICBcbiAgICAgICAgd2luZG93Lm9uZXJyb3IgPSAobXNnLCBzb3VyY2UsIGxpbmUsIGNvbCwgZXJyKSAtPlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBzcmNtYXAgPSByZXF1aXJlICcuL3NyY21hcCdcbiAgICAgICAgICAgIHNyY21hcC5sb2dFcnIgZXJyXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICAgICBwcmVmcy5pbml0KClcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuaWNvblxuICAgICAgICAgICAgbG9nLnNsb2cuaWNvbiA9IHNsYXNoLmZpbGVVcmwgc2xhc2guam9pbiBAb3B0LmRpciwgQG9wdC5pY29uXG4gICAgICAgIFxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBcbiAgICAgICAgQHdpbiA9IHdpbmRvdy53aW4gPSBlbGVjdHJvbi5yZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpXG4gICAgICAgIEBpZCAgPSB3aW5kb3cud2luSUQgPSBAd2luLmlkXG4gICAgICAgIFxuICAgICAgICBAbW9kaWZpZXJzID0gJydcblxuICAgICAgICBAdXNlckRhdGEgPSBzbGFzaC51c2VyRGF0YSgpXG4gICAgICAgIFxuICAgICAgICBwb3N0Lm9uICdtZW51QWN0aW9uJywgQG9uTWVudUFjdGlvblxuICAgICAgICBcbiAgICAgICAgd2luZG93LnRpdGxlYmFyID0gbmV3IHRpdGxlIEBvcHRcbiAgICAgICAgXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lciAnY29udGV4dG1lbnUnLCBAb25Db250ZXh0TWVudVxuICAgICAgICBcbiAgICAgICAgaWYgbm90IEBvcHQubm9rZXlzXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdrZXlkb3duJywgQG9uS2V5RG93blxuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAna2V5dXAnLCAgIEBvbktleVVwXG4gICAgICAgIFxuICAgICAgICBpZiBAb3B0LnNjaGVtZSAhPSBmYWxzZVxuICAgICAgICAgICAgc2NoZW1lLnNldCBwcmVmcy5nZXQgJ3NjaGVtZScsICdkYXJrJ1xuICAgICAgICAgICAgXG4gICAgICAgIGlmIF8uaXNGdW5jdGlvbiBAb3B0Lm9uU2hvd1xuICAgICAgICAgICAgb25TaG93ID0gPT4gQG9wdC5vblNob3coKTsgQHdpbi5yZW1vdmVMaXN0ZW5lciAncmVhZHktdG8tc2hvdycsIG9uU2hvd1xuICAgICAgICAgICAgQHdpbi5vbiAncmVhZHktdG8tc2hvdycsIG9uU2hvd1xuXG4gICAgICAgIGlmIF8uaXNGdW5jdGlvbiBAb3B0Lm9uTG9hZFxuICAgICAgICAgICAgb25Mb2FkID0gPT4gQG9wdC5vbkxvYWQoKTsgQHdpbi53ZWJDb250ZW50cy5yZW1vdmVMaXN0ZW5lciAnZGlkLWZpbmlzaC1sb2FkJywgb25Mb2FkXG4gICAgICAgICAgICBAd2luLndlYkNvbnRlbnRzLm9uICdkaWQtZmluaXNoLWxvYWQnLCBvbkxvYWRcbiAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAwXG4gICAgIzAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIzAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgICAwMDBcbiAgICBcbiAgICBzY3JlZW5zaG90OiAtPlxuICAgIFxuICAgICAgICBAd2luLmNhcHR1cmVQYWdlIChpbWcpID0+XG4gICAgICAgICAgICBmaWxlID0gc2xhc2gucmVzb2x2ZSBcIn4vRGVza3RvcC8je0BvcHQucGtnLm5hbWV9LXNjcmVlbnNob3QucG5nXCJcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZSBmaWxlLCBpbWcudG9QTkcoKSwgKGVycikgLT5cbiAgICAgICAgICAgICAgICBpZiB2YWxpZCBlcnJcbiAgICAgICAgICAgICAgICAgICAgbG9nICdzYXZpbmcgc2NyZWVuc2hvdCBmYWlsZWQnLCBlcnJcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGxvZyBcInNjcmVlbnNob3Qgc2F2ZWQgdG8gI3tmaWxlfVwiXG4gICAgICAgICAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgb25NZW51QWN0aW9uOiAoYWN0aW9uLCBhcmdzKSA9PlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgd2hlbiAnU2NyZWVuc2hvdCcgdGhlbiBAc2NyZWVuc2hvdCgpXG4gICAgICAgICAgICB3aGVuICdBYm91dCcgICAgICB0aGVuIHBvc3QudG9NYWluICdzaG93QWJvdXQnXG4gICAgICAgICAgICB3aGVuICdTYXZlJyAgICAgICB0aGVuIHBvc3QudG9NYWluICdzYXZlQnVmZmVyJ1xuICAgICAgICAgICAgd2hlbiAnUXVpdCcgICAgICAgdGhlbiBwb3N0LnRvTWFpbiAncXVpdEFwcCdcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbkNvbnRleHRNZW51OiAoZXZlbnQpID0+XG5cbiAgICAgICAgQHdpbi5mb2N1cygpXG4gICAgICAgIFxuICAgICAgICBhYnNQb3MgPSBwb3MgZXZlbnRcbiAgICAgICAgaWYgbm90IGFic1Bvcz9cbiAgICAgICAgICAgIGFic1BvcyA9IHBvcyAkKFwiI21haW5cIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCwgJChcIiNtYWluXCIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcFxuICAgICAgICBcbiAgICAgICAgaXRlbXMgPSBfLmNsb25lIHdpbmRvdy50aXRsZWJhci5tZW51VGVtcGxhdGUoKVxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5jb250ZXh0XG4gICAgICAgICAgICBpdGVtcyA9IEBvcHQuY29udGV4dCBpdGVtc1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpdGVtcy51bnNoaWZ0IHRleHQ6J0NsZWFyJywgYWNjZWw6J2NtZGN0cmwraydcbiAgICAgICAgICAgIFxuICAgICAgICBwb3B1cC5tZW51XG4gICAgICAgICAgICBpdGVtczogICBpdGVtc1xuICAgICAgICAgICAgeDogICAgICAgYWJzUG9zLnhcbiAgICAgICAgICAgIHk6ICAgICAgIGFic1Bvcy55XG4gICAgICAgICAgICBvbkNsb3NlOiAtPiBwb3N0LmVtaXQgJ2NvbnRleHRDbG9zZWQnXG4gICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMFxuICAgIFxuICAgIG9uS2V5RG93bjogKGV2ZW50KSA9PlxuICAgIFxuICAgICAgICByZXR1cm4gc3RvcEV2ZW50KGV2ZW50KSBpZiAndW5oYW5kbGVkJyAhPSB3aW5kb3cudGl0bGViYXIuaGFuZGxlS2V5IGV2ZW50LCB0cnVlXG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgIFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2RcbiAgICAgICAgXG4gICAgICAgICMgaWYgaW5mby5jb21ib1xuICAgICAgICBpbmZvLmV2ZW50ID0gZXZlbnRcbiAgICAgICAgcG9zdC5lbWl0ICdjb21ibycsIGluZm8uY29tYm8sIGluZm9cbiAgICBcbiAgICBvbktleVVwOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2QgXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBXaW5cbiJdfQ==
//# sourceURL=../coffee/win.coffee