// koffee 1.12.0

/*
000   000  000  000   000  
000 0 000  000  0000  000  
000000000  000  000 0 000  
000   000  000  000  0000  
00     00  000  000   000
 */
var $, Win, _, args, empty, fs, keyinfo, klog, kpos, open, popup, post, prefs, ref, scheme, slash, srcmap, stopEvent, title, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('./kxk'), $ = ref.$, _ = ref._, args = ref.args, empty = ref.empty, fs = ref.fs, keyinfo = ref.keyinfo, klog = ref.klog, kpos = ref.kpos, open = ref.open, popup = ref.popup, post = ref.post, prefs = ref.prefs, scheme = ref.scheme, slash = ref.slash, srcmap = ref.srcmap, stopEvent = ref.stopEvent, title = ref.title, valid = ref.valid;

Win = (function() {
    function Win(opt) {
        var base, electron, onLoad, onShow, ref1, sep;
        this.opt = opt;
        this.onKeyUp = bind(this.onKeyUp, this);
        this.onKeyDown = bind(this.onKeyDown, this);
        this.onContextMenu = bind(this.onContextMenu, this);
        this.onMenuAction = bind(this.onMenuAction, this);
        window.onerror = function(msg, source, line, col, err) {
            console.error('window.onerror', msg, source, line, col);
            srcmap = require('./srcmap');
            srcmap.logErr(err);
            return true;
        };
        sep = (ref1 = this.opt.prefsSeperator) != null ? ref1 : 'â–¸';
        prefs.init({
            separator: sep
        });
        if (this.opt.icon) {
            klog.slog.icon = slash.fileUrl(slash.join(this.opt.dir, this.opt.icon));
        }
        electron = require('electron');
        this.win = window.win = electron.remote.getCurrentWindow();
        this.id = window.winID = this.win.id;
        this.modifiers = '';
        this.userData = slash.userData();
        post.on('menuAction', this.onMenuAction);
        if ((base = this.opt).title != null) {
            base.title;
        } else {
            base.title = process.argv[0].endsWith('Electron Helper') && ['version'] || [];
        }
        window.titlebar = new title(this.opt);
        if (this.opt.context !== false) {
            document.body.addEventListener('contextmenu', this.onContextMenu);
        }
        if (!this.opt.nokeys) {
            document.addEventListener('keydown', this.onKeyDown);
            document.addEventListener('keyup', this.onKeyUp);
        }
        if (this.opt.scheme !== false) {
            scheme.set(prefs.get('scheme', 'dark'));
        }
        if (_.isFunction(this.opt.onShow)) {
            onShow = (function(_this) {
                return function() {
                    _this.opt.onShow();
                    return _this.win.removeListener('ready-to-show', onShow);
                };
            })(this);
            this.win.on('ready-to-show', onShow);
        }
        if (_.isFunction(this.opt.onLoad)) {
            onLoad = (function(_this) {
                return function() {
                    _this.opt.onLoad();
                    return _this.win.webContents.removeListener('did-finish-load', onLoad);
                };
            })(this);
            this.win.webContents.on('did-finish-load', onLoad);
        }
    }

    Win.prototype.screenshot = function() {
        return this.win.webContents.capturePage().then((function(_this) {
            return function(img) {
                var file;
                file = slash.unused("~/Desktop/" + _this.opt.pkg.name + ".png");
                return fs.writeFile(file, img.toPNG(), function(err) {
                    if (valid(err)) {
                        return klog('saving screenshot failed', err);
                    } else {
                        return klog("screenshot saved to " + file);
                    }
                });
            };
        })(this));
    };

    Win.prototype.onMenuAction = function(action, args) {
        switch (action) {
            case 'Screenshot':
                return this.screenshot();
            case 'Preferences':
                return open(prefs.store.file);
            case 'Fullscreen':
                return this.win.setFullScreen(!this.win.isFullScreen());
            case 'About':
                return post.toMain('showAbout');
            case 'Quit':
                return post.toMain('quitApp');
        }
        post.toMain('menuAction', action, args);
        return 'unhandled';
    };

    Win.prototype.onContextMenu = function(event) {
        var absPos, items;
        this.win.focus();
        absPos = kpos(event);
        if (absPos == null) {
            absPos = kpos($("#main").getBoundingClientRect().left, $("#main").getBoundingClientRect().top);
        }
        items = _.clone(window.titlebar.menuTemplate());
        if (_.isFunction(this.opt.context)) {
            items = this.opt.context(items);
            if (empty(items)) {
                return;
            }
        } else {
            items.unshift({
                text: 'Clear',
                accel: 'cmdctrl+k'
            });
        }
        return popup.menu({
            items: items,
            x: absPos.x,
            y: absPos.y,
            onClose: function() {
                return post.emit('contextClosed');
            }
        });
    };

    Win.prototype.onKeyDown = function(event) {
        var info;
        if ('unhandled' !== window.titlebar.handleKey(event, true)) {
            return stopEvent(event);
        }
        info = keyinfo.forEvent(event);
        this.modifiers = info.mod;
        info.event = event;
        return post.emit('combo', info.combo, info);
    };

    Win.prototype.onKeyUp = function(event) {
        var info;
        info = keyinfo.forEvent(event);
        return this.modifiers = info.mod;
    };

    return Win;

})();

module.exports = Win;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luLmpzIiwic291cmNlUm9vdCI6Ii4uL2NvZmZlZSIsInNvdXJjZXMiOlsid2luLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSw4SEFBQTtJQUFBOztBQVFBLE1BQTJILE9BQUEsQ0FBUSxPQUFSLENBQTNILEVBQUUsU0FBRixFQUFLLFNBQUwsRUFBUSxlQUFSLEVBQWMsaUJBQWQsRUFBcUIsV0FBckIsRUFBeUIscUJBQXpCLEVBQWtDLGVBQWxDLEVBQXdDLGVBQXhDLEVBQThDLGVBQTlDLEVBQW9ELGlCQUFwRCxFQUEyRCxlQUEzRCxFQUFpRSxpQkFBakUsRUFBd0UsbUJBQXhFLEVBQWdGLGlCQUFoRixFQUF1RixtQkFBdkYsRUFBK0YseUJBQS9GLEVBQTBHLGlCQUExRyxFQUFpSDs7QUFFM0c7SUFFQyxhQUFDLEdBQUQ7QUFFQyxZQUFBO1FBRkEsSUFBQyxDQUFBLE1BQUQ7Ozs7O1FBRUEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxHQUFELEVBQU0sTUFBTixFQUFjLElBQWQsRUFBb0IsR0FBcEIsRUFBeUIsR0FBekI7WUFFZCxPQUFBLENBQUMsS0FBRCxDQUFPLGdCQUFQLEVBQXdCLEdBQXhCLEVBQTZCLE1BQTdCLEVBQXFDLElBQXJDLEVBQTJDLEdBQTNDO1lBQ0MsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSO1lBQ1QsTUFBTSxDQUFDLE1BQVAsQ0FBYyxHQUFkO21CQUNBO1FBTGE7UUFPakIsR0FBQSxxREFBNEI7UUFDNUIsS0FBSyxDQUFDLElBQU4sQ0FBVztZQUFBLFNBQUEsRUFBVSxHQUFWO1NBQVg7UUFFQSxJQUFHLElBQUMsQ0FBQSxHQUFHLENBQUMsSUFBUjtZQUNJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBVixHQUFpQixLQUFLLENBQUMsT0FBTixDQUFjLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxHQUFoQixFQUFxQixJQUFDLENBQUEsR0FBRyxDQUFDLElB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QUhiOzs7Ozs7QUFLYixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgXG4wMDAgMCAwMDAgIDAwMCAgMDAwMCAgMDAwICBcbjAwMDAwMDAwMCAgMDAwICAwMDAgMCAwMDAgIFxuMDAwICAgMDAwICAwMDAgIDAwMCAgMDAwMCAgXG4wMCAgICAgMDAgIDAwMCAgMDAwICAgMDAwICBcbiMjI1xuXG57ICQsIF8sIGFyZ3MsIGVtcHR5LCBmcywga2V5aW5mbywga2xvZywga3Bvcywgb3BlbiwgcG9wdXAsIHBvc3QsIHByZWZzLCBzY2hlbWUsIHNsYXNoLCBzcmNtYXAsIHN0b3BFdmVudCwgdGl0bGUsIHZhbGlkIH0gPSByZXF1aXJlICcuL2t4aydcblxuY2xhc3MgV2luXG4gICAgXG4gICAgQDogKEBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICB3aW5kb3cub25lcnJvciA9IChtc2csIHNvdXJjZSwgbGluZSwgY29sLCBlcnIpIC0+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGVycm9yICd3aW5kb3cub25lcnJvcicgbXNnLCBzb3VyY2UsIGxpbmUsIGNvbFxuICAgICAgICAgICAgc3JjbWFwID0gcmVxdWlyZSAnLi9zcmNtYXAnXG4gICAgICAgICAgICBzcmNtYXAubG9nRXJyIGVyclxuICAgICAgICAgICAgdHJ1ZVxuICAgICAgICBcbiAgICAgICAgc2VwID0gQG9wdC5wcmVmc1NlcGVyYXRvciA/ICfilrgnXG4gICAgICAgIHByZWZzLmluaXQgc2VwYXJhdG9yOnNlcFxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5pY29uXG4gICAgICAgICAgICBrbG9nLnNsb2cuaWNvbiA9IHNsYXNoLmZpbGVVcmwgc2xhc2guam9pbiBAb3B0LmRpciwgQG9wdC5pY29uXG4gICAgICAgIFxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBcbiAgICAgICAgQHdpbiA9IHdpbmRvdy53aW4gPSBlbGVjdHJvbi5yZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpXG4gICAgICAgIEBpZCAgPSB3aW5kb3cud2luSUQgPSBAd2luLmlkXG4gICAgICAgIFxuICAgICAgICBAbW9kaWZpZXJzID0gJydcblxuICAgICAgICBAdXNlckRhdGEgPSBzbGFzaC51c2VyRGF0YSgpXG4gICAgICAgIFxuICAgICAgICBwb3N0Lm9uICdtZW51QWN0aW9uJyBAb25NZW51QWN0aW9uXG4gICAgICAgIFxuICAgICAgICBAb3B0LnRpdGxlID89IHByb2Nlc3MuYXJndlswXS5lbmRzV2l0aCgnRWxlY3Ryb24gSGVscGVyJykgYW5kIFsndmVyc2lvbiddIG9yIFtdXG4gICAgICAgIFxuICAgICAgICB3aW5kb3cudGl0bGViYXIgPSBuZXcgdGl0bGUgQG9wdFxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5jb250ZXh0ICE9IGZhbHNlXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIgJ2NvbnRleHRtZW51JyBAb25Db250ZXh0TWVudVxuICAgICAgICBcbiAgICAgICAgaWYgbm90IEBvcHQubm9rZXlzXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdrZXlkb3duJyBAb25LZXlEb3duXG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyICdrZXl1cCcgICBAb25LZXlVcFxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5zY2hlbWUgIT0gZmFsc2VcbiAgICAgICAgICAgIHNjaGVtZS5zZXQgcHJlZnMuZ2V0ICdzY2hlbWUnICdkYXJrJ1xuICAgICAgICAgICAgXG4gICAgICAgIGlmIF8uaXNGdW5jdGlvbiBAb3B0Lm9uU2hvd1xuICAgICAgICAgICAgb25TaG93ID0gPT4gQG9wdC5vblNob3coKTsgQHdpbi5yZW1vdmVMaXN0ZW5lciAncmVhZHktdG8tc2hvdycgb25TaG93XG4gICAgICAgICAgICBAd2luLm9uICdyZWFkeS10by1zaG93JyBvblNob3dcblxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5vbkxvYWRcbiAgICAgICAgICAgIG9uTG9hZCA9ID0+IEBvcHQub25Mb2FkKCk7IEB3aW4ud2ViQ29udGVudHMucmVtb3ZlTGlzdGVuZXIgJ2RpZC1maW5pc2gtbG9hZCcgb25Mb2FkXG4gICAgICAgICAgICBAd2luLndlYkNvbnRlbnRzLm9uICdkaWQtZmluaXNoLWxvYWQnIG9uTG9hZFxuICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIyAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgIDAwMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgMDAwXG4gICAgXG4gICAgc2NyZWVuc2hvdDogLT5cbiAgICAgICAgXG4gICAgICAgIEB3aW4ud2ViQ29udGVudHMuY2FwdHVyZVBhZ2UoKS50aGVuIChpbWcpID0+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZpbGUgPSBzbGFzaC51bnVzZWQgXCJ+L0Rlc2t0b3AvI3tAb3B0LnBrZy5uYW1lfS5wbmdcIlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBmcy53cml0ZUZpbGUgZmlsZSwgaW1nLnRvUE5HKCksIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgaWYgdmFsaWQgZXJyXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgJ3NhdmluZyBzY3JlZW5zaG90IGZhaWxlZCcgZXJyXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBrbG9nIFwic2NyZWVuc2hvdCBzYXZlZCB0byAje2ZpbGV9XCJcbiAgICAgICAgICAgIFxuICAgICMgMDAgICAgIDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICBcbiAgICBcbiAgICBvbk1lbnVBY3Rpb246IChhY3Rpb24sIGFyZ3MpID0+XG5cbiAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgd2hlbiAnU2NyZWVuc2hvdCcgIHRoZW4gcmV0dXJuIEBzY3JlZW5zaG90KClcbiAgICAgICAgICAgIHdoZW4gJ1ByZWZlcmVuY2VzJyB0aGVuIHJldHVybiBvcGVuIHByZWZzLnN0b3JlLmZpbGVcbiAgICAgICAgICAgIHdoZW4gJ0Z1bGxzY3JlZW4nICB0aGVuIHJldHVybiBAd2luLnNldEZ1bGxTY3JlZW4gIUB3aW4uaXNGdWxsU2NyZWVuKClcbiAgICAgICAgICAgIHdoZW4gJ0Fib3V0JyAgICAgICB0aGVuIHJldHVybiBwb3N0LnRvTWFpbiAnc2hvd0Fib3V0J1xuICAgICAgICAgICAgd2hlbiAnUXVpdCcgICAgICAgIHRoZW4gcmV0dXJuIHBvc3QudG9NYWluICdxdWl0QXBwJ1xuICAgICAgICAgIFxuICAgICAgICBwb3N0LnRvTWFpbiAnbWVudUFjdGlvbicgYWN0aW9uLCBhcmdzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgJ3VuaGFuZGxlZCdcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbkNvbnRleHRNZW51OiAoZXZlbnQpID0+XG5cbiAgICAgICAgQHdpbi5mb2N1cygpXG4gICAgICAgIFxuICAgICAgICBhYnNQb3MgPSBrcG9zIGV2ZW50XG4gICAgICAgIGlmIG5vdCBhYnNQb3M/XG4gICAgICAgICAgICBhYnNQb3MgPSBrcG9zICQoXCIjbWFpblwiKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0LCAkKFwiI21haW5cIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wXG4gICAgICAgIFxuICAgICAgICBpdGVtcyA9IF8uY2xvbmUgd2luZG93LnRpdGxlYmFyLm1lbnVUZW1wbGF0ZSgpXG4gICAgICAgIFxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5jb250ZXh0XG4gICAgICAgICAgICBpdGVtcyA9IEBvcHQuY29udGV4dCBpdGVtc1xuICAgICAgICAgICAgaWYgZW1wdHkgaXRlbXMgXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGl0ZW1zLnVuc2hpZnQgdGV4dDonQ2xlYXInIGFjY2VsOidjbWRjdHJsK2snXG4gICAgICAgIFxuICAgICAgICBwb3B1cC5tZW51XG4gICAgICAgICAgICBpdGVtczogICBpdGVtc1xuICAgICAgICAgICAgeDogICAgICAgYWJzUG9zLnhcbiAgICAgICAgICAgIHk6ICAgICAgIGFic1Bvcy55XG4gICAgICAgICAgICBvbkNsb3NlOiAtPiBwb3N0LmVtaXQgJ2NvbnRleHRDbG9zZWQnXG4gICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMFxuICAgIFxuICAgIG9uS2V5RG93bjogKGV2ZW50KSA9PlxuICAgIFxuICAgICAgICByZXR1cm4gc3RvcEV2ZW50KGV2ZW50KSBpZiAndW5oYW5kbGVkJyAhPSB3aW5kb3cudGl0bGViYXIuaGFuZGxlS2V5IGV2ZW50LCB0cnVlXG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgIFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2RcbiAgICAgICAgXG4gICAgICAgIGluZm8uZXZlbnQgPSBldmVudFxuICAgICAgICBwb3N0LmVtaXQgJ2NvbWJvJyBpbmZvLmNvbWJvLCBpbmZvXG4gICAgXG4gICAgb25LZXlVcDogKGV2ZW50KSA9PlxuICAgICAgICBcbiAgICAgICAgaW5mbyA9IGtleWluZm8uZm9yRXZlbnQgZXZlbnRcbiAgICAgICAgQG1vZGlmaWVycyA9IGluZm8ubW9kIFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gV2luXG4iXX0=
//# sourceURL=../coffee/win.coffee