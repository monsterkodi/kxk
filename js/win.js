// koffee 0.42.0

/*
000   000  000  000   000  
000 0 000  000  0000  000  
000000000  000  000 0 000  
000   000  000  000  0000  
00     00  000  000   000
 */
var $, Win, _, elem, empty, fs, keyinfo, klog, popup, pos, post, prefs, ref, scheme, slash, stopEvent, str, title, valid,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('./kxk'), post = ref.post, keyinfo = ref.keyinfo, title = ref.title, scheme = ref.scheme, stopEvent = ref.stopEvent, prefs = ref.prefs, slash = ref.slash, elem = ref.elem, empty = ref.empty, valid = ref.valid, popup = ref.popup, pos = ref.pos, str = ref.str, fs = ref.fs, klog = ref.klog, $ = ref.$, _ = ref._;

Win = (function() {
    function Win(opt) {
        var electron, onLoad, onShow;
        this.opt = opt;
        this.onKeyUp = bind(this.onKeyUp, this);
        this.onKeyDown = bind(this.onKeyDown, this);
        this.onContextMenu = bind(this.onContextMenu, this);
        this.onMenuAction = bind(this.onMenuAction, this);
        window.onerror = function(msg, source, line, col, err) {
            var srcmap;
            console.error('window.onerror', msg, source, line, col);
            srcmap = require('./srcmap');
            srcmap.logErr(err);
            return true;
        };
        prefs.init();
        if (this.opt.icon) {
            klog.slog.icon = slash.fileUrl(slash.join(this.opt.dir, this.opt.icon));
        }
        electron = require('electron');
        this.win = window.win = electron.remote.getCurrentWindow();
        this.id = window.winID = this.win.id;
        this.modifiers = '';
        this.userData = slash.userData();
        post.on('menuAction', this.onMenuAction);
        window.titlebar = new title(this.opt);
        document.body.addEventListener('contextmenu', this.onContextMenu);
        if (!this.opt.nokeys) {
            document.addEventListener('keydown', this.onKeyDown);
            document.addEventListener('keyup', this.onKeyUp);
        }
        if (this.opt.scheme !== false) {
            scheme.set(prefs.get('scheme', 'dark'));
        }
        if (_.isFunction(this.opt.onShow)) {
            onShow = (function(_this) {
                return function() {
                    _this.opt.onShow();
                    return _this.win.removeListener('ready-to-show', onShow);
                };
            })(this);
            this.win.on('ready-to-show', onShow);
        }
        if (_.isFunction(this.opt.onLoad)) {
            onLoad = (function(_this) {
                return function() {
                    _this.opt.onLoad();
                    return _this.win.webContents.removeListener('did-finish-load', onLoad);
                };
            })(this);
            this.win.webContents.on('did-finish-load', onLoad);
        }
    }

    Win.prototype.screenshot = function() {
        return this.win.capturePage((function(_this) {
            return function(img) {
                var file;
                file = slash.resolve("~/Desktop/" + _this.opt.pkg.name + "-screenshot.png");
                return fs.writeFile(file, img.toPNG(), function(err) {
                    if (valid(err)) {
                        return klog('saving screenshot failed', err);
                    } else {
                        return klog("screenshot saved to " + file);
                    }
                });
            };
        })(this));
    };

    Win.prototype.onMenuAction = function(action, args) {
        switch (action) {
            case 'Screenshot':
                return this.screenshot();
            case 'About':
                return post.toMain('showAbout');
            case 'Save':
                return post.toMain('saveBuffer');
            case 'Quit':
                return post.toMain('quitApp');
        }
    };

    Win.prototype.onContextMenu = function(event) {
        var absPos, items;
        this.win.focus();
        absPos = pos(event);
        if (absPos == null) {
            absPos = pos($("#main").getBoundingClientRect().left, $("#main").getBoundingClientRect().top);
        }
        items = _.clone(window.titlebar.menuTemplate());
        if (_.isFunction(this.opt.context)) {
            items = this.opt.context(items);
            if (empty(items)) {
                return;
            }
        } else {
            items.unshift({
                text: 'Clear',
                accel: 'cmdctrl+k'
            });
        }
        return popup.menu({
            items: items,
            x: absPos.x,
            y: absPos.y,
            onClose: function() {
                return post.emit('contextClosed');
            }
        });
    };

    Win.prototype.onKeyDown = function(event) {
        var info;
        if ('unhandled' !== window.titlebar.handleKey(event, true)) {
            return stopEvent(event);
        }
        info = keyinfo.forEvent(event);
        this.modifiers = info.mod;
        info.event = event;
        return post.emit('combo', info.combo, info);
    };

    Win.prototype.onKeyUp = function(event) {
        var info;
        info = keyinfo.forEvent(event);
        return this.modifiers = info.mod;
    };

    return Win;

})();

module.exports = Win;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2luLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSxvSEFBQTtJQUFBOztBQVFBLE1BQWlILE9BQUEsQ0FBUSxPQUFSLENBQWpILEVBQUUsZUFBRixFQUFRLHFCQUFSLEVBQWlCLGlCQUFqQixFQUF3QixtQkFBeEIsRUFBZ0MseUJBQWhDLEVBQTJDLGlCQUEzQyxFQUFrRCxpQkFBbEQsRUFBeUQsZUFBekQsRUFBK0QsaUJBQS9ELEVBQXNFLGlCQUF0RSxFQUE2RSxpQkFBN0UsRUFBb0YsYUFBcEYsRUFBeUYsYUFBekYsRUFBOEYsV0FBOUYsRUFBa0csZUFBbEcsRUFBd0csU0FBeEcsRUFBMkc7O0FBRXJHO0lBRVcsYUFBQyxHQUFEO0FBRVQsWUFBQTtRQUZVLElBQUMsQ0FBQSxNQUFEOzs7OztRQUVWLE1BQU0sQ0FBQyxPQUFQLEdBQWlCLFNBQUMsR0FBRCxFQUFNLE1BQU4sRUFBYyxJQUFkLEVBQW9CLEdBQXBCLEVBQXlCLEdBQXpCO0FBRWQsZ0JBQUE7WUFBQSxPQUFBLENBQUMsS0FBRCxDQUFPLGdCQUFQLEVBQXlCLEdBQXpCLEVBQThCLE1BQTlCLEVBQXNDLElBQXRDLEVBQTRDLEdBQTVDO1lBQ0MsTUFBQSxHQUFTLE9BQUEsQ0FBUSxVQUFSO1lBQ1QsTUFBTSxDQUFDLE1BQVAsQ0FBYyxHQUFkO21CQUNBO1FBTGE7UUFPakIsS0FBSyxDQUFDLElBQU4sQ0FBQTtRQUVBLElBQUcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQUFSO1lBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFWLEdBQWlCLEtBQUssQ0FBQyxPQUFOLENBQWMsS0FBSyxDQUFDLElBQU4sQ0FBVyxJQUFDLENBQUEsR0FBRyxDQUFDLEdBQWhCLEVBQXFCLElBQUMsQ0FBQSxHQUFHLENBQUMsSUFBMUIsQ0FBZCxFQURyQjs7UUFHQSxRQUFBLEdBQVcsT0FBQSxDQUFRLFVBQVI7UUFFWCxJQUFDLENB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U0FESjtJQWpCVzs7a0JBNkJmLFNBQUEsR0FBVyxTQUFDLEtBQUQ7QUFFUCxZQUFBO1FBQUEsSUFBMkIsV0FBQSxLQUFlLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBaEIsQ0FBMEIsS0FBMUIsRUFBaUMsSUFBakMsQ0FBMUM7QUFBQSxtQkFBTyxTQUFBLENBQVUsS0FBVixFQUFQOztRQUVBLElBQUEsR0FBTyxPQUFPLENBQUMsUUFBUixDQUFpQixLQUFqQjtRQUVQLElBQUMsQ0FBQSxTQUFELEdBQWEsSUFBSSxDQUFDO1FBR2xCLElBQUksQ0FBQyxLQUFMLEdBQWE7ZUFDYixJQUFJLENBQUMsSUFBTCxDQUFVLE9BQVYsRUFBbUIsSUFBSSxDQUFDLEtBQXhCLEVBQStCLElBQS9CO0lBVk87O2tCQVlYLE9BQUEsR0FBUyxTQUFDLEtBQUQ7QUFFTCxZQUFBO1FBQUEsSUFBQSxHQUFPLE9BQU8sQ0FBQyxRQUFSLENBQWlCLEtBQWpCO2VBQ1AsSUFBQyxDQUFBLFNBQUQsR0FBYSxJQUFJLENBQUM7SUFIYjs7Ozs7O0FBS2IsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIFxuMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMCAgXG4wMDAwMDAwMDAgIDAwMCAgMDAwIDAgMDAwICBcbjAwMCAgIDAwMCAgMDAwICAwMDAgIDAwMDAgIFxuMDAgICAgIDAwICAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyBwb3N0LCBrZXlpbmZvLCB0aXRsZSwgc2NoZW1lLCBzdG9wRXZlbnQsIHByZWZzLCBzbGFzaCwgZWxlbSwgZW1wdHksIHZhbGlkLCBwb3B1cCwgcG9zLCBzdHIsIGZzLCBrbG9nLCAkLCBfIH0gPSByZXF1aXJlICcuL2t4aydcblxuY2xhc3MgV2luXG4gICAgXG4gICAgY29uc3RydWN0b3I6IChAb3B0KSAtPlxuICAgICAgICBcbiAgICAgICAgd2luZG93Lm9uZXJyb3IgPSAobXNnLCBzb3VyY2UsIGxpbmUsIGNvbCwgZXJyKSAtPlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBlcnJvciAnd2luZG93Lm9uZXJyb3InLCBtc2csIHNvdXJjZSwgbGluZSwgY29sXG4gICAgICAgICAgICBzcmNtYXAgPSByZXF1aXJlICcuL3NyY21hcCdcbiAgICAgICAgICAgIHNyY21hcC5sb2dFcnIgZXJyXG4gICAgICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICAgICBwcmVmcy5pbml0KClcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuaWNvblxuICAgICAgICAgICAga2xvZy5zbG9nLmljb24gPSBzbGFzaC5maWxlVXJsIHNsYXNoLmpvaW4gQG9wdC5kaXIsIEBvcHQuaWNvblxuICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgXG4gICAgICAgIEB3aW4gPSB3aW5kb3cud2luID0gZWxlY3Ryb24ucmVtb3RlLmdldEN1cnJlbnRXaW5kb3coKVxuICAgICAgICBAaWQgID0gd2luZG93LndpbklEID0gQHdpbi5pZFxuICAgICAgICBcbiAgICAgICAgQG1vZGlmaWVycyA9ICcnXG5cbiAgICAgICAgQHVzZXJEYXRhID0gc2xhc2gudXNlckRhdGEoKVxuICAgICAgICBcbiAgICAgICAgcG9zdC5vbiAnbWVudUFjdGlvbicsIEBvbk1lbnVBY3Rpb25cbiAgICAgICAgXG4gICAgICAgIHdpbmRvdy50aXRsZWJhciA9IG5ldyB0aXRsZSBAb3B0XG4gICAgICAgIFxuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIgJ2NvbnRleHRtZW51JywgQG9uQ29udGV4dE1lbnVcbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBAb3B0Lm5va2V5c1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAna2V5ZG93bicsIEBvbktleURvd25cbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgJ2tleXVwJywgICBAb25LZXlVcFxuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC5zY2hlbWUgIT0gZmFsc2VcbiAgICAgICAgICAgIHNjaGVtZS5zZXQgcHJlZnMuZ2V0ICdzY2hlbWUnLCAnZGFyaydcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5vblNob3dcbiAgICAgICAgICAgIG9uU2hvdyA9ID0+IEBvcHQub25TaG93KCk7IEB3aW4ucmVtb3ZlTGlzdGVuZXIgJ3JlYWR5LXRvLXNob3cnLCBvblNob3dcbiAgICAgICAgICAgIEB3aW4ub24gJ3JlYWR5LXRvLXNob3cnLCBvblNob3dcblxuICAgICAgICBpZiBfLmlzRnVuY3Rpb24gQG9wdC5vbkxvYWRcbiAgICAgICAgICAgIG9uTG9hZCA9ID0+IEBvcHQub25Mb2FkKCk7IEB3aW4ud2ViQ29udGVudHMucmVtb3ZlTGlzdGVuZXIgJ2RpZC1maW5pc2gtbG9hZCcsIG9uTG9hZFxuICAgICAgICAgICAgQHdpbi53ZWJDb250ZW50cy5vbiAnZGlkLWZpbmlzaC1sb2FkJywgb25Mb2FkXG4gICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMFxuICAgICMwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwXG4gICAgIzAwMDAwMDAgICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDBcbiAgICAjICAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAwMDAwICAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAgICAgMDAwXG4gICAgXG4gICAgc2NyZWVuc2hvdDogLT5cbiAgICBcbiAgICAgICAgQHdpbi5jYXB0dXJlUGFnZSAoaW1nKSA9PlxuICAgICAgICAgICAgZmlsZSA9IHNsYXNoLnJlc29sdmUgXCJ+L0Rlc2t0b3AvI3tAb3B0LnBrZy5uYW1lfS1zY3JlZW5zaG90LnBuZ1wiXG4gICAgICAgICAgICBmcy53cml0ZUZpbGUgZmlsZSwgaW1nLnRvUE5HKCksIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgaWYgdmFsaWQgZXJyXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgJ3NhdmluZyBzY3JlZW5zaG90IGZhaWxlZCcsIGVyclxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAga2xvZyBcInNjcmVlbnNob3Qgc2F2ZWQgdG8gI3tmaWxlfVwiXG4gICAgICAgICAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgb25NZW51QWN0aW9uOiAoYWN0aW9uLCBhcmdzKSA9PlxuICAgICAgICBcbiAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgd2hlbiAnU2NyZWVuc2hvdCcgdGhlbiBAc2NyZWVuc2hvdCgpXG4gICAgICAgICAgICB3aGVuICdBYm91dCcgICAgICB0aGVuIHBvc3QudG9NYWluICdzaG93QWJvdXQnXG4gICAgICAgICAgICB3aGVuICdTYXZlJyAgICAgICB0aGVuIHBvc3QudG9NYWluICdzYXZlQnVmZmVyJ1xuICAgICAgICAgICAgd2hlbiAnUXVpdCcgICAgICAgdGhlbiBwb3N0LnRvTWFpbiAncXVpdEFwcCdcblxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbkNvbnRleHRNZW51OiAoZXZlbnQpID0+XG5cbiAgICAgICAgQHdpbi5mb2N1cygpXG4gICAgICAgIFxuICAgICAgICBhYnNQb3MgPSBwb3MgZXZlbnRcbiAgICAgICAgaWYgbm90IGFic1Bvcz9cbiAgICAgICAgICAgIGFic1BvcyA9IHBvcyAkKFwiI21haW5cIikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCwgJChcIiNtYWluXCIpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcFxuICAgICAgICBcbiAgICAgICAgaXRlbXMgPSBfLmNsb25lIHdpbmRvdy50aXRsZWJhci5tZW51VGVtcGxhdGUoKVxuICAgICAgICBcbiAgICAgICAgaWYgXy5pc0Z1bmN0aW9uIEBvcHQuY29udGV4dFxuICAgICAgICAgICAgaXRlbXMgPSBAb3B0LmNvbnRleHQgaXRlbXNcbiAgICAgICAgICAgIGlmIGVtcHR5IGl0ZW1zIFxuICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBpdGVtcy51bnNoaWZ0IHRleHQ6J0NsZWFyJywgYWNjZWw6J2NtZGN0cmwraydcbiAgICAgICAgICAgIFxuICAgICAgICBwb3B1cC5tZW51XG4gICAgICAgICAgICBpdGVtczogICBpdGVtc1xuICAgICAgICAgICAgeDogICAgICAgYWJzUG9zLnhcbiAgICAgICAgICAgIHk6ICAgICAgIGFic1Bvcy55XG4gICAgICAgICAgICBvbkNsb3NlOiAtPiBwb3N0LmVtaXQgJ2NvbnRleHRDbG9zZWQnXG4gICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMFxuICAgIFxuICAgIG9uS2V5RG93bjogKGV2ZW50KSA9PlxuICAgIFxuICAgICAgICByZXR1cm4gc3RvcEV2ZW50KGV2ZW50KSBpZiAndW5oYW5kbGVkJyAhPSB3aW5kb3cudGl0bGViYXIuaGFuZGxlS2V5IGV2ZW50LCB0cnVlXG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgIFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2RcbiAgICAgICAgXG4gICAgICAgICMgaWYgaW5mby5jb21ib1xuICAgICAgICBpbmZvLmV2ZW50ID0gZXZlbnRcbiAgICAgICAgcG9zdC5lbWl0ICdjb21ibycsIGluZm8uY29tYm8sIGluZm9cbiAgICBcbiAgICBvbktleVVwOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICBpbmZvID0ga2V5aW5mby5mb3JFdmVudCBldmVudFxuICAgICAgICBAbW9kaWZpZXJzID0gaW5mby5tb2QgXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBXaW5cbiJdfQ==
//# sourceURL=../coffee/win.coffee