(function() {
  /*
  00000000    0000000   00000000   000   000  00000000 
  000   000  000   000  000   000  000   000  000   000
  00000000   000   000  00000000   000   000  00000000 
  000        000   000  000        000   000  000      
  000         0000000   000         0000000   000      
  */
  var Popup, elem, empty, keyinfo, menu, os, post, stopEvent;

  ({post, stopEvent, keyinfo, empty, elem, menu, os} = require('./kxk'));

  Popup = class Popup {
    constructor(opt) {
      var br, div, i, item, len, ref, ref1, ref2, ref3, text;
      
      //  0000000  000       0000000    0000000  00000000  
      // 000       000      000   000  000       000       
      // 000       000      000   000  0000000   0000000   
      // 000       000      000   000       000  000       
      //  0000000  0000000   0000000   0000000   00000000  
      this.close = this.close.bind(this);
      
      // 00     00   0000000   000   000   0000000  00000000    
      // 000   000  000   000  000   000  000       000         
      // 000000000  000   000  000   000  0000000   0000000     
      // 000 0 000  000   000  000   000       000  000         
      // 000   000   0000000    0000000   0000000   00000000    
      this.onHover = this.onHover.bind(this);
      this.onClick = this.onClick.bind(this);
      this.onContextMenu = this.onContextMenu.bind(this);
      this.onFocusOut = this.onFocusOut.bind(this);
      
      // 000   000  00000000  000   000  
      // 000  000   000        000 000   
      // 0000000    0000000     00000    
      // 000  000   000          000     
      // 000   000  00000000     000     
      this.onKeyDown = this.onKeyDown.bind(this);
      this.focusElem = document.activeElement;
      this.items = elem({
        class: 'popup',
        tabindex: 3
      });
      this.parent = opt.parent;
      this.onClose = opt.onClose;
      if (opt.class) {
        this.items.classList.add(opt.class);
      }
      ref = opt.items;
      for (i = 0, len = ref.length; i < len; i++) {
        item = ref[i];
        if (item.hide) {
          continue;
        }
        if (empty(item.text) && empty(item.html)) {
          div = elem('hr', {
            class: 'popupItem separator'
          });
        } else {
          div = elem({
            class: 'popupItem',
            text: item.text
          });
          if (!empty(item.html)) {
            div.innerHTML = item.html;
          }
          div.item = item;
          div.addEventListener('click', this.onClick);
          if ((ref1 = item.combo) != null ? ref1 : item.accel) {
            text = keyinfo.short(os.platform() === 'darwin' ? (ref2 = item.combo) != null ? ref2 : item.accel : (ref3 = item.accel) != null ? ref3 : item.combo);
            div.appendChild(elem('span', {
              class: 'popupCombo',
              text: text
            }));
          } else if (item.menu) {
            div.appendChild(elem('span', {
              class: 'popupCombo',
              text: 'â–¶'
            }));
          }
        }
        this.items.appendChild(div);
      }
      document.body.appendChild(this.items);
      this.items.addEventListener('contextmenu', this.onContextMenu);
      this.items.addEventListener('keydown', this.onKeyDown);
      this.items.addEventListener('focusout', this.onFocusOut);
      this.items.addEventListener('mouseover', this.onHover);
      br = this.items.getBoundingClientRect();
      if (opt.x + br.width > document.body.clientWidth) {
        this.items.style.left = `${document.body.clientWidth - br.width}px`;
      } else {
        this.items.style.left = `${opt.x}px`;
      }
      if (opt.y + br.height > document.body.clientHeight) {
        this.items.style.top = `${document.body.clientHeight - br.height}px`;
      } else {
        this.items.style.top = `${opt.y}px`;
      }
      if (opt.selectFirstItem !== false) {
        this.select(this.items.firstChild, {
          selectFirstItem: false
        });
      }
      post.emit('popup', 'opened');
    }

    close(opt = {}) {
      var ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, ref8;
      if (empty(this.parent) || ((ref = this.parentMenu()) != null ? (ref1 = ref.elem) != null ? ref1.classList.contains('menu') : void 0 : void 0)) {
        post.emit('popup', 'closed');
        if (typeof this.onClose === "function") {
          this.onClose();
        }
      }
      if ((ref2 = this.popup) != null) {
        ref2.close({
          focus: false
        });
      }
      delete this.popup;
      if ((ref3 = this.items) != null) {
        ref3.removeEventListener('keydown', this.onKeyDown);
      }
      if ((ref4 = this.items) != null) {
        ref4.removeEventListener('focusout', this.onFocusOut);
      }
      if ((ref5 = this.items) != null) {
        ref5.removeEventListener('mouseover', this.onHover);
      }
      if ((ref6 = this.items) != null) {
        ref6.remove();
      }
      delete this.items;
      if ((ref7 = this.parent) != null) {
        ref7.childClosed(this, opt);
      }
      if (opt.all) {
        if (this.parent != null) {
          this.parent.close(opt);
        }
      }
      if (opt.focus !== false && !this.parent) {
        return (ref8 = this.focusElem) != null ? ref8.focus() : void 0;
      }
    }

    childClosed(child, opt) {
      if (child === this.popup) {
        delete this.popup;
        if (opt.focus !== false) {
          return this.focus();
        }
      }
    }

    
    //  0000000  00000000  000      00000000   0000000  000000000  
    // 000       000       000      000       000          000     
    // 0000000   0000000   000      0000000   000          000     
    //      000  000       000      000       000          000     
    // 0000000   00000000  0000000  00000000   0000000     000     
    select(item, opt = {}) {
      var ref, ref1;
      if (item == null) {
        return;
      }
      if (this.popup != null) {
        this.popup.close({
          focus: false
        });
      }
      if ((ref = this.selected) != null) {
        ref.classList.remove('selected');
      }
      this.selected = item;
      this.selected.classList.add('selected');
      if (((ref1 = item.item) != null ? ref1.menu : void 0) && opt.open !== false) {
        delete this.popup;
        this.popupChild(item, opt);
      }
      return this.focus();
    }

    
    // 00000000    0000000   00000000   000   000  00000000    0000000  000   000  000  000      0000000    
    // 000   000  000   000  000   000  000   000  000   000  000       000   000  000  000      000   000  
    // 00000000   000   000  00000000   000   000  00000000   000       000000000  000  000      000   000  
    // 000        000   000  000        000   000  000        000       000   000  000  000      000   000  
    // 000         0000000   000         0000000   000         0000000  000   000  000  0000000  0000000    
    popupChild(item, opt = {}) {
      var br, items;
      if (items = item.item.menu) {
        if (this.popup) {
          return this.closePopup();
        } else {
          br = item.getBoundingClientRect();
          return this.popup = new Popup({
            items: items,
            parent: this,
            x: br.left + br.width,
            y: br.top,
            selectFirstItem: opt != null ? opt.selectFirstItem : void 0
          });
        }
      }
    }

    closePopup() {
      var ref;
      if ((ref = this.popup) != null) {
        ref.close({
          focus: false
        });
      }
      return delete this.popup;
    }

    // 000   000   0000000   000   000  000   0000000    0000000   000000000  00000000  
    // 0000  000  000   000  000   000  000  000        000   000     000     000       
    // 000 0 000  000000000   000 000   000  000  0000  000000000     000     0000000   
    // 000  0000  000   000     000     000  000   000  000   000     000     000       
    // 000   000  000   000      0      000   0000000   000   000     000     00000000  
    navigateLeft() {
      if (this.popup) {
        return this.closePopup();
      } else if (menu = this.parentMenu()) {
        return menu.navigateLeft();
      } else if (this.parent) {
        return this.close({
          focus: false
        });
      }
    }

    activateOrNavigateRight() {
      if (this.selected != null) {
        if (!this.selected.item.menu) {
          return this.activate(this.selected);
        } else {
          return this.navigateRight();
        }
      }
    }

    navigateRight() {
      var ref;
      if (this.popup) {
        return this.popup.select(this.popup.items.firstChild);
      } else if ((ref = this.selected) != null ? ref.item.menu : void 0) {
        return this.select(this.selected, {
          selectFirstItem: true
        });
      } else if (menu = this.parentMenu()) {
        return menu.navigateRight();
      }
    }

    parentMenu() {
      if ((this.parent != null) && !this.parent.parent) {
        return this.parent;
      }
    }

    
    // 000   000  00000000  000   000  000000000        00000000   00000000   00000000  000   000  
    // 0000  000  000        000 000      000           000   000  000   000  000       000   000  
    // 000 0 000  0000000     00000       000           00000000   0000000    0000000    000 000   
    // 000  0000  000        000 000      000           000        000   000  000          000     
    // 000   000  00000000  000   000     000           000        000   000  00000000      0      
    nextItem() {
      var next, ref;
      if (next = this.selected) {
        while (next = next.nextSibling) {
          if (!empty((ref = next.item) != null ? ref.text : void 0)) {
            return next;
          }
        }
      }
    }

    prevItem() {
      var prev, ref;
      if (prev = this.selected) {
        while (prev = prev.previousSibling) {
          if (!empty((ref = prev.item) != null ? ref.text : void 0)) {
            return prev;
          }
        }
      }
    }

    
    //  0000000    0000000  000000000  000  000   000   0000000   000000000  00000000  
    // 000   000  000          000     000  000   000  000   000     000     000       
    // 000000000  000          000     000   000 000   000000000     000     0000000   
    // 000   000  000          000     000     000     000   000     000     000       
    // 000   000   0000000     000     000      0      000   000     000     00000000  
    activate(item) {
      var ref, ref1, ref2;
      if (((ref = item.item) != null ? ref.cb : void 0) != null) {
        this.close({
          all: true
        });
        return item.item.cb((ref1 = item.item.arg) != null ? ref1 : item.item.text);
      } else if (!item.item.menu) {
        this.close({
          all: true
        });
        return post.emit('menuAction', (ref2 = item.item.action) != null ? ref2 : item.item.text, item.item);
      }
    }

    toggle(item) {
      if (this.popup) {
        this.popup.close({
          focus: false
        });
        return delete this.popup;
      } else {
        return this.select(item, {
          selectFirstItem: false
        });
      }
    }

    onHover(event) {
      var item;
      item = elem.upElem(event.target, {
        prop: 'item'
      });
      if (item) {
        return this.select(item, {
          selectFirstItem: false
        });
      }
    }

    onClick(event) {
      var item;
      stopEvent(event);
      item = elem.upElem(event.target, {
        prop: 'item'
      });
      if (item) {
        if (item.item.menu) {
          return this.toggle(item);
        } else {
          return this.activate(item);
        }
      }
    }

    onContextMenu(event) {
      return stopEvent(event); // prevents multiple popups
    }

    
    // 00000000   0000000    0000000  000   000   0000000  
    // 000       000   000  000       000   000  000       
    // 000000    000   000  000       000   000  0000000   
    // 000       000   000  000       000   000       000  
    // 000        0000000    0000000   0000000   0000000   
    focus() {
      var ref;
      return (ref = this.items) != null ? ref.focus() : void 0;
    }

    onFocusOut(event) {
      var ref;
      if (!((ref = event.relatedTarget) != null ? ref.classList.contains('popup') : void 0)) {
        return this.close({
          all: true,
          focus: false
        });
      }
    }

    onKeyDown(event) {
      var combo, key, mod;
      ({mod, key, combo} = keyinfo.forEvent(event));
      switch (combo) {
        case 'end':
        case 'page down':
          return stopEvent(event, this.select(this.items.lastChild, {
            selectFirstItem: false
          }));
        case 'home':
        case 'page up':
          return stopEvent(event, this.select(this.items.firstChild, {
            selectFirstItem: false
          }));
        case 'esc':
          return stopEvent(event, this.close());
        case 'down':
          return stopEvent(event, this.select(this.nextItem(), {
            selectFirstItem: false
          }));
        case 'up':
          return stopEvent(event, this.select(this.prevItem(), {
            selectFirstItem: false
          }));
        case 'enter':
        case 'space':
          return stopEvent(event, this.activateOrNavigateRight());
        case 'left':
          return stopEvent(event, this.navigateLeft());
        case 'right':
          return stopEvent(event, this.navigateRight());
      }
    }

  };

  module.exports = {
    menu: function(opt) {
      return new Popup(opt);
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3BvcHVwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxLQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLEVBQUEsRUFBQSxJQUFBLEVBQUE7O0VBUUEsQ0FBQSxDQUFFLElBQUYsRUFBUSxTQUFSLEVBQW1CLE9BQW5CLEVBQTRCLEtBQTVCLEVBQW1DLElBQW5DLEVBQXlDLElBQXpDLEVBQStDLEVBQS9DLENBQUEsR0FBc0QsT0FBQSxDQUFRLE9BQVIsQ0FBdEQ7O0VBRU0sUUFBTixNQUFBLE1BQUE7SUFFSSxXQUFhLENBQUMsR0FBRCxDQUFBO0FBRVQsVUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBOzs7Ozs7O1VBd0RKLENBQUEsWUFBQSxDQUFBLGlCQXhESTs7Ozs7OztVQW9OSixDQUFBLGNBQUEsQ0FBQTtVQU1BLENBQUEsY0FBQSxDQUFBO1VBV0EsQ0FBQSxvQkFBQSxDQUFBO1VBVUEsQ0FBQSxpQkFBQSxDQUFBLHNCQS9PSTs7Ozs7OztVQTBQSixDQUFBLGdCQUFBLENBQUE7TUExUEksSUFBQyxDQUFBLFNBQUQsR0FBYSxRQUFRLENBQUM7TUFDdEIsSUFBQyxDQUFBLEtBQUQsR0FBYSxJQUFBLENBQUs7UUFBQSxLQUFBLEVBQU8sT0FBUDtRQUFnQixRQUFBLEVBQVU7TUFBMUIsQ0FBTDtNQUNiLElBQUMsQ0FBQSxNQUFELEdBQWEsR0FBRyxDQUFDO01BQ2pCLElBQUMsQ0FBQSxPQUFELEdBQWEsR0FBRyxDQUFDO01BRWpCLElBQWtDLEdBQUcsQ0FBQyxLQUF0QztRQUFBLElBQUMsQ0FBQSxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQWpCLENBQXFC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akI7QUFIakMsYUFJUyxNQUpUO2lCQUlpQyxTQUFBLENBQVUsS0FBVixFQUFpQixJQUFDLENBQUEsTUFBRCxDQUFRLElBQUMsQ0FBQSxRQUFELENBQUEsQ0FBUixFQUFxQjtZQUFBLGVBQUEsRUFBZ0I7VUFBaEIsQ0FBckIsQ0FBakI7QUFKakMsYUFLUyxJQUxUO2lCQUtpQyxTQUFBLENBQVUsS0FBVixFQUFpQixJQUFDLENBQUEsTUFBRCxDQUFRLElBQUMsQ0FBQSxRQUFELENBQUEsQ0FBUixFQUFxQjtZQUFBLGVBQUEsRUFBZ0I7VUFBaEIsQ0FBckIsQ0FBakI7QUFMakMsYUFNUyxPQU5UO0FBQUEsYUFNa0IsT0FObEI7aUJBTWlDLFNBQUEsQ0FBVSxLQUFWLEVBQWlCLElBQUMsQ0FBQSx1QkFBRCxDQUFBLENBQWpCO0FBTmpDLGFBT1MsTUFQVDtpQkFPaUMsU0FBQSxDQUFVLEtBQVYsRUFBaUIsSUFBQyxDQUFBLFlBQUQsQ0FBQSxDQUFqQjtBQVBqQyxhQVFTLE9BUlQ7aUJBUWlDLFNBQUEsQ0FBVSxLQUFWLEVBQWlCLElBQUMsQ0FBQSxhQUFELENBQUEsQ0FBakI7QUFSakM7SUFKTzs7RUE5UGY7O0VBNFFBLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0lBQUEsSUFBQSxFQUFNLFFBQUEsQ0FBQyxHQUFELENBQUE7YUFBUyxJQUFJLEtBQUosQ0FBVSxHQUFWO0lBQVQ7RUFBTjtBQXRSakIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMFxuMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCBcbjAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgXG4wMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgIFxuIyMjXG5cbnsgcG9zdCwgc3RvcEV2ZW50LCBrZXlpbmZvLCBlbXB0eSwgZWxlbSwgbWVudSwgb3MgfSA9IHJlcXVpcmUgJy4va3hrJ1xuXG5jbGFzcyBQb3B1cFxuICAgIFxuICAgIGNvbnN0cnVjdG9yOiAob3B0KSAtPlxuICAgICAgICBcbiAgICAgICAgQGZvY3VzRWxlbSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRcbiAgICAgICAgQGl0ZW1zICAgICA9IGVsZW0gY2xhc3M6ICdwb3B1cCcsIHRhYmluZGV4OiAzXG4gICAgICAgIEBwYXJlbnQgICAgPSBvcHQucGFyZW50XG4gICAgICAgIEBvbkNsb3NlICAgPSBvcHQub25DbG9zZVxuICAgICAgICBcbiAgICAgICAgQGl0ZW1zLmNsYXNzTGlzdC5hZGQgb3B0LmNsYXNzIGlmIG9wdC5jbGFzc1xuICAgICAgICBcbiAgICAgICAgZm9yIGl0ZW0gaW4gb3B0Lml0ZW1zXG4gICAgICAgICAgICBjb250aW51ZSBpZiBpdGVtLmhpZGVcbiAgICAgICAgICAgIGlmIGVtcHR5KGl0ZW0udGV4dCkgYW5kIGVtcHR5KGl0ZW0uaHRtbClcbiAgICAgICAgICAgICAgICBkaXYgPSBlbGVtICdocicsIGNsYXNzOiAncG9wdXBJdGVtIHNlcGFyYXRvcidcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBkaXYgPSBlbGVtIGNsYXNzOiAncG9wdXBJdGVtJywgdGV4dDogaXRlbS50ZXh0XG4gICAgICAgICAgICAgICAgaWYgbm90IGVtcHR5IGl0ZW0uaHRtbFxuICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gaXRlbS5odG1sIFxuICAgICAgICAgICAgICAgIGRpdi5pdGVtID0gaXRlbVxuICAgICAgICAgICAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyICdjbGljaycsIEBvbkNsaWNrXG4gICAgICAgICAgICAgICAgaWYgaXRlbS5jb21ibyA/IGl0ZW0uYWNjZWxcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IGtleWluZm8uc2hvcnQgaWYgb3MucGxhdGZvcm0oKSA9PSAnZGFyd2luJ1xuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5jb21ibyA/IGl0ZW0uYWNjZWxcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5hY2NlbCA/IGl0ZW0uY29tYm9cbiAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkIGVsZW0gJ3NwYW4nLCBjbGFzczoncG9wdXBDb21ibycsIHRleHQ6dGV4dFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgaXRlbS5tZW51IFxuICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQgZWxlbSAnc3BhbicsIGNsYXNzOidwb3B1cENvbWJvJywgdGV4dDon4pa2J1xuICAgICAgICAgICAgQGl0ZW1zLmFwcGVuZENoaWxkIGRpdlxuXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgQGl0ZW1zXG4gICAgICAgIEBpdGVtcy5hZGRFdmVudExpc3RlbmVyICdjb250ZXh0bWVudScsIEBvbkNvbnRleHRNZW51XG4gICAgICAgIEBpdGVtcy5hZGRFdmVudExpc3RlbmVyICdrZXlkb3duJywgICAgIEBvbktleURvd25cbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ2ZvY3Vzb3V0JywgICAgQG9uRm9jdXNPdXRcbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlb3ZlcicsICAgQG9uSG92ZXJcbiAgICAgICAgXG4gICAgICAgIGJyID0gQGl0ZW1zLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAgIFxuICAgICAgICBpZiBvcHQueCtici53aWR0aCA+IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUubGVmdCA9IFwiI3tkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC0gYnIud2lkdGh9cHhcIlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUubGVmdCA9IFwiI3tvcHQueH1weFwiIFxuICAgICAgICAgICBcbiAgICAgICAgaWYgb3B0LnkrYnIuaGVpZ2h0ID4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHRcbiAgICAgICAgICAgIEBpdGVtcy5zdHlsZS50b3AgPSBcIiN7ZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSBici5oZWlnaHR9cHhcIlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUudG9wID0gXCIje29wdC55fXB4XCJcbiAgICAgICAgXG4gICAgICAgIGlmIG9wdC5zZWxlY3RGaXJzdEl0ZW0gIT0gZmFsc2VcbiAgICAgICAgICAgIEBzZWxlY3QgQGl0ZW1zLmZpcnN0Q2hpbGQsIHNlbGVjdEZpcnN0SXRlbTpmYWxzZVxuICAgICAgICAgICAgXG4gICAgICAgIHBvc3QuZW1pdCAncG9wdXAnLCAnb3BlbmVkJ1xuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGNsb3NlOiAob3B0PXt9KT0+XG4gICAgICAgIFxuICAgICAgICBpZiBlbXB0eShAcGFyZW50KSBvciBAcGFyZW50TWVudSgpPy5lbGVtPy5jbGFzc0xpc3QuY29udGFpbnMgJ21lbnUnXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3BvcHVwJywgJ2Nsb3NlZCdcbiAgICAgICAgICAgIEBvbkNsb3NlPygpXG4gICAgICAgIFxuICAgICAgICBAcG9wdXA/LmNsb3NlIGZvY3VzOmZhbHNlXG4gICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgXG4gICAgICAgIEBpdGVtcz8ucmVtb3ZlRXZlbnRMaXN0ZW5lciAna2V5ZG93bicsICAgQG9uS2V5RG93blxuICAgICAgICBAaXRlbXM/LnJlbW92ZUV2ZW50TGlzdGVuZXIgJ2ZvY3Vzb3V0JywgIEBvbkZvY3VzT3V0XG4gICAgICAgIEBpdGVtcz8ucmVtb3ZlRXZlbnRMaXN0ZW5lciAnbW91c2VvdmVyJywgQG9uSG92ZXJcbiAgICAgICAgQGl0ZW1zPy5yZW1vdmUoKVxuICAgICAgICBkZWxldGUgQGl0ZW1zXG4gICAgICAgIFxuICAgICAgICBAcGFyZW50Py5jaGlsZENsb3NlZCBALCBvcHRcbiAgICAgICAgXG4gICAgICAgIGlmIG9wdC5hbGxcbiAgICAgICAgICAgIGlmIEBwYXJlbnQ/XG4gICAgICAgICAgICAgICAgQHBhcmVudC5jbG9zZSBvcHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIGlmIG9wdC5mb2N1cyAhPSBmYWxzZSBhbmQgbm90IEBwYXJlbnRcbiAgICAgICAgICAgIEBmb2N1c0VsZW0/LmZvY3VzKCkgXG5cbiAgICBjaGlsZENsb3NlZDogKGNoaWxkLCBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICBpZiBjaGlsZCA9PSBAcG9wdXBcbiAgICAgICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgICAgIGlmIG9wdC5mb2N1cyAhPSBmYWxzZVxuICAgICAgICAgICAgICAgIEBmb2N1cygpXG4gICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjICAgICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgc2VsZWN0OiAoaXRlbSwgb3B0PXt9KSAtPlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBpdGVtP1xuICAgICAgICBcbiAgICAgICAgaWYgQHBvcHVwP1xuICAgICAgICAgICAgQHBvcHVwLmNsb3NlIGZvY3VzOmZhbHNlXG4gICAgICAgIFxuICAgICAgICBAc2VsZWN0ZWQ/LmNsYXNzTGlzdC5yZW1vdmUgJ3NlbGVjdGVkJ1xuICAgICAgICBAc2VsZWN0ZWQgPSBpdGVtXG4gICAgICAgIEBzZWxlY3RlZC5jbGFzc0xpc3QuYWRkICdzZWxlY3RlZCdcbiAgICAgICAgXG4gICAgICAgIGlmIGl0ZW0uaXRlbT8ubWVudSBhbmQgb3B0Lm9wZW4gIT0gZmFsc2VcbiAgICAgICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgICAgIEBwb3B1cENoaWxkIGl0ZW0sIG9wdFxuICAgICAgICAgICAgXG4gICAgICAgIEBmb2N1cygpXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcG9wdXBDaGlsZDogKGl0ZW0sIG9wdD17fSkgLT4gXG4gICAgICAgIFxuICAgICAgICBpZiBpdGVtcyA9IGl0ZW0uaXRlbS5tZW51XG4gICAgICAgICAgICBpZiBAcG9wdXBcbiAgICAgICAgICAgICAgICBAY2xvc2VQb3B1cCgpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgYnIgPSBpdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAgICAgICAgICAgQHBvcHVwID0gbmV3IFBvcHVwIGl0ZW1zOml0ZW1zLCBwYXJlbnQ6QCwgeDpici5sZWZ0K2JyLndpZHRoLCB5OmJyLnRvcCwgc2VsZWN0Rmlyc3RJdGVtOm9wdD8uc2VsZWN0Rmlyc3RJdGVtXG5cbiAgICBjbG9zZVBvcHVwOiAtPlxuICAgICAgICBcbiAgICAgICAgQHBvcHVwPy5jbG9zZSBmb2N1czpmYWxzZVxuICAgICAgICBkZWxldGUgQHBvcHVwXG5cbiAgICAjIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAwMCAgIDAwMCAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgbmF2aWdhdGVMZWZ0OiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQHBvcHVwIFxuICAgICAgICAgICAgQGNsb3NlUG9wdXAoKVxuICAgICAgICBlbHNlIGlmIG1lbnUgPSBAcGFyZW50TWVudSgpXG4gICAgICAgICAgICBtZW51Lm5hdmlnYXRlTGVmdCgpXG4gICAgICAgIGVsc2UgaWYgQHBhcmVudFxuICAgICAgICAgICAgQGNsb3NlIGZvY3VzOmZhbHNlXG5cbiAgICBhY3RpdmF0ZU9yTmF2aWdhdGVSaWdodDogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBzZWxlY3RlZD9cbiAgICAgICAgICAgIGlmIG5vdCBAc2VsZWN0ZWQuaXRlbS5tZW51XG4gICAgICAgICAgICAgICAgQGFjdGl2YXRlIEBzZWxlY3RlZFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBuYXZpZ2F0ZVJpZ2h0KClcbiAgICAgICAgICAgIFxuICAgIG5hdmlnYXRlUmlnaHQ6IC0+XG4gICAgICAgIGlmIEBwb3B1cFxuICAgICAgICAgICAgQHBvcHVwLnNlbGVjdCBAcG9wdXAuaXRlbXMuZmlyc3RDaGlsZFxuICAgICAgICBlbHNlIGlmIEBzZWxlY3RlZD8uaXRlbS5tZW51XG4gICAgICAgICAgICBAc2VsZWN0IEBzZWxlY3RlZCwgc2VsZWN0Rmlyc3RJdGVtOnRydWVcbiAgICAgICAgZWxzZSBpZiBtZW51ID0gQHBhcmVudE1lbnUoKVxuICAgICAgICAgICAgbWVudS5uYXZpZ2F0ZVJpZ2h0KClcbiAgICAgICAgICAgIFxuICAgIHBhcmVudE1lbnU6IC0+IFxuICAgICAgICBpZiBAcGFyZW50PyBhbmQgbm90IEBwYXJlbnQucGFyZW50XG4gICAgICAgICAgICBAcGFyZW50XG4gICAgICAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDAgICAgICAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICAgICAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgMCAgICAgIFxuICAgIFxuICAgIG5leHRJdGVtOiAtPlxuICAgICAgICBpZiBuZXh0ID0gQHNlbGVjdGVkXG4gICAgICAgICAgICB3aGlsZSBuZXh0ID0gbmV4dC5uZXh0U2libGluZ1xuICAgICAgICAgICAgICAgIGlmIG5vdCBlbXB0eSBuZXh0Lml0ZW0/LnRleHRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHRcbiAgICBcbiAgICBwcmV2SXRlbTogLT5cbiAgICAgICAgaWYgcHJldiA9IEBzZWxlY3RlZFxuICAgICAgICAgICAgd2hpbGUgcHJldiA9IHByZXYucHJldmlvdXNTaWJsaW5nXG4gICAgICAgICAgICAgICAgaWYgbm90IGVtcHR5IHByZXYuaXRlbT8udGV4dFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldlxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgYWN0aXZhdGU6IChpdGVtKSAtPlxuXG4gICAgICAgIGlmIGl0ZW0uaXRlbT8uY2I/XG4gICAgICAgICAgICBAY2xvc2UgYWxsOnRydWVcbiAgICAgICAgICAgIGl0ZW0uaXRlbS5jYiBpdGVtLml0ZW0uYXJnID8gaXRlbS5pdGVtLnRleHRcbiAgICAgICAgZWxzZSBpZiBub3QgaXRlbS5pdGVtLm1lbnVcbiAgICAgICAgICAgIEBjbG9zZSBhbGw6dHJ1ZVxuICAgICAgICAgICAgcG9zdC5lbWl0ICdtZW51QWN0aW9uJywgaXRlbS5pdGVtLmFjdGlvbiA/IGl0ZW0uaXRlbS50ZXh0LCBpdGVtLml0ZW1cblxuICAgIHRvZ2dsZTogKGl0ZW0pIC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAcG9wdXBcbiAgICAgICAgICAgIEBwb3B1cC5jbG9zZSBmb2N1czpmYWxzZVxuICAgICAgICAgICAgZGVsZXRlIEBwb3B1cFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc2VsZWN0IGl0ZW0sIHNlbGVjdEZpcnN0SXRlbTpmYWxzZVxuICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgXG4gICAgICAgICAgICBcbiAgICBvbkhvdmVyOiAoZXZlbnQpID0+IFxuICAgIFxuICAgICAgICBpdGVtID0gZWxlbS51cEVsZW0gZXZlbnQudGFyZ2V0LCBwcm9wOidpdGVtJ1xuICAgICAgICBpZiBpdGVtXG4gICAgICAgICAgICBAc2VsZWN0IGl0ZW0sIHNlbGVjdEZpcnN0SXRlbTpmYWxzZSAgIFxuXG4gICAgb25DbGljazogKGV2ZW50KSA9PiBcblxuICAgICAgICBzdG9wRXZlbnQgZXZlbnQgXG4gICAgICAgIFxuICAgICAgICBpdGVtID0gZWxlbS51cEVsZW0gZXZlbnQudGFyZ2V0LCBwcm9wOidpdGVtJ1xuICAgICAgICBpZiBpdGVtXG4gICAgICAgICAgICBpZiBpdGVtLml0ZW0ubWVudVxuICAgICAgICAgICAgICAgIEB0b2dnbGUgaXRlbVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBhY3RpdmF0ZSBpdGVtXG4gICAgICAgICAgICAgICAgXG4gICAgb25Db250ZXh0TWVudTogKGV2ZW50KSA9PiBzdG9wRXZlbnQgZXZlbnQgIyBwcmV2ZW50cyBtdWx0aXBsZSBwb3B1cHNcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgIFxuICAgIGZvY3VzOiAtPiBAaXRlbXM/LmZvY3VzKClcbiAgICBcbiAgICBvbkZvY3VzT3V0OiAoZXZlbnQpID0+IFxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGV2ZW50LnJlbGF0ZWRUYXJnZXQ/LmNsYXNzTGlzdC5jb250YWlucyAncG9wdXAnXG4gICAgICAgICAgICBAY2xvc2UgYWxsOnRydWUsIGZvY3VzOmZhbHNlXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbktleURvd246IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHsgbW9kLCBrZXksIGNvbWJvIH0gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgIHdoZW4gJ2VuZCcsICdwYWdlIGRvd24nIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBpdGVtcy5sYXN0Q2hpbGQsIHNlbGVjdEZpcnN0SXRlbTpmYWxzZSBcbiAgICAgICAgICAgIHdoZW4gJ2hvbWUnLCAncGFnZSB1cCcgIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBpdGVtcy5maXJzdENoaWxkLCBzZWxlY3RGaXJzdEl0ZW06ZmFsc2UgXG4gICAgICAgICAgICB3aGVuICdlc2MnICAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ2Rvd24nICAgICAgICAgICAgIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBuZXh0SXRlbSgpLCBzZWxlY3RGaXJzdEl0ZW06ZmFsc2UgXG4gICAgICAgICAgICB3aGVuICd1cCcgICAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQHNlbGVjdCBAcHJldkl0ZW0oKSwgc2VsZWN0Rmlyc3RJdGVtOmZhbHNlIFxuICAgICAgICAgICAgd2hlbiAnZW50ZXInLCAnc3BhY2UnICAgdGhlbiBzdG9wRXZlbnQgZXZlbnQsIEBhY3RpdmF0ZU9yTmF2aWdhdGVSaWdodCgpXG4gICAgICAgICAgICB3aGVuICdsZWZ0JyAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQG5hdmlnYXRlTGVmdCgpXG4gICAgICAgICAgICB3aGVuICdyaWdodCcgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQG5hdmlnYXRlUmlnaHQoKVxuICAgICAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IG1lbnU6IChvcHQpIC0+IG5ldyBQb3B1cCBvcHRcbiJdfQ==
//# sourceURL=../coffee/popup.coffee