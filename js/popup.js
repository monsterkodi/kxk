(function() {
  /*
  00000000    0000000   00000000   000   000  00000000 
  000   000  000   000  000   000  000   000  000   000
  00000000   000   000  00000000   000   000  00000000 
  000        000   000  000        000   000  000      
  000         0000000   000         0000000   000      
  */
  var Popup, elem, empty, keyinfo, log, post, stopEvent;

  ({post, empty, stopEvent, keyinfo, elem, log} = require('./kxk'));

  Popup = class Popup {
    constructor(opt) {
      var br, div, i, item, len, ref, ref1, ref2;
      
      //  0000000  000       0000000    0000000  00000000  
      // 000       000      000   000  000       000       
      // 000       000      000   000  0000000   0000000   
      // 000       000      000   000       000  000       
      //  0000000  0000000   0000000   0000000   00000000  
      this.close = this.close.bind(this);
      
      // 00     00   0000000   000   000   0000000  00000000    
      // 000   000  000   000  000   000  000       000         
      // 000000000  000   000  000   000  0000000   0000000     
      // 000 0 000  000   000  000   000       000  000         
      // 000   000   0000000    0000000   0000000   00000000    
      this.onHover = this.onHover.bind(this);
      this.onClick = this.onClick.bind(this);
      this.onContextMenu = this.onContextMenu.bind(this);
      this.onFocusOut = this.onFocusOut.bind(this);
      
      // 000   000  00000000  000   000  
      // 000  000   000        000 000   
      // 0000000    0000000     00000    
      // 000  000   000          000     
      // 000   000  00000000     000     
      this.onKeyDown = this.onKeyDown.bind(this);
      this.focusElem = document.activeElement;
      this.items = elem({
        class: 'popup',
        tabindex: 3
      });
      this.parent = opt.parent;
      this.onClose = opt.onClose;
      if (opt.class) {
        this.items.classList.add(opt.class);
      }
      ref = opt.items;
      for (i = 0, len = ref.length; i < len; i++) {
        item = ref[i];
        if (item.hide) {
          continue;
        }
        if (empty(item.text) && empty(item.html)) {
          div = elem('hr', {
            class: 'popupItem separator'
          });
        } else {
          div = elem({
            class: 'popupItem',
            text: item.text
          });
          if (!empty(item.html)) {
            div.innerHTML = item.html;
          }
          div.item = item;
          div.addEventListener('click', this.onClick);
          if ((ref1 = item.combo) != null ? ref1 : item.accel) {
            div.appendChild(elem('span', {
              class: 'popupCombo',
              text: keyinfo.short((ref2 = item.combo) != null ? ref2 : item.accel)
            }));
          } else if (item.menu) {
            div.appendChild(elem('span', {
              class: 'popupCombo',
              text: 'â–¶'
            }));
          }
        }
        this.items.appendChild(div);
      }
      document.body.appendChild(this.items);
      this.items.addEventListener('contextmenu', this.onContextMenu);
      this.items.addEventListener('keydown', this.onKeyDown);
      this.items.addEventListener('focusout', this.onFocusOut);
      this.items.addEventListener('mouseover', this.onHover);
      br = this.items.getBoundingClientRect();
      if (opt.x + br.width > document.body.clientWidth) {
        this.items.style.left = `${document.body.clientWidth - br.width}px`;
      } else {
        this.items.style.left = `${opt.x}px`;
      }
      if (opt.y + br.height > document.body.clientHeight) {
        this.items.style.top = `${document.body.clientHeight - br.height}px`;
      } else {
        this.items.style.top = `${opt.y}px`;
      }
      if (opt.selectFirstItem !== false) {
        this.select(this.items.firstChild, {
          selectFirstItem: false
        });
      }
      post.emit('popup', 'opened');
    }

    close(opt = {}) {
      var ref, ref1, ref2, ref3, ref4, ref5, ref6, ref7, ref8;
      if (empty(this.parent) || ((ref = this.parentMenu()) != null ? (ref1 = ref.elem) != null ? ref1.classList.contains('menu') : void 0 : void 0)) {
        post.emit('popup', 'closed');
        if (typeof this.onClose === "function") {
          this.onClose();
        }
      }
      if ((ref2 = this.popup) != null) {
        ref2.close({
          focus: false
        });
      }
      delete this.popup;
      if ((ref3 = this.items) != null) {
        ref3.removeEventListener('keydown', this.onKeyDown);
      }
      if ((ref4 = this.items) != null) {
        ref4.removeEventListener('focusout', this.onFocusOut);
      }
      if ((ref5 = this.items) != null) {
        ref5.removeEventListener('mouseover', this.onHover);
      }
      if ((ref6 = this.items) != null) {
        ref6.remove();
      }
      delete this.items;
      if ((ref7 = this.parent) != null) {
        ref7.childClosed(this, opt);
      }
      if (opt.all) {
        if (this.parent != null) {
          this.parent.close(opt);
        }
      }
      if (opt.focus !== false && !this.parent) {
        return (ref8 = this.focusElem) != null ? ref8.focus() : void 0;
      }
    }

    childClosed(child, opt) {
      if (child === this.popup) {
        delete this.popup;
        if (opt.focus !== false) {
          return this.focus();
        }
      }
    }

    
    //  0000000  00000000  000      00000000   0000000  000000000  
    // 000       000       000      000       000          000     
    // 0000000   0000000   000      0000000   000          000     
    //      000  000       000      000       000          000     
    // 0000000   00000000  0000000  00000000   0000000     000     
    select(item, opt = {}) {
      var ref, ref1;
      if (item == null) {
        return;
      }
      if (this.popup != null) {
        this.popup.close({
          focus: false
        });
      }
      if ((ref = this.selected) != null) {
        ref.classList.remove('selected');
      }
      this.selected = item;
      this.selected.classList.add('selected');
      if (((ref1 = item.item) != null ? ref1.menu : void 0) && opt.open !== false) {
        delete this.popup;
        this.popupChild(item, opt);
      }
      return this.focus();
    }

    
    // 00000000    0000000   00000000   000   000  00000000    0000000  000   000  000  000      0000000    
    // 000   000  000   000  000   000  000   000  000   000  000       000   000  000  000      000   000  
    // 00000000   000   000  00000000   000   000  00000000   000       000000000  000  000      000   000  
    // 000        000   000  000        000   000  000        000       000   000  000  000      000   000  
    // 000         0000000   000         0000000   000         0000000  000   000  000  0000000  0000000    
    popupChild(item, opt = {}) {
      var br, items;
      if (items = item.item.menu) {
        if (this.popup) {
          return this.closePopup();
        } else {
          br = item.getBoundingClientRect();
          return this.popup = new Popup({
            items: items,
            parent: this,
            x: br.left + br.width,
            y: br.top,
            selectFirstItem: opt != null ? opt.selectFirstItem : void 0
          });
        }
      }
    }

    closePopup() {
      var ref;
      if ((ref = this.popup) != null) {
        ref.close({
          focus: false
        });
      }
      return delete this.popup;
    }

    // 000   000   0000000   000   000  000   0000000    0000000   000000000  00000000  
    // 0000  000  000   000  000   000  000  000        000   000     000     000       
    // 000 0 000  000000000   000 000   000  000  0000  000000000     000     0000000   
    // 000  0000  000   000     000     000  000   000  000   000     000     000       
    // 000   000  000   000      0      000   0000000   000   000     000     00000000  
    navigateLeft() {
      var menu;
      if (this.popup) {
        return this.closePopup();
      } else if (menu = this.parentMenu()) {
        return menu.navigateLeft();
      } else if (this.parent) {
        return this.close({
          focus: false
        });
      }
    }

    activateOrNavigateRight() {
      if (this.selected != null) {
        if (!this.selected.item.menu) {
          return this.activate(this.selected);
        } else {
          return this.navigateRight();
        }
      }
    }

    navigateRight() {
      var menu, ref;
      if (this.popup) {
        return this.popup.select(this.popup.items.firstChild);
      } else if ((ref = this.selected) != null ? ref.item.menu : void 0) {
        return this.select(this.selected, {
          selectFirstItem: true
        });
      } else if (menu = this.parentMenu()) {
        return menu.navigateRight();
      }
    }

    parentMenu() {
      if ((this.parent != null) && !this.parent.parent) {
        return this.parent;
      }
    }

    
    // 000   000  00000000  000   000  000000000        00000000   00000000   00000000  000   000  
    // 0000  000  000        000 000      000           000   000  000   000  000       000   000  
    // 000 0 000  0000000     00000       000           00000000   0000000    0000000    000 000   
    // 000  0000  000        000 000      000           000        000   000  000          000     
    // 000   000  00000000  000   000     000           000        000   000  00000000      0      
    nextItem() {
      var next, ref;
      if (next = this.selected) {
        while (next = next.nextSibling) {
          if (!empty((ref = next.item) != null ? ref.text : void 0)) {
            return next;
          }
        }
      }
    }

    prevItem() {
      var prev, ref;
      if (prev = this.selected) {
        while (prev = prev.previousSibling) {
          if (!empty((ref = prev.item) != null ? ref.text : void 0)) {
            return prev;
          }
        }
      }
    }

    
    //  0000000    0000000  000000000  000  000   000   0000000   000000000  00000000  
    // 000   000  000          000     000  000   000  000   000     000     000       
    // 000000000  000          000     000   000 000   000000000     000     0000000   
    // 000   000  000          000     000     000     000   000     000     000       
    // 000   000   0000000     000     000      0      000   000     000     00000000  
    activate(item) {
      var ref, ref1, ref2;
      if (((ref = item.item) != null ? ref.cb : void 0) != null) {
        this.close({
          all: true
        });
        return item.item.cb((ref1 = item.item.arg) != null ? ref1 : item.item.text);
      } else if (!item.item.menu) {
        this.close({
          all: true
        });
        return post.emit('menuAction', (ref2 = item.item.action) != null ? ref2 : item.item.text, item.item);
      }
    }

    toggle(item) {
      if (this.popup) {
        this.popup.close({
          focus: false
        });
        return delete this.popup;
      } else {
        return this.select(item, {
          selectFirstItem: false
        });
      }
    }

    onHover(event) {
      var item;
      item = elem.upElem(event.target, {
        prop: 'item'
      });
      if (item) {
        return this.select(item, {
          selectFirstItem: false
        });
      }
    }

    onClick(event) {
      var item;
      stopEvent(event);
      item = elem.upElem(event.target, {
        prop: 'item'
      });
      if (item) {
        if (item.item.menu) {
          return this.toggle(item);
        } else {
          return this.activate(item);
        }
      }
    }

    onContextMenu(event) {
      return stopEvent(event); // prevents multiple popups
    }

    
    // 00000000   0000000    0000000  000   000   0000000  
    // 000       000   000  000       000   000  000       
    // 000000    000   000  000       000   000  0000000   
    // 000       000   000  000       000   000       000  
    // 000        0000000    0000000   0000000   0000000   
    focus() {
      var ref;
      return (ref = this.items) != null ? ref.focus() : void 0;
    }

    onFocusOut(event) {
      var ref;
      if (!((ref = event.relatedTarget) != null ? ref.classList.contains('popup') : void 0)) {
        return this.close({
          all: true,
          focus: false
        });
      }
    }

    onKeyDown(event) {
      var combo, key, mod;
      ({mod, key, combo} = keyinfo.forEvent(event));
      switch (combo) {
        case 'end':
        case 'page down':
          return stopEvent(event, this.select(this.items.lastChild, {
            selectFirstItem: false
          }));
        case 'home':
        case 'page up':
          return stopEvent(event, this.select(this.items.firstChild, {
            selectFirstItem: false
          }));
        case 'esc':
          return stopEvent(event, this.close());
        case 'down':
          return stopEvent(event, this.select(this.nextItem(), {
            selectFirstItem: false
          }));
        case 'up':
          return stopEvent(event, this.select(this.prevItem(), {
            selectFirstItem: false
          }));
        case 'enter':
        case 'space':
          return stopEvent(event, this.activateOrNavigateRight());
        case 'left':
          return stopEvent(event, this.navigateLeft());
        case 'right':
          return stopEvent(event, this.navigateRight());
      }
    }

  };

  module.exports = {
    menu: function(opt) {
      return new Popup(opt);
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3BvcHVwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxLQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQTs7RUFRQSxDQUFBLENBQUUsSUFBRixFQUFRLEtBQVIsRUFBZSxTQUFmLEVBQTBCLE9BQTFCLEVBQW1DLElBQW5DLEVBQXlDLEdBQXpDLENBQUEsR0FBaUQsT0FBQSxDQUFRLE9BQVIsQ0FBakQ7O0VBRU0sUUFBTixNQUFBLE1BQUE7SUFFSSxXQUFhLENBQUMsR0FBRCxDQUFBO0FBRVQsVUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQTs7Ozs7OztVQW9ESixDQUFBLFlBQUEsQ0FBQSxpQkFwREk7Ozs7Ozs7VUFnTkosQ0FBQSxjQUFBLENBQUE7VUFNQSxDQUFBLGNBQUEsQ0FBQTtVQVdBLENBQUEsb0JBQUEsQ0FBQTtVQVVBLENBQUEsaUJBQUEsQ0FBQSxzQkEzT0k7Ozs7Ozs7VUFzUEosQ0FBQSxnQkFBQSxDQUFBO01BdFBJLElBQUMsQ0FBQSxTQUFELEdBQWEsUUFBUSxDQUFDO01BQ3RCLElBQUMsQ0FBQSxLQUFELEdBQWEsSUFBQSxDQUFLO1FBQUEsS0FBQSxFQUFPLE9BQVA7UUFBZ0IsUUFBQSxFQUFVO01BQTFCLENBQUw7TUFDYixJQUFDLENBQUEsTUFBRCxHQUFhLEdBQUcsQ0FBQztNQUNqQixJQUFDLENBQUEsT0FBRCxHQUFhLEdBQUcsQ0FBQztNQUVqQixJQUFrQyxHQUFHLENBQUMsS0FBdEM7UUFBQSxJQUFDLENBQUEsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFqQixDQUFxQixHQUFHLENBQUMsS0FBekIsRUFBQTs7QUFFQTtNQUFBLEtBQUEscUNBQUE7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ZUFBQSxFQUFnQjtVQUFoQixDQUFyQixDQUFqQjtBQUpqQyxhQUtTLElBTFQ7aUJBS2lDLFNBQUEsQ0FBVSxLQUFWLEVBQWlCLElBQUMsQ0FBQSxNQUFELENBQVEsSUFBQyxDQUFBLFFBQUQsQ0FBQSxDQUFSLEVBQXFCO1lBQUEsZUFBQSxFQUFnQjtVQUFoQixDQUFyQixDQUFqQjtBQUxqQyxhQU1TLE9BTlQ7QUFBQSxhQU1rQixPQU5sQjtpQkFNaUMsU0FBQSxDQUFVLEtBQVYsRUFBaUIsSUFBQyxDQUFBLHVCQUFELENBQUEsQ0FBakI7QUFOakMsYUFPUyxNQVBUO2lCQU9pQyxTQUFBLENBQVUsS0FBVixFQUFpQixJQUFDLENBQUEsWUFBRCxDQUFBLENBQWpCO0FBUGpDLGFBUVMsT0FSVDtpQkFRaUMsU0FBQSxDQUFVLEtBQVYsRUFBaUIsSUFBQyxDQUFBLGFBQUQsQ0FBQSxDQUFqQjtBQVJqQztJQUpPOztFQTFQZjs7RUF3UUEsTUFBTSxDQUFDLE9BQVAsR0FBaUI7SUFBQSxJQUFBLEVBQU0sUUFBQSxDQUFDLEdBQUQsQ0FBQTthQUFTLElBQUksS0FBSixDQUFVLEdBQVY7SUFBVDtFQUFOO0FBbFJqQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4wMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwIFxuMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICBcbjAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgXG4jIyNcblxueyBwb3N0LCBlbXB0eSwgc3RvcEV2ZW50LCBrZXlpbmZvLCBlbGVtLCBsb2cgfSA9IHJlcXVpcmUgJy4va3hrJ1xuXG5jbGFzcyBQb3B1cFxuICAgIFxuICAgIGNvbnN0cnVjdG9yOiAob3B0KSAtPlxuICAgICAgICBcbiAgICAgICAgQGZvY3VzRWxlbSA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRcbiAgICAgICAgQGl0ZW1zICAgICA9IGVsZW0gY2xhc3M6ICdwb3B1cCcsIHRhYmluZGV4OiAzXG4gICAgICAgIEBwYXJlbnQgICAgPSBvcHQucGFyZW50XG4gICAgICAgIEBvbkNsb3NlICAgPSBvcHQub25DbG9zZVxuICAgICAgICBcbiAgICAgICAgQGl0ZW1zLmNsYXNzTGlzdC5hZGQgb3B0LmNsYXNzIGlmIG9wdC5jbGFzc1xuICAgICAgICBcbiAgICAgICAgZm9yIGl0ZW0gaW4gb3B0Lml0ZW1zXG4gICAgICAgICAgICBjb250aW51ZSBpZiBpdGVtLmhpZGVcbiAgICAgICAgICAgIGlmIGVtcHR5KGl0ZW0udGV4dCkgYW5kIGVtcHR5KGl0ZW0uaHRtbClcbiAgICAgICAgICAgICAgICBkaXYgPSBlbGVtICdocicsIGNsYXNzOiAncG9wdXBJdGVtIHNlcGFyYXRvcidcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBkaXYgPSBlbGVtIGNsYXNzOiAncG9wdXBJdGVtJywgdGV4dDogaXRlbS50ZXh0XG4gICAgICAgICAgICAgICAgaWYgbm90IGVtcHR5IGl0ZW0uaHRtbFxuICAgICAgICAgICAgICAgICAgICBkaXYuaW5uZXJIVE1MID0gaXRlbS5odG1sIFxuICAgICAgICAgICAgICAgIGRpdi5pdGVtID0gaXRlbVxuICAgICAgICAgICAgICAgIGRpdi5hZGRFdmVudExpc3RlbmVyICdjbGljaycsIEBvbkNsaWNrXG4gICAgICAgICAgICAgICAgaWYgaXRlbS5jb21ibyA/IGl0ZW0uYWNjZWxcbiAgICAgICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkIGVsZW0gJ3NwYW4nLCBjbGFzczoncG9wdXBDb21ibycsIHRleHQ6a2V5aW5mby5zaG9ydCBpdGVtLmNvbWJvID8gaXRlbS5hY2NlbFxuICAgICAgICAgICAgICAgIGVsc2UgaWYgaXRlbS5tZW51IFxuICAgICAgICAgICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQgZWxlbSAnc3BhbicsIGNsYXNzOidwb3B1cENvbWJvJywgdGV4dDon4pa2J1xuICAgICAgICAgICAgQGl0ZW1zLmFwcGVuZENoaWxkIGRpdlxuXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgQGl0ZW1zXG4gICAgICAgIEBpdGVtcy5hZGRFdmVudExpc3RlbmVyICdjb250ZXh0bWVudScsIEBvbkNvbnRleHRNZW51XG4gICAgICAgIEBpdGVtcy5hZGRFdmVudExpc3RlbmVyICdrZXlkb3duJywgICAgIEBvbktleURvd25cbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ2ZvY3Vzb3V0JywgICAgQG9uRm9jdXNPdXRcbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlb3ZlcicsICAgQG9uSG92ZXJcbiAgICAgICAgXG4gICAgICAgIGJyID0gQGl0ZW1zLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAgIFxuICAgICAgICBpZiBvcHQueCtici53aWR0aCA+IGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGggXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUubGVmdCA9IFwiI3tkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIC0gYnIud2lkdGh9cHhcIlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUubGVmdCA9IFwiI3tvcHQueH1weFwiIFxuICAgICAgICAgICBcbiAgICAgICAgaWYgb3B0LnkrYnIuaGVpZ2h0ID4gZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHRcbiAgICAgICAgICAgIEBpdGVtcy5zdHlsZS50b3AgPSBcIiN7ZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQgLSBici5oZWlnaHR9cHhcIlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAaXRlbXMuc3R5bGUudG9wID0gXCIje29wdC55fXB4XCJcbiAgICAgICAgXG4gICAgICAgIGlmIG9wdC5zZWxlY3RGaXJzdEl0ZW0gIT0gZmFsc2VcbiAgICAgICAgICAgIEBzZWxlY3QgQGl0ZW1zLmZpcnN0Q2hpbGQsIHNlbGVjdEZpcnN0SXRlbTpmYWxzZVxuICAgICAgICAgICAgXG4gICAgICAgIHBvc3QuZW1pdCAncG9wdXAnLCAnb3BlbmVkJ1xuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGNsb3NlOiAob3B0PXt9KT0+XG4gICAgICAgIFxuICAgICAgICBpZiBlbXB0eShAcGFyZW50KSBvciBAcGFyZW50TWVudSgpPy5lbGVtPy5jbGFzc0xpc3QuY29udGFpbnMgJ21lbnUnXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3BvcHVwJywgJ2Nsb3NlZCdcbiAgICAgICAgICAgIEBvbkNsb3NlPygpXG4gICAgICAgIFxuICAgICAgICBAcG9wdXA/LmNsb3NlIGZvY3VzOmZhbHNlXG4gICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgXG4gICAgICAgIEBpdGVtcz8ucmVtb3ZlRXZlbnRMaXN0ZW5lciAna2V5ZG93bicsICAgQG9uS2V5RG93blxuICAgICAgICBAaXRlbXM/LnJlbW92ZUV2ZW50TGlzdGVuZXIgJ2ZvY3Vzb3V0JywgIEBvbkZvY3VzT3V0XG4gICAgICAgIEBpdGVtcz8ucmVtb3ZlRXZlbnRMaXN0ZW5lciAnbW91c2VvdmVyJywgQG9uSG92ZXJcbiAgICAgICAgQGl0ZW1zPy5yZW1vdmUoKVxuICAgICAgICBkZWxldGUgQGl0ZW1zXG4gICAgICAgIFxuICAgICAgICBAcGFyZW50Py5jaGlsZENsb3NlZCBALCBvcHRcbiAgICAgICAgXG4gICAgICAgIGlmIG9wdC5hbGxcbiAgICAgICAgICAgIGlmIEBwYXJlbnQ/XG4gICAgICAgICAgICAgICAgQHBhcmVudC5jbG9zZSBvcHRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIGlmIG9wdC5mb2N1cyAhPSBmYWxzZSBhbmQgbm90IEBwYXJlbnRcbiAgICAgICAgICAgIEBmb2N1c0VsZW0/LmZvY3VzKCkgXG5cbiAgICBjaGlsZENsb3NlZDogKGNoaWxkLCBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICBpZiBjaGlsZCA9PSBAcG9wdXBcbiAgICAgICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgICAgIGlmIG9wdC5mb2N1cyAhPSBmYWxzZVxuICAgICAgICAgICAgICAgIEBmb2N1cygpXG4gICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjICAgICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgc2VsZWN0OiAoaXRlbSwgb3B0PXt9KSAtPlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBpdGVtP1xuICAgICAgICBcbiAgICAgICAgaWYgQHBvcHVwP1xuICAgICAgICAgICAgQHBvcHVwLmNsb3NlIGZvY3VzOmZhbHNlXG4gICAgICAgIFxuICAgICAgICBAc2VsZWN0ZWQ/LmNsYXNzTGlzdC5yZW1vdmUgJ3NlbGVjdGVkJ1xuICAgICAgICBAc2VsZWN0ZWQgPSBpdGVtXG4gICAgICAgIEBzZWxlY3RlZC5jbGFzc0xpc3QuYWRkICdzZWxlY3RlZCdcbiAgICAgICAgXG4gICAgICAgIGlmIGl0ZW0uaXRlbT8ubWVudSBhbmQgb3B0Lm9wZW4gIT0gZmFsc2VcbiAgICAgICAgICAgIGRlbGV0ZSBAcG9wdXBcbiAgICAgICAgICAgIEBwb3B1cENoaWxkIGl0ZW0sIG9wdFxuICAgICAgICAgICAgXG4gICAgICAgIEBmb2N1cygpXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcG9wdXBDaGlsZDogKGl0ZW0sIG9wdD17fSkgLT4gXG4gICAgICAgIFxuICAgICAgICBpZiBpdGVtcyA9IGl0ZW0uaXRlbS5tZW51XG4gICAgICAgICAgICBpZiBAcG9wdXBcbiAgICAgICAgICAgICAgICBAY2xvc2VQb3B1cCgpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgYnIgPSBpdGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAgICAgICAgICAgQHBvcHVwID0gbmV3IFBvcHVwIGl0ZW1zOml0ZW1zLCBwYXJlbnQ6QCwgeDpici5sZWZ0K2JyLndpZHRoLCB5OmJyLnRvcCwgc2VsZWN0Rmlyc3RJdGVtOm9wdD8uc2VsZWN0Rmlyc3RJdGVtXG5cbiAgICBjbG9zZVBvcHVwOiAtPlxuICAgICAgICBcbiAgICAgICAgQHBvcHVwPy5jbG9zZSBmb2N1czpmYWxzZVxuICAgICAgICBkZWxldGUgQHBvcHVwXG5cbiAgICAjIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMDAwMDAwMCAgIDAwMCAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgbmF2aWdhdGVMZWZ0OiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQHBvcHVwIFxuICAgICAgICAgICAgQGNsb3NlUG9wdXAoKVxuICAgICAgICBlbHNlIGlmIG1lbnUgPSBAcGFyZW50TWVudSgpXG4gICAgICAgICAgICBtZW51Lm5hdmlnYXRlTGVmdCgpXG4gICAgICAgIGVsc2UgaWYgQHBhcmVudFxuICAgICAgICAgICAgQGNsb3NlIGZvY3VzOmZhbHNlXG5cbiAgICBhY3RpdmF0ZU9yTmF2aWdhdGVSaWdodDogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBzZWxlY3RlZD9cbiAgICAgICAgICAgIGlmIG5vdCBAc2VsZWN0ZWQuaXRlbS5tZW51XG4gICAgICAgICAgICAgICAgQGFjdGl2YXRlIEBzZWxlY3RlZFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBuYXZpZ2F0ZVJpZ2h0KClcbiAgICAgICAgICAgIFxuICAgIG5hdmlnYXRlUmlnaHQ6IC0+XG4gICAgICAgIGlmIEBwb3B1cFxuICAgICAgICAgICAgQHBvcHVwLnNlbGVjdCBAcG9wdXAuaXRlbXMuZmlyc3RDaGlsZFxuICAgICAgICBlbHNlIGlmIEBzZWxlY3RlZD8uaXRlbS5tZW51XG4gICAgICAgICAgICBAc2VsZWN0IEBzZWxlY3RlZCwgc2VsZWN0Rmlyc3RJdGVtOnRydWVcbiAgICAgICAgZWxzZSBpZiBtZW51ID0gQHBhcmVudE1lbnUoKVxuICAgICAgICAgICAgbWVudS5uYXZpZ2F0ZVJpZ2h0KClcbiAgICAgICAgICAgIFxuICAgIHBhcmVudE1lbnU6IC0+IFxuICAgICAgICBpZiBAcGFyZW50PyBhbmQgbm90IEBwYXJlbnQucGFyZW50XG4gICAgICAgICAgICBAcGFyZW50XG4gICAgICAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwICAwMDAgIDAwMCAgICAgICAgMDAwIDAwMCAgICAgIDAwMCAgICAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAwMDAwICAgICAwMDAwMCAgICAgICAwMDAgICAgICAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAgICAgICAwMDAgMDAwICAgICAgMDAwICAgICAgICAgICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgICAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAgMCAgICAgIFxuICAgIFxuICAgIG5leHRJdGVtOiAtPlxuICAgICAgICBpZiBuZXh0ID0gQHNlbGVjdGVkXG4gICAgICAgICAgICB3aGlsZSBuZXh0ID0gbmV4dC5uZXh0U2libGluZ1xuICAgICAgICAgICAgICAgIGlmIG5vdCBlbXB0eSBuZXh0Lml0ZW0/LnRleHRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHRcbiAgICBcbiAgICBwcmV2SXRlbTogLT5cbiAgICAgICAgaWYgcHJldiA9IEBzZWxlY3RlZFxuICAgICAgICAgICAgd2hpbGUgcHJldiA9IHByZXYucHJldmlvdXNTaWJsaW5nXG4gICAgICAgICAgICAgICAgaWYgbm90IGVtcHR5IHByZXYuaXRlbT8udGV4dFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHJldlxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgMCAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgYWN0aXZhdGU6IChpdGVtKSAtPlxuXG4gICAgICAgIGlmIGl0ZW0uaXRlbT8uY2I/XG4gICAgICAgICAgICBAY2xvc2UgYWxsOnRydWVcbiAgICAgICAgICAgIGl0ZW0uaXRlbS5jYiBpdGVtLml0ZW0uYXJnID8gaXRlbS5pdGVtLnRleHRcbiAgICAgICAgZWxzZSBpZiBub3QgaXRlbS5pdGVtLm1lbnVcbiAgICAgICAgICAgIEBjbG9zZSBhbGw6dHJ1ZVxuICAgICAgICAgICAgcG9zdC5lbWl0ICdtZW51QWN0aW9uJywgaXRlbS5pdGVtLmFjdGlvbiA/IGl0ZW0uaXRlbS50ZXh0LCBpdGVtLml0ZW1cblxuICAgIHRvZ2dsZTogKGl0ZW0pIC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAcG9wdXBcbiAgICAgICAgICAgIEBwb3B1cC5jbG9zZSBmb2N1czpmYWxzZVxuICAgICAgICAgICAgZGVsZXRlIEBwb3B1cFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc2VsZWN0IGl0ZW0sIHNlbGVjdEZpcnN0SXRlbTpmYWxzZVxuICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgXG4gICAgICAgICAgICBcbiAgICBvbkhvdmVyOiAoZXZlbnQpID0+IFxuICAgIFxuICAgICAgICBpdGVtID0gZWxlbS51cEVsZW0gZXZlbnQudGFyZ2V0LCBwcm9wOidpdGVtJ1xuICAgICAgICBpZiBpdGVtXG4gICAgICAgICAgICBAc2VsZWN0IGl0ZW0sIHNlbGVjdEZpcnN0SXRlbTpmYWxzZSAgIFxuXG4gICAgb25DbGljazogKGV2ZW50KSA9PiBcblxuICAgICAgICBzdG9wRXZlbnQgZXZlbnQgXG4gICAgICAgIFxuICAgICAgICBpdGVtID0gZWxlbS51cEVsZW0gZXZlbnQudGFyZ2V0LCBwcm9wOidpdGVtJ1xuICAgICAgICBpZiBpdGVtXG4gICAgICAgICAgICBpZiBpdGVtLml0ZW0ubWVudVxuICAgICAgICAgICAgICAgIEB0b2dnbGUgaXRlbVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBhY3RpdmF0ZSBpdGVtXG4gICAgICAgICAgICAgICAgXG4gICAgb25Db250ZXh0TWVudTogKGV2ZW50KSA9PiBzdG9wRXZlbnQgZXZlbnQgIyBwcmV2ZW50cyBtdWx0aXBsZSBwb3B1cHNcblxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgIFxuICAgIGZvY3VzOiAtPiBAaXRlbXM/LmZvY3VzKClcbiAgICBcbiAgICBvbkZvY3VzT3V0OiAoZXZlbnQpID0+IFxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGV2ZW50LnJlbGF0ZWRUYXJnZXQ/LmNsYXNzTGlzdC5jb250YWlucyAncG9wdXAnXG4gICAgICAgICAgICBAY2xvc2UgYWxsOnRydWUsIGZvY3VzOmZhbHNlXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgIDAwMCAwMDAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgMDAwMDAgICAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBvbktleURvd246IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHsgbW9kLCBrZXksIGNvbWJvIH0gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgIHdoZW4gJ2VuZCcsICdwYWdlIGRvd24nIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBpdGVtcy5sYXN0Q2hpbGQsIHNlbGVjdEZpcnN0SXRlbTpmYWxzZSBcbiAgICAgICAgICAgIHdoZW4gJ2hvbWUnLCAncGFnZSB1cCcgIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBpdGVtcy5maXJzdENoaWxkLCBzZWxlY3RGaXJzdEl0ZW06ZmFsc2UgXG4gICAgICAgICAgICB3aGVuICdlc2MnICAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQGNsb3NlKClcbiAgICAgICAgICAgIHdoZW4gJ2Rvd24nICAgICAgICAgICAgIHRoZW4gc3RvcEV2ZW50IGV2ZW50LCBAc2VsZWN0IEBuZXh0SXRlbSgpLCBzZWxlY3RGaXJzdEl0ZW06ZmFsc2UgXG4gICAgICAgICAgICB3aGVuICd1cCcgICAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQHNlbGVjdCBAcHJldkl0ZW0oKSwgc2VsZWN0Rmlyc3RJdGVtOmZhbHNlIFxuICAgICAgICAgICAgd2hlbiAnZW50ZXInLCAnc3BhY2UnICAgdGhlbiBzdG9wRXZlbnQgZXZlbnQsIEBhY3RpdmF0ZU9yTmF2aWdhdGVSaWdodCgpXG4gICAgICAgICAgICB3aGVuICdsZWZ0JyAgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQG5hdmlnYXRlTGVmdCgpXG4gICAgICAgICAgICB3aGVuICdyaWdodCcgICAgICAgICAgICB0aGVuIHN0b3BFdmVudCBldmVudCwgQG5hdmlnYXRlUmlnaHQoKVxuICAgICAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IG1lbnU6IChvcHQpIC0+IG5ldyBQb3B1cCBvcHRcbiJdfQ==
//# sourceURL=../coffee/popup.coffee