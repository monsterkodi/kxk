(function() {
  /*
  000000000   0000000    0000000   000      000000000  000  00000000 
     000     000   000  000   000  000         000     000  000   000
     000     000   000  000   000  000         000     000  00000000 
     000     000   000  000   000  000         000     000  000      
     000      0000000    0000000   0000000     000     000  000      
  */
  var $, Tooltip, _, elem, error, log, pos;

  ({elem, pos, error, log, $, _} = require('./kxk'));

  Tooltip = class Tooltip {
    constructor(opt) {
      var base, base1, ref;
      this.del = this.del.bind(this);
      this.onHover = this.onHover.bind(this);
      this.popup = this.popup.bind(this);
      this.onLeave = this.onLeave.bind(this);
      this.opt = opt;
      if (!((ref = this.opt) != null ? ref.elem : void 0)) {
        return error("no elem for tooltip?");
      }
      if ((base = this.opt).delay == null) {
        base.delay = 700;
      }
      if ((base1 = this.opt).html == null) {
        base1.html = this.opt.text;
      }
      this.elem = this.opt.elem;
      if (_.isString(this.opt.elem)) {
        this.elem = $(this.opt.elem);
      }
      this.elem.tooltip = this;
      this.elem.addEventListener('mouseenter', this.onHover);
      this.elem.addEventListener('DOMNodeRemoved', this.del);
    }

    del(event) {
      if (this.opt.keep) {
        return;
      }
      if (this.elem == null) {
        return;
      }
      if (event.target === this.elem) {
        log('tooltip.del');
        delete this.elem.tooltip;
        this.onLeave();
        this.elem.removeEventListener('DOMNodeRemoved', this.del);
        return this.elem = null;
      }
    }

    onHover(event) {
      if (this.elem == null) {
        return;
      }
      if (this.div != null) {
        return;
      }
      clearTimeout(this.timer);
      this.timer = setTimeout(this.popup, this.opt.delay);
      this.elem.addEventListener('mouseleave', this.onLeave);
      return this.elem.addEventListener('mousedown', this.onLeave);
    }

    popup(event) {
      var br;
      if (this.elem == null) {
        return;
      }
      if (this.div != null) {
        return;
      }
      this.div = elem({
        id: 'tooltip',
        class: 'tooltip',
        html: this.opt.html
      });
      if (this.opt.parent) {
        this.opt.parent.appendChild(this.div);
      } else {
        document.body.appendChild(this.div);
      }
      br = this.elem.getBoundingClientRect();
      this.div.style.transform = "scaleY(1)";
      this.div.style.opacity = '1';
      if (this.opt.textSize != null) {
        this.div.style.fontSize = `${this.opt.textSize}px`;
      }
      if (this.opt.x != null) {
        this.div.style.left = `${br.left + this.opt.x}px`;
      }
      if (this.opt.y != null) {
        return this.div.style.top = `${br.bottom + this.opt.y}px`;
      }
    }

    onLeave(event, e) {
      var ref;
      if (this.elem != null) {
        this.elem.removeEventListener('mouseleave', this.onLeave);
        this.elem.removeEventListener('mousedown', this.onLeave);
      }
      clearTimeout(this.timer);
      this.timer = null;
      if ((ref = this.div) != null) {
        ref.remove();
      }
      return this.div = null;
    }

  };

  module.exports = Tooltip;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIuLi9jb2ZmZWUvdG9vbHRpcC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFBQTs7Ozs7OztBQUFBLE1BQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBQUE7O0VBUUEsQ0FBQSxDQUFFLElBQUYsRUFBUSxHQUFSLEVBQWEsS0FBYixFQUFvQixHQUFwQixFQUF5QixDQUF6QixFQUE0QixDQUE1QixDQUFBLEdBQWtDLE9BQUEsQ0FBUSxPQUFSLENBQWxDOztFQUVNLFVBQU4sTUFBQSxRQUFBO0lBRUksV0FBYSxJQUFBLENBQUE7QUFFVCxVQUFBLElBQUEsRUFBQSxLQUFBLEVBQUE7VUFZSixDQUFBLFVBQUEsQ0FBQTtVQVVBLENBQUEsY0FBQSxDQUFBO1VBVUEsQ0FBQSxZQUFBLENBQUE7VUFnQkEsQ0FBQSxjQUFBLENBQUE7TUFsRGMsSUFBQyxDQUFBO01BRVgsSUFBdUMsZ0NBQVEsQ0FBRSxjQUFqRDtBQUFBLGVBQU8sS0FBQSxDQUFNLHNCQUFOLEVBQVA7OztZQUVJLENBQUMsUUFBUzs7O2FBQ1YsQ0FBQyxPQUFTLElBQUMsQ0FBQSxHQUFHLENBQUM7O01BRW5CLElBQUMsQ0FBQSxJQUFELEdBQVMsSUFBQyxDQUFBLEdBQUcsQ0FBQztNQUNkLElBQXNCLENBQUMsQ0FBQyxRQUFGLENBQVcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQUFoQixDQUF0QjtRQUFBLElBQUMsQ0FBQSxJQUFELEdBQU8sQ0FBQSxDQUFFLElBQUMsQ0FBQSxHQUFHLENBQUMsSUFBUCxFQUFQOztNQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsT0FBTixHQUFnQjtNQUVoQixJQUFDLENBQUEsSUFBSSxDQUFDLGdCQUFOLENBQXVCLFlBQXZCLEVBQXFDLElBQUMsQ0FBQSxPQUF0QztNQUNBLElBQUMsQ0FBQSxJQUFJLENBQUMsZ0JBQU4sQ0FB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eUMsSUFBQyxDQUFBLE9BQTFDLEVBRko7O01BSUEsWUFBQSxDQUFhLElBQUMsQ0FBQSxLQUFkO01BQ0EsSUFBQyxDQUFBLEtBQUQsR0FBUzs7V0FDTCxDQUFFLE1BQU4sQ0FBQTs7YUFDQSxJQUFDLENBQUEsR0FBRCxHQUFPO0lBVEY7O0VBcERiOztFQStEQSxNQUFNLENBQUMsT0FBUCxHQUFpQjtBQXpFakIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbjAwMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAwMCAgMDAwICAwMDAwMDAwMCBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAwMDBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwICAwMDAwMDAwMCBcbiAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgIDAwMCAgICAgMDAwICAwMDAgICAgICBcbiAgIDAwMCAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMCAgICAgMDAwICAwMDAgICAgICBcbiMjI1xuXG57IGVsZW0sIHBvcywgZXJyb3IsIGxvZywgJCwgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbmNsYXNzIFRvb2x0aXBcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKEBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3IgXCJubyBlbGVtIGZvciB0b29sdGlwP1wiIGlmIG5vdCBAb3B0Py5lbGVtXG4gICAgICAgIFxuICAgICAgICBAb3B0LmRlbGF5ID89IDcwMFxuICAgICAgICBAb3B0Lmh0bWwgID89IEBvcHQudGV4dFxuICAgICAgICBcbiAgICAgICAgQGVsZW0gPSAgQG9wdC5lbGVtXG4gICAgICAgIEBlbGVtID0kIEBvcHQuZWxlbSBpZiBfLmlzU3RyaW5nIEBvcHQuZWxlbVxuICAgICAgICBAZWxlbS50b29sdGlwID0gQCAgICAgIFxuXG4gICAgICAgIEBlbGVtLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlZW50ZXInLCBAb25Ib3ZlclxuICAgICAgICBAZWxlbS5hZGRFdmVudExpc3RlbmVyICdET01Ob2RlUmVtb3ZlZCcsIEBkZWxcblxuICAgIGRlbDogKGV2ZW50KSA9PiBcbiAgICAgICAgcmV0dXJuIGlmIEBvcHQua2VlcFxuICAgICAgICByZXR1cm4gaWYgbm90IEBlbGVtP1xuICAgICAgICBpZiBldmVudC50YXJnZXQgPT0gQGVsZW1cbiAgICAgICAgICAgIGxvZyAndG9vbHRpcC5kZWwnXG4gICAgICAgICAgICBkZWxldGUgQGVsZW0udG9vbHRpcFxuICAgICAgICAgICAgQG9uTGVhdmUoKVxuICAgICAgICAgICAgQGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciAnRE9NTm9kZVJlbW92ZWQnLCBAZGVsXG4gICAgICAgICAgICBAZWxlbSA9IG51bGxcblxuICAgIG9uSG92ZXI6IChldmVudCkgPT5cblxuICAgICAgICByZXR1cm4gaWYgbm90IEBlbGVtP1xuICAgICAgICByZXR1cm4gaWYgQGRpdj9cbiAgICAgICAgY2xlYXJUaW1lb3V0IEB0aW1lclxuICAgICAgICBAdGltZXIgPSBzZXRUaW1lb3V0IEBwb3B1cCwgQG9wdC5kZWxheVxuICAgICAgICBcbiAgICAgICAgQGVsZW0uYWRkRXZlbnRMaXN0ZW5lciAnbW91c2VsZWF2ZScsIEBvbkxlYXZlXG4gICAgICAgIEBlbGVtLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlZG93bicsICBAb25MZWF2ZVxuXG4gICAgcG9wdXA6IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBub3QgQGVsZW0/XG4gICAgICAgIHJldHVybiBpZiBAZGl2P1xuICAgICAgICBAZGl2ID0gZWxlbSBpZDondG9vbHRpcCcsIGNsYXNzOid0b29sdGlwJywgaHRtbDogQG9wdC5odG1sXG4gICAgICAgIGlmIEBvcHQucGFyZW50XG4gICAgICAgICAgICBAb3B0LnBhcmVudC5hcHBlbmRDaGlsZCBAZGl2XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQgQGRpdlxuICAgICAgICBiciA9IEBlbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG4gICAgICAgIEBkaXYuc3R5bGUudHJhbnNmb3JtID0gXCJzY2FsZVkoMSlcIlxuICAgICAgICBAZGl2LnN0eWxlLm9wYWNpdHkgPSAnMSdcbiAgICAgICAgQGRpdi5zdHlsZS5mb250U2l6ZSA9IFwiI3tAb3B0LnRleHRTaXplfXB4XCIgaWYgQG9wdC50ZXh0U2l6ZT9cbiAgICAgICAgQGRpdi5zdHlsZS5sZWZ0ID0gXCIje2JyLmxlZnQgKyBAb3B0Lnh9cHhcIiBpZiBAb3B0Lng/XG4gICAgICAgIEBkaXYuc3R5bGUudG9wID0gXCIje2JyLmJvdHRvbSArIEBvcHQueX1weFwiIGlmIEBvcHQueT9cbiAgICAgICAgXG4gICAgb25MZWF2ZTogKGV2ZW50LCBlKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgQGVsZW0/XG4gICAgICAgICAgICBAZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICAnbW91c2VsZWF2ZScsIEBvbkxlYXZlXG4gICAgICAgICAgICBAZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICAnbW91c2Vkb3duJywgIEBvbkxlYXZlXG4gICAgICAgICAgICBcbiAgICAgICAgY2xlYXJUaW1lb3V0IEB0aW1lclxuICAgICAgICBAdGltZXIgPSBudWxsXG4gICAgICAgIEBkaXY/LnJlbW92ZSgpXG4gICAgICAgIEBkaXYgPSBudWxsXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBUb29sdGlwXG4iXX0=
//# sourceURL=../coffee/tooltip.coffee