(function() {
  /*
  000000000   0000000    0000000   000      000000000  000  00000000 
     000     000   000  000   000  000         000     000  000   000
     000     000   000  000   000  000         000     000  00000000 
     000     000   000  000   000  000         000     000  000      
     000      0000000    0000000   0000000     000     000  000      
  */
  var $, Tooltip, _, elem, empty, error, log, pos;

  ({elem, pos, empty, error, log, $, _} = require('./kxk'));

  Tooltip = class Tooltip {
    constructor(opt) {
      var base, base1, ref;
      this.del = this.del.bind(this);
      this.onHover = this.onHover.bind(this);
      this.popup = this.popup.bind(this);
      this.onLeave = this.onLeave.bind(this);
      this.opt = opt;
      if (!((ref = this.opt) != null ? ref.elem : void 0)) {
        return error("no elem for tooltip?");
      }
      if ((base = this.opt).delay == null) {
        base.delay = 700;
      }
      if ((base1 = this.opt).html == null) {
        base1.html = this.opt.text;
      }
      this.elem = this.opt.elem;
      if (_.isString(this.opt.elem)) {
        this.elem = $(this.opt.elem);
      }
      this.elem.tooltip = this;
      this.elem.addEventListener('mouseenter', this.onHover);
      this.elem.addEventListener('DOMNodeRemoved', this.del);
    }

    del(event) {
      if (this.opt.keep) {
        return;
      }
      if (this.elem == null) {
        return;
      }
      if (empty(event) || (event != null ? event.target : void 0) === this.elem) {
        log('tooltip.del');
        delete this.elem.tooltip;
        this.onLeave();
        this.elem.removeEventListener('DOMNodeRemoved', this.del);
        return this.elem = null;
      }
    }

    onHover(event) {
      if (this.elem == null) {
        return;
      }
      if (this.div != null) {
        return;
      }
      clearTimeout(this.timer);
      this.timer = setTimeout(this.popup, this.opt.delay);
      this.elem.addEventListener('mouseleave', this.onLeave);
      return this.elem.addEventListener('mousedown', this.onLeave);
    }

    popup(event) {
      var br;
      if (this.elem == null) {
        return;
      }
      if (this.div != null) {
        return;
      }
      this.div = elem({
        id: 'tooltip',
        class: 'tooltip',
        html: this.opt.html
      });
      if (this.opt.parent) {
        this.opt.parent.appendChild(this.div);
      } else {
        document.body.appendChild(this.div);
      }
      br = this.elem.getBoundingClientRect();
      this.div.style.transform = "scaleY(1)";
      this.div.style.opacity = '1';
      if (this.opt.textSize != null) {
        this.div.style.fontSize = `${this.opt.textSize}px`;
      }
      if (this.opt.x != null) {
        this.div.style.left = `${br.left + this.opt.x}px`;
      }
      if (this.opt.y != null) {
        return this.div.style.top = `${br.bottom + this.opt.y}px`;
      }
    }

    onLeave(event, e) {
      var ref;
      if (this.elem != null) {
        this.elem.removeEventListener('mouseleave', this.onLeave);
        this.elem.removeEventListener('mousedown', this.onLeave);
      }
      clearTimeout(this.timer);
      this.timer = null;
      if ((ref = this.div) != null) {
        ref.remove();
      }
      return this.div = null;
    }

  };

  module.exports = Tooltip;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIuLi9jb2ZmZWUvdG9vbHRpcC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFBQTs7Ozs7OztBQUFBLE1BQUEsQ0FBQSxFQUFBLE9BQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxLQUFBLEVBQUEsR0FBQSxFQUFBOztFQVFBLENBQUEsQ0FBRSxJQUFGLEVBQVEsR0FBUixFQUFhLEtBQWIsRUFBb0IsS0FBcEIsRUFBMkIsR0FBM0IsRUFBZ0MsQ0FBaEMsRUFBbUMsQ0FBbkMsQ0FBQSxHQUF5QyxPQUFBLENBQVEsT0FBUixDQUF6Qzs7RUFFTSxVQUFOLE1BQUEsUUFBQTtJQUVJLFdBQWEsSUFBQSxDQUFBO0FBRVQsVUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBO1VBWUosQ0FBQSxVQUFBLENBQUE7VUFZQSxDQUFBLGNBQUEsQ0FBQTtVQVVBLENBQUEsWUFBQSxDQUFBO1VBZ0JBLENBQUEsY0FBQSxDQUFBO01BcERjLElBQUMsQ0FBQTtNQUVYLElBQXVDLGdDQUFRLENBQUUsY0FBakQ7QUFBQSxlQUFPLEtBQUEsQ0FBTSxzQkFBTixFQUFQOzs7WUFFSSxDQUFDLFFBQVM7OzthQUNWLENBQUMsT0FBUyxJQUFDLENBQUEsR0FBRyxDQUFDOztNQUVuQixJQUFDLENBQUEsSUFBRCxHQUFTLElBQUMsQ0FBQSxHQUFHLENBQUM7TUFDZCxJQUFzQixDQUFDLENBQUMsUUFBRixDQUFXLElBQUMsQ0FBQSxHQUFHLENBQUMsSUFBaEIsQ0FBdEI7UUFBQSxJQUFDLENBQUEsSUFBRCxHQUFPLENBQUEsQ0FBRSxJQUFDLENBQUEsR0FBRyxDQUFDLElBQVAsRUFBUDs7TUFDQSxJQUFDLENBQUEsSUFBSSxDQUFDLE9BQU4sR0FBZ0I7TUFFaEIsSUFBQyxDQUFBLElBQUksQ0FBQyxnQkFBTixDQUF1QixZQUF2QixFQUFxQyxJQUFDLENBQUEsT0FBdEM7TUFDQSxJQUFDLENB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QTFDO1FBQ0EsSUFBQyxDQUFBLElBQUksQ0FBQyxtQkFBTixDQUEyQixXQUEzQixFQUF5QyxJQUFDLENBQUEsT0FBMUMsRUFGSjs7TUFJQSxZQUFBLENBQWEsSUFBQyxDQUFBLEtBQWQ7TUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTOztXQUNMLENBQUUsTUFBTixDQUFBOzthQUNBLElBQUMsQ0FBQSxHQUFELEdBQU87SUFURjs7RUF0RGI7O0VBaUVBLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0FBM0VqQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgMDAwMDAwMDAwICAwMDAgIDAwMDAwMDAwIFxuICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgIDAwMFxuICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgMDAwICAgICAwMDAgIDAwMDAwMDAwIFxuICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAgMDAwICAgICAwMDAgIDAwMCAgICAgIFxuICAgMDAwICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgMDAwICAgICAwMDAgIDAwMCAgICAgIFxuIyMjXG5cbnsgZWxlbSwgcG9zLCBlbXB0eSwgZXJyb3IsIGxvZywgJCwgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbmNsYXNzIFRvb2x0aXBcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKEBvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3IgXCJubyBlbGVtIGZvciB0b29sdGlwP1wiIGlmIG5vdCBAb3B0Py5lbGVtXG4gICAgICAgIFxuICAgICAgICBAb3B0LmRlbGF5ID89IDcwMFxuICAgICAgICBAb3B0Lmh0bWwgID89IEBvcHQudGV4dFxuICAgICAgICBcbiAgICAgICAgQGVsZW0gPSAgQG9wdC5lbGVtXG4gICAgICAgIEBlbGVtID0kIEBvcHQuZWxlbSBpZiBfLmlzU3RyaW5nIEBvcHQuZWxlbVxuICAgICAgICBAZWxlbS50b29sdGlwID0gQCAgICAgIFxuXG4gICAgICAgIEBlbGVtLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlZW50ZXInLCBAb25Ib3ZlclxuICAgICAgICBAZWxlbS5hZGRFdmVudExpc3RlbmVyICdET01Ob2RlUmVtb3ZlZCcsIEBkZWxcblxuICAgIGRlbDogKGV2ZW50KSA9PiBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBAb3B0LmtlZXBcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBAZWxlbT9cbiAgICAgICAgXG4gICAgICAgIGlmIGVtcHR5KGV2ZW50KSBvciBldmVudD8udGFyZ2V0ID09IEBlbGVtXG4gICAgICAgICAgICBsb2cgJ3Rvb2x0aXAuZGVsJ1xuICAgICAgICAgICAgZGVsZXRlIEBlbGVtLnRvb2x0aXBcbiAgICAgICAgICAgIEBvbkxlYXZlKClcbiAgICAgICAgICAgIEBlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIgJ0RPTU5vZGVSZW1vdmVkJywgQGRlbFxuICAgICAgICAgICAgQGVsZW0gPSBudWxsXG5cbiAgICBvbkhvdmVyOiAoZXZlbnQpID0+XG5cbiAgICAgICAgcmV0dXJuIGlmIG5vdCBAZWxlbT9cbiAgICAgICAgcmV0dXJuIGlmIEBkaXY/XG4gICAgICAgIGNsZWFyVGltZW91dCBAdGltZXJcbiAgICAgICAgQHRpbWVyID0gc2V0VGltZW91dCBAcG9wdXAsIEBvcHQuZGVsYXlcbiAgICAgICAgXG4gICAgICAgIEBlbGVtLmFkZEV2ZW50TGlzdGVuZXIgJ21vdXNlbGVhdmUnLCBAb25MZWF2ZVxuICAgICAgICBAZWxlbS5hZGRFdmVudExpc3RlbmVyICdtb3VzZWRvd24nLCAgQG9uTGVhdmVcblxuICAgIHBvcHVwOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gaWYgbm90IEBlbGVtP1xuICAgICAgICByZXR1cm4gaWYgQGRpdj9cbiAgICAgICAgQGRpdiA9IGVsZW0gaWQ6J3Rvb2x0aXAnLCBjbGFzczondG9vbHRpcCcsIGh0bWw6IEBvcHQuaHRtbFxuICAgICAgICBpZiBAb3B0LnBhcmVudFxuICAgICAgICAgICAgQG9wdC5wYXJlbnQuYXBwZW5kQ2hpbGQgQGRpdlxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkIEBkaXZcbiAgICAgICAgYnIgPSBAZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVxuICAgICAgICBAZGl2LnN0eWxlLnRyYW5zZm9ybSA9IFwic2NhbGVZKDEpXCJcbiAgICAgICAgQGRpdi5zdHlsZS5vcGFjaXR5ID0gJzEnXG4gICAgICAgIEBkaXYuc3R5bGUuZm9udFNpemUgPSBcIiN7QG9wdC50ZXh0U2l6ZX1weFwiIGlmIEBvcHQudGV4dFNpemU/XG4gICAgICAgIEBkaXYuc3R5bGUubGVmdCA9IFwiI3tici5sZWZ0ICsgQG9wdC54fXB4XCIgaWYgQG9wdC54P1xuICAgICAgICBAZGl2LnN0eWxlLnRvcCA9IFwiI3tici5ib3R0b20gKyBAb3B0Lnl9cHhcIiBpZiBAb3B0Lnk/XG4gICAgICAgIFxuICAgIG9uTGVhdmU6IChldmVudCwgZSkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBlbGVtP1xuICAgICAgICAgICAgQGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciAgJ21vdXNlbGVhdmUnLCBAb25MZWF2ZVxuICAgICAgICAgICAgQGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciAgJ21vdXNlZG93bicsICBAb25MZWF2ZVxuICAgICAgICAgICAgXG4gICAgICAgIGNsZWFyVGltZW91dCBAdGltZXJcbiAgICAgICAgQHRpbWVyID0gbnVsbFxuICAgICAgICBAZGl2Py5yZW1vdmUoKVxuICAgICAgICBAZGl2ID0gbnVsbFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gVG9vbHRpcFxuIl19
//# sourceURL=../coffee/tooltip.coffee