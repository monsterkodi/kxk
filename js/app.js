
/*
 0000000   00000000   00000000   
000   000  000   000  000   000  
000000000  00000000   00000000   
000   000  000        000        
000   000  000        000
 */
var App, _, about, args, childp, empty, error, fs, log, os, post, prefs, ref, slash, valid, watch,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('./kxk'), args = ref.args, prefs = ref.prefs, watch = ref.watch, empty = ref.empty, valid = ref.valid, slash = ref.slash, about = ref.about, post = ref.post, childp = ref.childp, os = ref.os, fs = ref.fs, error = ref.error, log = ref.log, _ = ref._;

App = (function() {
  function App(opt) {
    var argl, cb, electron, ref1;
    this.opt = opt;
    this.onSrcChange = bind(this.onSrcChange, this);
    this.stopWatcher = bind(this.stopWatcher, this);
    this.startWatcher = bind(this.startWatcher, this);
    this.saveBounds = bind(this.saveBounds, this);
    this.createWindow = bind(this.createWindow, this);
    this.showWindow = bind(this.showWindow, this);
    this.toggleWindowFromTray = bind(this.toggleWindowFromTray, this);
    this.toggleWindow = bind(this.toggleWindow, this);
    this.showDock = bind(this.showDock, this);
    this.hideDock = bind(this.hideDock, this);
    this.exitApp = bind(this.exitApp, this);
    this.quitApp = bind(this.quitApp, this);
    this.showAbout = bind(this.showAbout, this);
    this.initTray = bind(this.initTray, this);
    this.onReady = bind(this.onReady, this);
    this.resolve = bind(this.resolve, this);
    process.on('uncaughtException', function(err) {
      var srcmap;
      srcmap = require('./srcmap');
      srcmap.logErr(err, 'ðŸ”»');
      return true;
    });
    this.watchers = [];
    electron = require('electron');
    this.app = electron.app;
    this.userData = slash.userData();
    if (this.opt.tray) {
      log.slog.icon = slash.fileUrl(this.resolve(this.opt.tray));
    }
    argl = "noprefs     don't load preferences      false\ndevtools    open developer tools        false  -D\nwatch       watch sources for changes   false";
    if (this.opt.args) {
      argl = this.opt.args + '\n' + argl;
    }
    args = args.init(argl);
    if (this.opt.single !== false) {
      if ((this.app.makeSingleInstance != null) && this.app.makeSingleInstance((ref1 = this.opt.onOtherInstance) != null ? ref1 : this.showWindow)) {
        log('app.quit single');
        this.app.quit();
        return;
      } else if (this.app.requestSingleInstanceLock != null) {
        if (this.app.requestSingleInstanceLock()) {
          if (this.opt.onOtherInstance) {
            cb = (function(_this) {
              return function(event, args, dir) {
                return _this.opt.onOtherInstance(args, dir);
              };
            })(this);
          } else {
            cb = this.showWindow;
          }
          this.app.on('second-instance', cb);
        } else {
          this.app.quit();
          return;
        }
      }
    }
    post.on('showAbout', this.showAbout);
    post.on('quitApp', this.quitApp);
    this.app.setName(this.opt.pkg.name);
    this.app.on('ready', this.onReady);
    this.app.on('window-all-closed', (function(_this) {
      return function(event) {
        if (!_this.opt.singleWindow) {
          return event.preventDefault();
        } else {
          return _this.quitApp();
        }
      };
    })(this));
  }

  App.prototype.resolve = function(file) {
    return slash.resolve(slash.join(this.opt.dir, file));
  };

  App.prototype.onReady = function() {
    var electron;
    if (this.opt.tray) {
      this.initTray();
    }
    this.hideDock();
    this.app.setName(this.opt.pkg.name);
    if (!args.noprefs) {
      if (this.opt.shortcut) {
        prefs.init({
          shortcut: this.opt.shortcut
        });
      } else {
        prefs.init();
      }
    }
    if (valid(prefs.get('shortcut'))) {
      electron = require('electron');
      electron.globalShortcut.register(prefs.get('shortcut'), this.showWindow);
    }
    if (args.watch) {
      log('App.onReady startWatcher');
      this.startWatcher();
    }
    if (this.opt.onShow) {
      this.opt.onShow();
    } else {
      this.showWindow();
    }
    return post.emit('appReady');
  };

  App.prototype.initTray = function() {
    var electron, template, trayImg;
    electron = require('electron');
    trayImg = this.resolve(this.opt.tray);
    this.tray = new electron.Tray(trayImg);
    this.tray.on('click', this.toggleWindowFromTray);
    if (os.platform() !== 'darwin') {
      template = [
        {
          label: "Quit",
          click: this.quitApp
        }, {
          label: "About",
          click: this.showAbout
        }, {
          label: "Activate",
          click: this.toggleWindowFromTray
        }
      ];
      return this.tray.setContextMenu(electron.Menu.buildFromTemplate(template));
    }
  };

  App.prototype.showAbout = function() {
    var dark;
    dark = 'dark' === prefs.get('scheme', 'dark');
    return about({
      img: this.resolve(this.opt.about),
      color: dark && '#383838' || '#ddd',
      background: dark && '#282828' || '#fff',
      highlight: dark && '#fff' || '#000',
      pkg: this.opt.pkg,
      debug: this.opt.aboutDebug
    });
  };

  App.prototype.quitApp = function() {
    var base;
    this.stopWatcher();
    this.saveBounds();
    prefs.save();
    if ('delay' !== (typeof (base = this.opt).onQuit === "function" ? base.onQuit() : void 0)) {
      return this.exitApp();
    }
  };

  App.prototype.exitApp = function() {
    this.app.exit(0);
    return process.exit(0);
  };

  App.prototype.hideDock = function() {
    var ref1;
    return (ref1 = this.app.dock) != null ? ref1.hide() : void 0;
  };

  App.prototype.showDock = function() {
    var ref1;
    return (ref1 = this.app.dock) != null ? ref1.show() : void 0;
  };

  App.prototype.toggleWindow = function() {
    var ref1;
    if ((ref1 = this.win) != null ? ref1.isVisible() : void 0) {
      this.win.hide();
      return this.hideDock();
    } else {
      return this.showWindow();
    }
  };

  App.prototype.toggleWindowFromTray = function() {
    return this.showWindow();
  };

  App.prototype.showWindow = function() {
    var base;
    if (typeof (base = this.opt).onWillShowWin === "function") {
      base.onWillShowWin();
    }
    if (this.win != null) {
      this.win.show();
    } else {
      this.createWindow();
    }
    return this.showDock();
  };

  App.prototype.createWindow = function(onReadyToShow) {
    var bounds, electron, height, ref1, ref2, ref3, ref4, ref5, ref6, width;
    electron = require('electron');
    bounds = prefs.get('bounds');
    width = (ref1 = (ref2 = bounds != null ? bounds.width : void 0) != null ? ref2 : this.opt.width) != null ? ref1 : 500;
    height = (ref3 = (ref4 = bounds != null ? bounds.height : void 0) != null ? ref4 : this.opt.height) != null ? ref3 : 500;
    this.win = new electron.BrowserWindow({
      width: width,
      height: height,
      minWidth: (ref5 = this.opt.minWidth) != null ? ref5 : 250,
      minHeight: (ref6 = this.opt.minHeight) != null ? ref6 : 250,
      backgroundColor: '#181818',
      fullscreenenable: true,
      fullscreen: false,
      show: false,
      frame: false,
      resizable: true,
      maximizable: true,
      minimizable: true,
      transparent: true,
      autoHideMenuBar: true,
      icon: this.resolve(this.opt.icon),
      webPreferences: {
        nodeIntegration: true
      }
    });
    if (bounds != null) {
      this.win.setPosition(bounds.x, bounds.y);
    }
    this.win.loadURL(slash.fileUrl(this.resolve(this.opt.index)));
    if (args.devtools) {
      this.win.webContents.openDevTools();
    }
    this.win.on('resize', this.saveBounds);
    this.win.on('move', this.saveBounds);
    this.win.on('closed', (function(_this) {
      return function() {
        return _this.win = null;
      };
    })(this));
    this.win.on('close', (function(_this) {
      return function() {
        return _this.hideDock();
      };
    })(this));
    this.win.on('ready-to-show', (function(_this) {
      return function(event) {
        var win;
        win = event.sender;
        if (typeof onReadyToShow === "function") {
          onReadyToShow(win);
        }
        win.show();
        return post.emit('winReady', win.id);
      };
    })(this));
    this.showDock();
    return this.win;
  };

  App.prototype.saveBounds = function() {
    if (this.win != null) {
      return prefs.set('bounds', this.win.getBounds());
    }
  };

  App.prototype.screenSize = function() {
    var electron;
    electron = require('electron');
    return electron.screen.getPrimaryDisplay().workAreaSize;
  };

  App.prototype.startWatcher = function() {
    var dir, i, len, ref1, results, watcher;
    this.opt.dir = slash.resolve(this.opt.dir);
    console.log('startWatcher', this.opt.dir);
    watcher = watch.dir(this.opt.dir);
    watcher.on('change', this.onSrcChange);
    watcher.on('error', function(err) {
      return error(err);
    });
    this.watchers.push(watcher);
    if (empty(this.opt.dirs)) {
      return;
    }
    console.log('startWatchers', this.opt.dirs);
    ref1 = this.opt.dirs;
    results = [];
    for (i = 0, len = ref1.length; i < len; i++) {
      dir = ref1[i];
      watcher = watch.dir(slash.resolve(slash.join(this.opt.dir, dir)));
      watcher.on('change', this.onSrcChange);
      watcher.on('error', function(err) {
        return error(err);
      });
      results.push(this.watchers.push(watcher));
    }
    return results;
  };

  App.prototype.stopWatcher = function() {
    var i, len, ref1, watcher;
    if (empty(this.watchers)) {
      return;
    }
    ref1 = this.watchers;
    for (i = 0, len = ref1.length; i < len; i++) {
      watcher = ref1[i];
      watcher.close();
    }
    return this.watchers = [];
  };

  App.prototype.onSrcChange = function(info) {
    var pkg;
    log("onSrcChange '" + info.change + "'", info.path);
    if (slash.base(info.path) === 'main') {
      this.stopWatcher();
      this.app.exit(0);
      if (pkg = slash.pkg(this.opt.dir)) {
        if (slash.isDir(slash.join(pkg, 'node_modules'))) {
          childp.execSync(pkg + "/node_modules/.bin/electron . -w", {
            cwd: pkg,
            encoding: 'utf8',
            stdio: 'inherit',
            shell: true
          });
          process.exit(0);
          return;
        }
      }
    }
    return post.toWins('menuAction', 'Reload');
  };

  return App;

})();

module.exports = App;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLDZGQUFBO0VBQUE7O0FBUUEsTUFBMEYsT0FBQSxDQUFRLE9BQVIsQ0FBMUYsRUFBRSxlQUFGLEVBQVEsaUJBQVIsRUFBZSxpQkFBZixFQUFzQixpQkFBdEIsRUFBNkIsaUJBQTdCLEVBQW9DLGlCQUFwQyxFQUEyQyxpQkFBM0MsRUFBa0QsZUFBbEQsRUFBd0QsbUJBQXhELEVBQWdFLFdBQWhFLEVBQW9FLFdBQXBFLEVBQXdFLGlCQUF4RSxFQUErRSxhQUEvRSxFQUFvRjs7QUFFOUU7RUFFVyxhQUFDLEdBQUQ7QUFFVCxRQUFBO0lBRlUsSUFBQyxDQUFBLE1BQUQ7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRVYsT0FBTyxDQUFDLEVBQVIsQ0FBVyxtQkFBWCxFQUFnQyxTQUFDLEdBQUQ7QUFDNUIsVUFBQTtNQUFBLE1BQUEsR0FBUyxPQUFBLENBQVEsVUFBUjtNQUNULE1BQU0sQ0FBQyxNQUFQLENBQWMsR0FBZCxFQUFtQixJQUFuQjthQUNBO0lBSDRCLENBQWhDO0lBS0EsSUFBQyxDQUFBLFFBQUQsR0FBWTtJQUVaLFFBQUEsR0FBVyxPQUFBLENBQVEsVUFBUjtJQUNYLElBQUMsQ0FBQSxHQUFELEdBQU8sUUFBUSxDQUFDO0lBQ2hCLElBQUMsQ0FBQSxRQUFELEdBQVksS0FBSyxDQUFDLFFBQU4sQ0FBQTtJQUVaLElBQUcsSUFBQyxDQUFBLEdBQUcsQ0FBQyxJQUFSO01BQ0ksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFULEdBQWdCLEtBQUssQ0FBQyxPQUFOLENBQWMsSUFBQyxDQUFBLE9BQUQsQ0FBUyxJQUFDLENBQUEsR0FBRyxDQUFDLElBQWQsQ0FBZCxFQURwQjs7SUFHQSxJQUFBLEdBQU87SUFNUCxJQUFrQyxJQUFDLENBQUEsR0FBRyxDQUFDLElBQXZDO01BQUEsSUFBQSxHQUFPLElBQUMsQ0FBQSxHQUFHLENBQUMs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QyxJQUFSLENBQWEsQ0FBYjtBQUNBLGlCQVBKO1NBREo7T0FISjs7V0FZQSxJQUFJLENBQUMsTUFBTCxDQUFZLFlBQVosRUFBMEIsUUFBMUI7RUFmUzs7Ozs7O0FBaUJqQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbjAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgIFxuMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAgXG4wMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgICBcbiMjI1xuXG57IGFyZ3MsIHByZWZzLCB3YXRjaCwgZW1wdHksIHZhbGlkLCBzbGFzaCwgYWJvdXQsIHBvc3QsIGNoaWxkcCwgb3MsIGZzLCBlcnJvciwgbG9nLCBfIH0gPSByZXF1aXJlICcuL2t4aydcblxuY2xhc3MgQXBwXG4gICAgXG4gICAgY29uc3RydWN0b3I6IChAb3B0KSAtPlxuXG4gICAgICAgIHByb2Nlc3Mub24gJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycikgLT5cbiAgICAgICAgICAgIHNyY21hcCA9IHJlcXVpcmUgJy4vc3JjbWFwJyAgICBcbiAgICAgICAgICAgIHNyY21hcC5sb2dFcnIgZXJyLCAn8J+UuydcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgXG4gICAgICAgIEB3YXRjaGVycyA9IFtdXG4gICAgICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgQGFwcCA9IGVsZWN0cm9uLmFwcFxuICAgICAgICBAdXNlckRhdGEgPSBzbGFzaC51c2VyRGF0YSgpICNAYXBwLmdldFBhdGggJ3VzZXJEYXRhJ1xuICAgICAgICBcbiAgICAgICAgaWYgQG9wdC50cmF5XG4gICAgICAgICAgICBsb2cuc2xvZy5pY29uID0gc2xhc2guZmlsZVVybCBAcmVzb2x2ZSBAb3B0LnRyYXkgIFxuICAgICAgICAgICAgXG4gICAgICAgIGFyZ2wgPSBcIlwiXCJcbiAgICAgICAgICAgIG5vcHJlZnMgICAgIGRvbid0IGxvYWQgcHJlZmVyZW5jZXMgICAgICBmYWxzZVxuICAgICAgICAgICAgZGV2dG9vbHMgICAgb3BlbiBkZXZlbG9wZXIgdG9vbHMgICAgICAgIGZhbHNlICAtRFxuICAgICAgICAgICAgd2F0Y2ggICAgICAgd2F0Y2ggc291cmNlcyBmb3IgY2hhbmdlcyAgIGZhbHNlXG4gICAgICAgICAgICBcIlwiXCJcbiAgICAgICAgICAgIFxuICAgICAgICBhcmdsID0gQG9wdC5hcmdzICsgJ1xcbicgKyBhcmdsIGlmIEBvcHQuYXJnc1xuICAgICAgICBhcmdzID0gYXJncy5pbml0IGFyZ2xcbiAgICAgICAgXG4gICAgICAgICMgbG9nICdhcHAuYXJncycsIGFyZ3NcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQuc2luZ2xlICE9IGZhbHNlICNhbmQgb3MucGxhdGZvcm0oKSAhPSAnZGFyd2luJ1xuICAgICAgICAgICAgaWYgQGFwcC5tYWtlU2luZ2xlSW5zdGFuY2U/IGFuZCBAYXBwLm1ha2VTaW5nbGVJbnN0YW5jZSBAb3B0Lm9uT3RoZXJJbnN0YW5jZSA/IEBzaG93V2luZG93XG4gICAgICAgICAgICAgICAgbG9nICdhcHAucXVpdCBzaW5nbGUnXG4gICAgICAgICAgICAgICAgQGFwcC5xdWl0KClcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIGVsc2UgaWYgQGFwcC5yZXF1ZXN0U2luZ2xlSW5zdGFuY2VMb2NrPyBcbiAgICAgICAgICAgICAgICBpZiBAYXBwLnJlcXVlc3RTaW5nbGVJbnN0YW5jZUxvY2soKVxuICAgICAgICAgICAgICAgICAgICBpZiBAb3B0Lm9uT3RoZXJJbnN0YW5jZVxuICAgICAgICAgICAgICAgICAgICAgICAgY2IgPSAoZXZlbnQsIGFyZ3MsIGRpcikgPT4gQG9wdC5vbk90aGVySW5zdGFuY2UgYXJncywgZGlyIFxuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBjYiA9IEBzaG93V2luZG93XG4gICAgICAgICAgICAgICAgICAgIEBhcHAub24gJ3NlY29uZC1pbnN0YW5jZScsIGNiICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBAYXBwLnF1aXQoKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgXG4gICAgICAgIHBvc3Qub24gJ3Nob3dBYm91dCcsIEBzaG93QWJvdXRcbiAgICAgICAgcG9zdC5vbiAncXVpdEFwcCcsICAgQHF1aXRBcHBcblxuICAgICAgICBAYXBwLnNldE5hbWUgQG9wdC5wa2cubmFtZVxuICAgICAgICBAYXBwLm9uICdyZWFkeScsIEBvblJlYWR5XG4gICAgICAgIEBhcHAub24gJ3dpbmRvdy1hbGwtY2xvc2VkJywgKGV2ZW50KSA9PiBcbiAgICAgICAgICAgIGlmIG5vdCBAb3B0LnNpbmdsZVdpbmRvd1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCkgICAgICAgIFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEBxdWl0QXBwKClcbiAgICAgICAgXG4gICAgcmVzb2x2ZTogKGZpbGUpID0+IHNsYXNoLnJlc29sdmUgc2xhc2guam9pbiBAb3B0LmRpciwgZmlsZVxuICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAgMDAwXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAwMDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgICAgIDAwMFxuICAgIFxuICAgIG9uUmVhZHk6ID0+XG4gICAgXG4gICAgICAgIGlmIEBvcHQudHJheSB0aGVuIEBpbml0VHJheSgpXG4gICAgICAgICBcbiAgICAgICAgQGhpZGVEb2NrKClcbiAgICAgICAgIFxuICAgICAgICBAYXBwLnNldE5hbWUgQG9wdC5wa2cubmFtZVxuICAgIFxuICAgICAgICBpZiBub3QgYXJncy5ub3ByZWZzXG4gICAgICAgICAgICBpZiBAb3B0LnNob3J0Y3V0XG4gICAgICAgICAgICAgICAgcHJlZnMuaW5pdCBzaG9ydGN1dDogQG9wdC5zaG9ydGN1dFxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIHByZWZzLmluaXQoKVxuICAgIFxuICAgICAgICBpZiB2YWxpZCBwcmVmcy5nZXQgJ3Nob3J0Y3V0J1xuICAgICAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgICAgIGVsZWN0cm9uLmdsb2JhbFNob3J0Y3V0LnJlZ2lzdGVyIHByZWZzLmdldCgnc2hvcnRjdXQnKSwgQHNob3dXaW5kb3dcbiAgICAgICAgICAgICBcbiAgICAgICAgaWYgYXJncy53YXRjaFxuICAgICAgICAgICAgbG9nICdBcHAub25SZWFkeSBzdGFydFdhdGNoZXInXG4gICAgICAgICAgICBAc3RhcnRXYXRjaGVyKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBvcHQub25TaG93XG4gICAgICAgICAgICBAb3B0Lm9uU2hvdygpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBzaG93V2luZG93KClcblxuICAgICAgICBwb3N0LmVtaXQgJ2FwcFJlYWR5J1xuICAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwIDAwMCAgIFxuICAgICMgICAgMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgICAwMDAwMCAgICBcbiAgICAjICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIGluaXRUcmF5OiA9PlxuICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgdHJheUltZyA9IEByZXNvbHZlIEBvcHQudHJheVxuICAgICAgICBAdHJheSA9IG5ldyBlbGVjdHJvbi5UcmF5IHRyYXlJbWdcbiAgICAgICAgQHRyYXkub24gJ2NsaWNrJywgQHRvZ2dsZVdpbmRvd0Zyb21UcmF5XG4gICAgICAgIFxuICAgICAgICBpZiBvcy5wbGF0Zm9ybSgpICE9ICdkYXJ3aW4nXG4gICAgICAgICAgICB0ZW1wbGF0ZSA9IFtcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJRdWl0XCJcbiAgICAgICAgICAgICAgICBjbGljazogQHF1aXRBcHBcbiAgICAgICAgICAgICxcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJBYm91dFwiXG4gICAgICAgICAgICAgICAgY2xpY2s6IEBzaG93QWJvdXRcbiAgICAgICAgICAgICxcbiAgICAgICAgICAgICAgICBsYWJlbDogXCJBY3RpdmF0ZVwiXG4gICAgICAgICAgICAgICAgY2xpY2s6IEB0b2dnbGVXaW5kb3dGcm9tVHJheVxuICAgICAgICAgICAgXVxuICAgICAgICAgICAgQHRyYXkuc2V0Q29udGV4dE1lbnUgZWxlY3Ryb24uTWVudS5idWlsZEZyb21UZW1wbGF0ZSB0ZW1wbGF0ZVxuICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgc2hvd0Fib3V0OiA9PlxuICAgICAgICBcbiAgICAgICAgZGFyayA9ICdkYXJrJyA9PSBwcmVmcy5nZXQgJ3NjaGVtZScsICdkYXJrJ1xuICAgICAgICBhYm91dFxuICAgICAgICAgICAgaW1nOiAgICAgICAgQHJlc29sdmUgQG9wdC5hYm91dFxuICAgICAgICAgICAgY29sb3I6ICAgICAgZGFyayBhbmQgJyMzODM4MzgnIG9yICcjZGRkJ1xuICAgICAgICAgICAgYmFja2dyb3VuZDogZGFyayBhbmQgJyMyODI4MjgnIG9yICcjZmZmJ1xuICAgICAgICAgICAgaGlnaGxpZ2h0OiAgZGFyayBhbmQgJyNmZmYnICAgIG9yICcjMDAwJ1xuICAgICAgICAgICAgcGtnOiAgICAgICAgQG9wdC5wa2dcbiAgICAgICAgICAgIGRlYnVnOiAgICAgIEBvcHQuYWJvdXREZWJ1Z1xuICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgMDAgMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwIDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjICAwMDAwMCAwMCAgIDAwMDAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgcXVpdEFwcDogPT5cbiAgICAgICAgXG4gICAgICAgIEBzdG9wV2F0Y2hlcigpXG4gICAgICAgIEBzYXZlQm91bmRzKClcbiAgICAgICAgcHJlZnMuc2F2ZSgpXG4gICAgICAgIFxuICAgICAgICBpZiAnZGVsYXknICE9IEBvcHQub25RdWl0PygpXG4gICAgICAgICAgICBAZXhpdEFwcCgpXG4gICAgICAgICAgICBcbiAgICBleGl0QXBwOiA9PlxuICAgICAgICBcbiAgICAgICAgQGFwcC5leGl0IDBcbiAgICAgICAgcHJvY2Vzcy5leGl0IDBcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgaGlkZURvY2s6ID0+IEBhcHAuZG9jaz8uaGlkZSgpXG4gICAgc2hvd0RvY2s6ID0+IEBhcHAuZG9jaz8uc2hvdygpXG4gICAgICAgIFxuICAgICMwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgICAwMDAwMDAwICAgMDAwICAgMDAwXG4gICAgIzAwMCAwIDAwMCAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgMCAwMDBcbiAgICAjMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMFxuICAgICMwMDAgICAwMDAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwXG4gICAgIzAwICAgICAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAwMCAgICAgMDBcbiAgICBcbiAgICB0b2dnbGVXaW5kb3c6ID0+XG4gICAgICAgICBcbiAgICAgICAgaWYgQHdpbj8uaXNWaXNpYmxlKClcbiAgICAgICAgICAgIEB3aW4uaGlkZSgpXG4gICAgICAgICAgICBAaGlkZURvY2soKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAc2hvd1dpbmRvdygpXG5cbiAgICB0b2dnbGVXaW5kb3dGcm9tVHJheTogPT4gQHNob3dXaW5kb3coKVxuICAgICAgICAgICAgXG4gICAgc2hvd1dpbmRvdzogPT5cbiAgICAgICAgXG4gICAgICAgIEBvcHQub25XaWxsU2hvd1dpbj8oKVxuICAgICAgICBcbiAgICAgICAgaWYgQHdpbj9cbiAgICAgICAgICAgIEB3aW4uc2hvdygpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBjcmVhdGVXaW5kb3coKVxuICAgICAgICAgICAgXG4gICAgICAgIEBzaG93RG9jaygpXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBjcmVhdGVXaW5kb3c6IChvblJlYWR5VG9TaG93KSA9PlxuICAgIFxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBcbiAgICAgICAgYm91bmRzID0gcHJlZnMuZ2V0ICdib3VuZHMnXG4gICAgICAgIHdpZHRoICA9IGJvdW5kcz8ud2lkdGggID8gQG9wdC53aWR0aCAgPyA1MDBcbiAgICAgICAgaGVpZ2h0ID0gYm91bmRzPy5oZWlnaHQgPyBAb3B0LmhlaWdodCA/IDUwMFxuICAgICAgICBcbiAgICAgICAgQHdpbiA9IG5ldyBlbGVjdHJvbi5Ccm93c2VyV2luZG93XG4gICAgICAgICAgICB3aWR0aDogICAgICAgICAgIHdpZHRoXG4gICAgICAgICAgICBoZWlnaHQ6ICAgICAgICAgIGhlaWdodFxuICAgICAgICAgICAgbWluV2lkdGg6ICAgICAgICBAb3B0Lm1pbldpZHRoICA/IDI1MFxuICAgICAgICAgICAgbWluSGVpZ2h0OiAgICAgICBAb3B0Lm1pbkhlaWdodCA/IDI1MFxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAnIzE4MTgxOCdcbiAgICAgICAgICAgIGZ1bGxzY3JlZW5lbmFibGU6IHRydWVcbiAgICAgICAgICAgIGZ1bGxzY3JlZW46ICAgICAgZmFsc2VcbiAgICAgICAgICAgIHNob3c6ICAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIGZyYW1lOiAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgIHJlc2l6YWJsZTogICAgICAgdHJ1ZVxuICAgICAgICAgICAgbWF4aW1pemFibGU6ICAgICB0cnVlXG4gICAgICAgICAgICBtaW5pbWl6YWJsZTogICAgIHRydWVcbiAgICAgICAgICAgIHRyYW5zcGFyZW50OiAgICAgdHJ1ZVxuICAgICAgICAgICAgYXV0b0hpZGVNZW51QmFyOiB0cnVlXG4gICAgICAgICAgICBpY29uOiAgICAgICAgICAgIEByZXNvbHZlIEBvcHQuaWNvbiBcbiAgICAgICAgICAgIHdlYlByZWZlcmVuY2VzOiBcbiAgICAgICAgICAgICAgICBub2RlSW50ZWdyYXRpb246IHRydWVcbiAgICBcbiAgICAgICAgQHdpbi5zZXRQb3NpdGlvbiBib3VuZHMueCwgYm91bmRzLnkgaWYgYm91bmRzP1xuICAgIFxuICAgICAgICBAd2luLmxvYWRVUkwgc2xhc2guZmlsZVVybCBAcmVzb2x2ZSBAb3B0LmluZGV4XG4gICAgICAgIEB3aW4ud2ViQ29udGVudHMub3BlbkRldlRvb2xzKCkgaWYgYXJncy5kZXZ0b29sc1xuICAgICAgICBAd2luLm9uICdyZXNpemUnLCBAc2F2ZUJvdW5kc1xuICAgICAgICBAd2luLm9uICdtb3ZlJywgICBAc2F2ZUJvdW5kc1xuICAgICAgICBAd2luLm9uICdjbG9zZWQnLCA9PiBAd2luID0gbnVsbFxuICAgICAgICBAd2luLm9uICdjbG9zZScsICA9PiBAaGlkZURvY2soKVxuICAgICAgICBAd2luLm9uICdyZWFkeS10by1zaG93JywgKGV2ZW50KSA9PiBcbiAgICAgICAgICAgIHdpbiA9IGV2ZW50LnNlbmRlclxuICAgICAgICAgICAgb25SZWFkeVRvU2hvdz8gd2luIFxuICAgICAgICAgICAgd2luLnNob3coKSBcbiAgICAgICAgICAgIHBvc3QuZW1pdCAnd2luUmVhZHknLCB3aW4uaWRcbiAgICAgICAgQHNob3dEb2NrKClcbiAgICAgICAgXG4gICAgICAgIEB3aW5cblxuICAgIHNhdmVCb3VuZHM6ID0+IGlmIEB3aW4/IHRoZW4gcHJlZnMuc2V0ICdib3VuZHMnLCBAd2luLmdldEJvdW5kcygpXG4gICAgc2NyZWVuU2l6ZTogLT4gXG4gICAgICAgIGVsZWN0cm9uID0gcmVxdWlyZSAnZWxlY3Ryb24nXG4gICAgICAgIGVsZWN0cm9uLnNjcmVlbi5nZXRQcmltYXJ5RGlzcGxheSgpLndvcmtBcmVhU2l6ZVxuICAgIFxuICAgICMgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAgICBcbiAgICAjIDAwMCAwIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICBcbiAgICAjIDAwICAgICAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgICAgXG4gICAgICAgIFxuICAgIHN0YXJ0V2F0Y2hlcjogPT5cbiAgICAgICAgXG4gICAgICAgIEBvcHQuZGlyID0gc2xhc2gucmVzb2x2ZSBAb3B0LmRpclxuICAgICAgICBjb25zb2xlLmxvZyAnc3RhcnRXYXRjaGVyJywgQG9wdC5kaXJcbiAgICAgICAgd2F0Y2hlciA9IHdhdGNoLmRpciBAb3B0LmRpclxuICAgICAgICB3YXRjaGVyLm9uICdjaGFuZ2UnLCBAb25TcmNDaGFuZ2VcbiAgICAgICAgd2F0Y2hlci5vbiAnZXJyb3InLCAoZXJyKSAtPiBlcnJvciBlcnJcbiAgICAgICAgQHdhdGNoZXJzLnB1c2ggd2F0Y2hlclxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIGVtcHR5IEBvcHQuZGlyc1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2cgJ3N0YXJ0V2F0Y2hlcnMnLCBAb3B0LmRpcnNcbiAgICAgICAgZm9yIGRpciBpbiBAb3B0LmRpcnNcbiAgICAgICAgICAgIHdhdGNoZXIgPSB3YXRjaC5kaXIgc2xhc2gucmVzb2x2ZSBzbGFzaC5qb2luIEBvcHQuZGlyLCBkaXJcbiAgICAgICAgICAgIHdhdGNoZXIub24gJ2NoYW5nZScsIEBvblNyY0NoYW5nZVxuICAgICAgICAgICAgd2F0Y2hlci5vbiAnZXJyb3InLCAoZXJyKSAtPiBlcnJvciBlcnJcbiAgICAgICAgICAgIEB3YXRjaGVycy5wdXNoIHdhdGNoZXIgXG4gICAgXG4gICAgc3RvcFdhdGNoZXI6ID0+XG4gICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIGVtcHR5IEB3YXRjaGVyc1xuICAgICAgICBmb3Igd2F0Y2hlciBpbiBAd2F0Y2hlcnNcbiAgICAgICAgICAgIHdhdGNoZXIuY2xvc2UoKVxuICAgICAgICBAd2F0Y2hlcnMgPSBbXVxuICAgIFxuICAgIG9uU3JjQ2hhbmdlOiAoaW5mbykgPT5cbiAgICBcbiAgICAgICAgbG9nIFwib25TcmNDaGFuZ2UgJyN7aW5mby5jaGFuZ2V9J1wiLCBpbmZvLnBhdGhcbiAgICAgICAgaWYgc2xhc2guYmFzZShpbmZvLnBhdGgpID09ICdtYWluJ1xuICAgICAgICAgICAgQHN0b3BXYXRjaGVyKClcbiAgICAgICAgICAgIEBhcHAuZXhpdCAwXG4gICAgICAgICAgICBpZiBwa2cgPSBzbGFzaC5wa2cgQG9wdC5kaXJcbiAgICAgICAgICAgICAgICBpZiBzbGFzaC5pc0RpciBzbGFzaC5qb2luIHBrZywgJ25vZGVfbW9kdWxlcydcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRwLmV4ZWNTeW5jIFwiI3twa2d9L25vZGVfbW9kdWxlcy8uYmluL2VsZWN0cm9uIC4gLXdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGN3ZDogICAgICBwa2dcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCdcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZGlvOiAgICAnaW5oZXJpdCdcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoZWxsOiAgICB0cnVlXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCAwXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICBwb3N0LnRvV2lucyAnbWVudUFjdGlvbicsICdSZWxvYWQnXG4gICAgICAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IEFwcFxuICAgICJdfQ==
//# sourceURL=../coffee/app.coffee