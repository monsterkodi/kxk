(function() {
  /*
  00000000    0000000   00000000   000   000  00000000   000   000  000  000   000  
  000   000  000   000  000   000  000   000  000   000  000 0 000  000  0000  000  
  00000000   000   000  00000000   000   000  00000000   000000000  000  000 0 000  
  000        000   000  000        000   000  000        000   000  000  000  0000  
  000         0000000   000         0000000   000        00     00  000  000   000  
  */
  var PopupWindow, _, elem, keyinfo, slash;

  ({keyinfo, slash, elem, _} = require('./kxk'));

  PopupWindow = (function() {
    class PopupWindow {
      
      //  0000000  000   000   0000000   000   000  
      // 000       000   000  000   000  000 0 000  
      // 0000000   000000000  000   000  000000000  
      //      000  000   000  000   000  000   000  
      // 0000000   000   000   0000000   00     00  
      static show(opt) {
        var Browser, electron, html, i, item, len, popupOpt, ref, ref1, remote, win;
        electron = require('electron');
        PopupWindow.opt = opt;
        popupOpt = {
          winID: electron.remote.getCurrentWindow().id,
          items: []
        };
        ref = opt.items;
        for (i = 0, len = ref.length; i < len; i++) {
          item = ref[i];
          if (!item.hide) {
            popupOpt.items.push({
              text: item.text,
              combo: item.combo
            });
          }
        }
        remote = electron.remote;
        Browser = remote.BrowserWindow;
        electron.ipcRenderer.on('popupItem', PopupWindow.onPopupItem);
        electron.ipcRenderer.on('popupClose', PopupWindow.close);
        if (PopupWindow.win != null) {
          PopupWindow.win.setPosition(opt.x, opt.y);
        } else {
          win = new Browser({
            x: opt.x,
            y: opt.y,
            backgroundColor: (ref1 = opt.background) != null ? ref1 : '#222',
            hasShadow: true,
            show: false,
            frame: false,
            resizable: false,
            minimizable: false,
            maximizable: false,
            fullscreenable: false,
            webPreferences: {
              webSecurity: false
            },
            width: 240,
            height: popupOpt.items.length * 28
          });
          win.on('blur', PopupWindow.close);
          PopupWindow.win = win;
        }
        html = `<link rel='stylesheet' href="${slash.fileUrl(opt.stylesheet)}" type='text/css'>\n<body>\n<script>\n    var PopupWindow = require("${slash.path(__dirname)}/popupWindow");\n    new PopupWindow(${JSON.stringify(popupOpt)});\n</script>\n</body>`;
        PopupWindow.win.loadURL("data:text/html;charset=utf-8," + encodeURI(html));
        PopupWindow.win.webContents.on('did-finish-load', function() {
          return PopupWindow.win.show();
        });
        return PopupWindow.win;
      }

      static onPopupItem(e, text) {
        var i, item, len, ref, results;
        PopupWindow.close();
        ref = PopupWindow.opt.items;
        results = [];
        for (i = 0, len = ref.length; i < len; i++) {
          item = ref[i];
          if (item.text === text) {
            if (typeof item.cb === "function") {
              item.cb();
            }
            break;
          } else {
            results.push(void 0);
          }
        }
        return results;
      }

      static close() {
        var electron, ref;
        electron = require('electron');
        electron.ipcRenderer.removeListener('popupItem', PopupWindow.onPopupItem);
        electron.ipcRenderer.removeListener('popupClose', PopupWindow.close);
        return (ref = PopupWindow.win) != null ? ref.hide() : void 0;
      }

      // 00000000    0000000   00000000   000   000  00000000   
      // 000   000  000   000  000   000  000   000  000   000  
      // 00000000   000   000  00000000   000   000  00000000   
      // 000        000   000  000        000   000  000        
      // 000         0000000   000         0000000   000        
      constructor(opt) {
        var combo, div, i, item, len, ref, ref1;
        this.close = this.close.bind(this);
        this.onHover = this.onHover.bind(this);
        this.onKeyDown = this.onKeyDown.bind(this);
        this.onClick = this.onClick.bind(this);
        this.items = elem({
          class: 'popupWindow',
          tabindex: 1
        });
        this.targetWinID = opt.winID;
        ref = opt.items;
        for (i = 0, len = ref.length; i < len; i++) {
          item = ref[i];
          if (item.hide) {
            continue;
          }
          div = elem({
            class: 'popupItem',
            text: item.text
          });
          div.item = item;
          div.addEventListener('click', this.onClick);
          if (item.combo != null) {
            combo = elem('span', {
              class: 'popupCombo',
              text: item.combo
            });
            div.appendChild(combo);
          }
          this.items.appendChild(div);
        }
        this.select(this.items.firstChild);
        ((ref1 = opt.parent) != null ? ref1 : document.body).appendChild(this.items);
        this.items.addEventListener('keydown', this.onKeyDown);
        this.items.addEventListener('focusout', this.onFocusOut);
        this.items.addEventListener('mouseover', this.onHover);
        this.items.focus();
        this.getWin().setSize(parseInt(this.items.getBoundingClientRect().width), parseInt(this.items.getBoundingClientRect().height));
      }

      close() {
        var electron, ref, ref1, ref2, ref3, targetWin;
        electron = require('electron');
        if ((ref = this.items) != null) {
          ref.removeEventListener('keydown', this.onKeyDown);
        }
        if ((ref1 = this.items) != null) {
          ref1.removeEventListener('focusout', this.onFocusOut);
        }
        if ((ref2 = this.items) != null) {
          ref2.removeEventListener('mouseover', this.onHover);
        }
        if ((ref3 = this.items) != null) {
          ref3.remove();
        }
        delete this.items;
        targetWin = electron.remote.BrowserWindow.fromId(this.targetWinID);
        return targetWin.webContents.send('popupClose');
      }

      getWin() {
        return require('electron').remote.getCurrentWindow();
      }

      select(item) {
        var ref;
        if (item == null) {
          return;
        }
        if ((ref = this.selected) != null) {
          ref.classList.remove('selected');
        }
        this.selected = item;
        return this.selected.classList.add('selected');
      }

      activate(item) {
        var electron, ref, targetWin;
        electron = require('electron');
        targetWin = electron.remote.BrowserWindow.fromId(this.targetWinID);
        targetWin.webContents.send('popupItem', (ref = item.item.ipc) != null ? ref : item.item.text);
        return this.close();
      }

      onHover(event) {
        return this.select(event.target);
      }

      onKeyDown(event) {
        var combo, electron, key, mod, ref, ref1, ref2, ref3, ref4, ref5, targetWin;
        electron = require('electron');
        ({mod, key, combo} = keyinfo.forEvent(event));
        switch (combo) {
          case 'end':
          case 'page down':
            return this.select(this.items.lastChild);
          case 'home':
          case 'page up':
            return this.select(this.items.firstChild);
          case 'enter':
            return this.activate(this.selected);
          case 'esc':
          case 'space':
            return this.close();
          case 'down':
            return this.select((ref = (ref1 = this.selected) != null ? ref1.nextSibling : void 0) != null ? ref : this.items.firstChild);
          case 'up':
            return this.select((ref2 = (ref3 = this.selected) != null ? ref3.previousSibling : void 0) != null ? ref2 : this.items.lastChild);
          case 'right':
            return this.select((ref4 = this.selected) != null ? ref4.nextSibling : void 0);
          case 'left':
            return this.select((ref5 = this.selected) != null ? ref5.previousSibling : void 0);
        }
        if (key.length < 1) {
          return;
        }
        targetWin = electron.remote.BrowserWindow.fromId(this.targetWinID);
        targetWin.webContents.send('popupModKeyCombo', mod, key, combo);
        return this.close();
      }

      onClick(e) {
        return this.activate(e.target);
      }

    };

    PopupWindow.win = null;

    PopupWindow.opt = null;

    PopupWindow.popup = null;

    return PopupWindow;

  }).call(this);

  module.exports = PopupWindow;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXB3aW5kb3cuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3BvcHVwd2luZG93LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxXQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxPQUFBLEVBQUE7O0VBUUEsQ0FBQSxDQUFFLE9BQUYsRUFBVyxLQUFYLEVBQWtCLElBQWxCLEVBQXdCLENBQXhCLENBQUEsR0FBOEIsT0FBQSxDQUFRLE9BQVIsQ0FBOUI7O0VBRU07SUFBTixNQUFBLFlBQUEsQ0FBQTs7Ozs7OztNQVlXLE9BQU4sSUFBTSxDQUFDLEdBQUQsQ0FBQTtBQUVILFlBQUEsT0FBQSxFQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsUUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLEVBQUEsTUFBQSxFQUFBO1FBQUEsUUFBQSxHQUFXLE9BQUEsQ0FBUSxVQUFSO1FBRVgsV0FBVyxDQUFDLEdBQVosR0FBa0I7UUFFbEIsUUFBQSxHQUNJO1VBQUEsS0FBQSxFQUFPLFFBQVEsQ0FBQyxNQUFNLENBQUMsZ0JBQWhCLENBQUEsQ0FBa0MsQ0FBQyxFQUExQztVQUNBLEtBQUEsRUFBTTtRQUROO0FBRUo7UUFBQSxLQUFBLHFDQUFBOztVQUNJLElBQUcsQ0FBSSxJQUFJLENBQUMsSUFBWjtZQUNJLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBZixDQUNJO2NBQUEsSUFBQSxFQUFNLElBQUksQ0FBQyxJQUFYO2NBQ0EsS0FBQSxFQUFPLElBQUksQ0FBQztZQURaLENBREosRUFESjs7UUFESjtRQU1BLE1BQUEsR0FBVyxRQUFRLENBQUM7UUFDcEIsT0FBQSxHQUFXLE1BQU0sQ0FBQztRQUVsQixRQUFRLENBQUMsV0FBVyxDQUFDLEVBQXJCLENBQXdCLFdBQXhCLEVBQXFDLFdBQVcsQ0FBQyxXQUFqRDtRQUNBLFFBQVEsQ0FBQyxXQUFX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QUFELDBGQUFxQyxJQUFDLENBQUEsS0FBSyxDQUFDLFNBQTVDO0FBTnhDLGVBT1MsT0FQVDtBQU9pQyxtQkFBTyxJQUFDLENBQUEsTUFBRCxzQ0FBaUIsQ0FBRSxvQkFBbkI7QUFQeEMsZUFRUyxNQVJUO0FBUWlDLG1CQUFPLElBQUMsQ0FBQSxNQUFELHNDQUFpQixDQUFFLHdCQUFuQjtBQVJ4QztRQVNBLElBQVUsR0FBRyxDQUFDLE1BQUosR0FBYSxDQUF2QjtBQUFBLGlCQUFBOztRQUNBLFNBQUEsR0FBWSxRQUFRLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUE5QixDQUFxQyxJQUFDLENBQUEsV0FBdEM7UUFDWixTQUFTLENBQUMsV0FBVyxDQUFDLElBQXRCLENBQTJCLGtCQUEzQixFQUErQyxHQUEvQyxFQUFvRCxHQUFwRCxFQUF5RCxLQUF6RDtlQUNBLElBQUMsQ0FBQSxLQUFELENBQUE7TUFoQk87O01Ba0JYLE9BQVMsQ0FBQyxDQUFELENBQUE7ZUFBTyxJQUFDLENBQUEsUUFBRCxDQUFVLENBQUMsQ0FBQyxNQUFaO01BQVA7O0lBcEtiOztJQUVJLFdBQUMsQ0FBQSxHQUFELEdBQVM7O0lBQ1QsV0FBQyxDQUFBLEdBQUQsR0FBUzs7SUFDVCxXQUFDLENBQUEsS0FBRCxHQUFTOzs7Ozs7RUFrS2IsTUFBTSxDQUFDLE9BQVAsR0FBaUI7QUFoTGpCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgXG4wMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgIDAwMDAgIDAwMCAgXG4wMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgIDAwMCAwIDAwMCAgXG4wMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMCAgMDAwMCAgXG4wMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAgMDAgICAgIDAwICAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyBrZXlpbmZvLCBzbGFzaCwgZWxlbSwgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbmNsYXNzIFBvcHVwV2luZG93XG4gICAgXG4gICAgQHdpbiAgID0gbnVsbFxuICAgIEBvcHQgICA9IG51bGxcbiAgICBAcG9wdXAgPSBudWxsXG4gICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwICAgICAwMCAgXG4gICAgXG4gICAgQHNob3c6IChvcHQpIC0+XG4gICAgICAgIFxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBcbiAgICAgICAgUG9wdXBXaW5kb3cub3B0ID0gb3B0ICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIHBvcHVwT3B0ID0gXG4gICAgICAgICAgICB3aW5JRDogZWxlY3Ryb24ucmVtb3RlLmdldEN1cnJlbnRXaW5kb3coKS5pZFxuICAgICAgICAgICAgaXRlbXM6W11cbiAgICAgICAgZm9yIGl0ZW0gaW4gb3B0Lml0ZW1zXG4gICAgICAgICAgICBpZiBub3QgaXRlbS5oaWRlXG4gICAgICAgICAgICAgICAgcG9wdXBPcHQuaXRlbXMucHVzaFxuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBpdGVtLnRleHRcbiAgICAgICAgICAgICAgICAgICAgY29tYm86IGl0ZW0uY29tYm9cbiAgICAgICAgXG4gICAgICAgIHJlbW90ZSAgID0gZWxlY3Ryb24ucmVtb3RlXG4gICAgICAgIEJyb3dzZXIgID0gcmVtb3RlLkJyb3dzZXJXaW5kb3dcbiAgICAgICAgXG4gICAgICAgIGVsZWN0cm9uLmlwY1JlbmRlcmVyLm9uICdwb3B1cEl0ZW0nLCBQb3B1cFdpbmRvdy5vblBvcHVwSXRlbVxuICAgICAgICBlbGVjdHJvbi5pcGNSZW5kZXJlci5vbiAncG9wdXBDbG9zZScsIFBvcHVwV2luZG93LmNsb3NlXG4gICAgICAgIFxuICAgICAgICBpZiBQb3B1cFdpbmRvdy53aW4/XG4gICAgICAgICAgICBQb3B1cFdpbmRvdy53aW4uc2V0UG9zaXRpb24gb3B0LngsIG9wdC55XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHdpbiA9IG5ldyBCcm93c2VyXG4gICAgICAgICAgICAgICAgeDogICAgICAgICAgICAgICBvcHQueFxuICAgICAgICAgICAgICAgIHk6ICAgICAgICAgICAgICAgb3B0LnlcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IG9wdC5iYWNrZ3JvdW5kID8gJyMyMjInXG4gICAgICAgICAgICAgICAgaGFzU2hhZG93OiAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgc2hvdzogICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgICAgIGZyYW1lOiAgICAgICAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICByZXNpemFibGU6ICAgICAgIGZhbHNlXG4gICAgICAgICAgICAgICAgbWluaW1pemFibGU6ICAgICBmYWxzZVxuICAgICAgICAgICAgICAgIG1heGltaXphYmxlOiAgICAgZmFsc2VcbiAgICAgICAgICAgICAgICBmdWxsc2NyZWVuYWJsZTogIGZhbHNlXG4gICAgICAgICAgICAgICAgd2ViUHJlZmVyZW5jZXM6XG4gICAgICAgICAgICAgICAgICAgIHdlYlNlY3VyaXR5OiBmYWxzZVxuICAgICAgICAgICAgICAgIHdpZHRoOiAgICAgICAgICAgMjQwXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAgICAgICAgICBwb3B1cE9wdC5pdGVtcy5sZW5ndGggKiAyOFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHdpbi5vbiAnYmx1cicsIFBvcHVwV2luZG93LmNsb3NlXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBQb3B1cFdpbmRvdy53aW4gPSB3aW5cbiAgICAgICAgICAgIFxuICAgICAgICBodG1sID0gXCJcIlwiXG4gICAgICAgICAgICA8bGluayByZWw9J3N0eWxlc2hlZXQnIGhyZWY9XCIje3NsYXNoLmZpbGVVcmwgb3B0LnN0eWxlc2hlZXR9XCIgdHlwZT0ndGV4dC9jc3MnPlxuICAgICAgICAgICAgPGJvZHk+XG4gICAgICAgICAgICA8c2NyaXB0PlxuICAgICAgICAgICAgICAgIHZhciBQb3B1cFdpbmRvdyA9IHJlcXVpcmUoXCIje3NsYXNoLnBhdGggX19kaXJuYW1lfS9wb3B1cFdpbmRvd1wiKTtcbiAgICAgICAgICAgICAgICBuZXcgUG9wdXBXaW5kb3coI3tKU09OLnN0cmluZ2lmeSBwb3B1cE9wdH0pO1xuICAgICAgICAgICAgPC9zY3JpcHQ+XG4gICAgICAgICAgICA8L2JvZHk+XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBQb3B1cFdpbmRvdy53aW4ubG9hZFVSTCBcImRhdGE6dGV4dC9odG1sO2NoYXJzZXQ9dXRmLTgsXCIgKyBlbmNvZGVVUkkgaHRtbFxuICAgICAgICBQb3B1cFdpbmRvdy53aW4ud2ViQ29udGVudHMub24gJ2RpZC1maW5pc2gtbG9hZCcsIC0+XG4gICAgICAgICAgICBQb3B1cFdpbmRvdy53aW4uc2hvdygpXG4gICAgICAgICAgICBcbiAgICAgICAgUG9wdXBXaW5kb3cud2luXG5cbiAgICBAb25Qb3B1cEl0ZW06IChlLHRleHQpIC0+IFxuICAgICAgICBcbiAgICAgICAgUG9wdXBXaW5kb3cuY2xvc2UoKVxuICAgICAgICBmb3IgaXRlbSBpbiBQb3B1cFdpbmRvdy5vcHQuaXRlbXNcbiAgICAgICAgICAgIGlmIGl0ZW0udGV4dCA9PSB0ZXh0XG4gICAgICAgICAgICAgICAgaXRlbS5jYj8oKVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIFxuICAgIEBjbG9zZTogLT4gXG4gICAgICAgIFxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBlbGVjdHJvbi5pcGNSZW5kZXJlci5yZW1vdmVMaXN0ZW5lciAncG9wdXBJdGVtJywgIFBvcHVwV2luZG93Lm9uUG9wdXBJdGVtXG4gICAgICAgIGVsZWN0cm9uLmlwY1JlbmRlcmVyLnJlbW92ZUxpc3RlbmVyICdwb3B1cENsb3NlJywgUG9wdXBXaW5kb3cuY2xvc2VcbiAgICAgICAgXG4gICAgICAgIFBvcHVwV2luZG93Lndpbj8uaGlkZSgpXG5cbiAgICAjIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgICBcbiAgICAjIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgICAgICBcbiAgICBcbiAgICBjb25zdHJ1Y3RvcjogKG9wdCkgLT5cbiAgICAgICAgXG4gICAgICAgIEBpdGVtcyA9IGVsZW0gY2xhc3M6ICdwb3B1cFdpbmRvdycsIHRhYmluZGV4OiAxXG4gICAgICAgIEB0YXJnZXRXaW5JRCA9IG9wdC53aW5JRFxuICAgICAgICBmb3IgaXRlbSBpbiBvcHQuaXRlbXNcbiAgICAgICAgICAgIGNvbnRpbnVlIGlmIGl0ZW0uaGlkZVxuICAgICAgICAgICAgZGl2ID0gZWxlbSBjbGFzczogJ3BvcHVwSXRlbScsIHRleHQ6IGl0ZW0udGV4dFxuICAgICAgICAgICAgZGl2Lml0ZW0gPSBpdGVtXG4gICAgICAgICAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lciAnY2xpY2snLCBAb25DbGlja1xuICAgICAgICAgICAgaWYgaXRlbS5jb21ibz9cbiAgICAgICAgICAgICAgICBjb21ibyA9IGVsZW0gJ3NwYW4nLCBjbGFzczogJ3BvcHVwQ29tYm8nLCB0ZXh0OiBpdGVtLmNvbWJvXG4gICAgICAgICAgICAgICAgZGl2LmFwcGVuZENoaWxkIGNvbWJvXG4gICAgICAgICAgICBAaXRlbXMuYXBwZW5kQ2hpbGQgZGl2XG5cbiAgICAgICAgQHNlbGVjdCBAaXRlbXMuZmlyc3RDaGlsZFxuXG4gICAgICAgIChvcHQucGFyZW50ID8gZG9jdW1lbnQuYm9keSkuYXBwZW5kQ2hpbGQgQGl0ZW1zXG5cbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ2tleWRvd24nLCAgIEBvbktleURvd25cbiAgICAgICAgQGl0ZW1zLmFkZEV2ZW50TGlzdGVuZXIgJ2ZvY3Vzb3V0JywgIEBvbkZvY3VzT3V0XG4gICAgICAgIEBpdGVtcy5hZGRFdmVudExpc3RlbmVyICdtb3VzZW92ZXInLCBAb25Ib3ZlclxuICAgICAgICBAaXRlbXMuZm9jdXMoKVxuXG4gICAgICAgIEBnZXRXaW4oKS5zZXRTaXplIHBhcnNlSW50KEBpdGVtcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlSW50KEBpdGVtcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpXG4gICAgICAgIFxuICAgIGNsb3NlOiA9PlxuICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgQGl0ZW1zPy5yZW1vdmVFdmVudExpc3RlbmVyICdrZXlkb3duJywgICBAb25LZXlEb3duXG4gICAgICAgIEBpdGVtcz8ucmVtb3ZlRXZlbnRMaXN0ZW5lciAnZm9jdXNvdXQnLCAgQG9uRm9jdXNPdXRcbiAgICAgICAgQGl0ZW1zPy5yZW1vdmVFdmVudExpc3RlbmVyICdtb3VzZW92ZXInLCBAb25Ib3ZlclxuICAgICAgICBAaXRlbXM/LnJlbW92ZSgpXG4gICAgICAgIGRlbGV0ZSBAaXRlbXNcbiAgICAgICAgdGFyZ2V0V2luID0gZWxlY3Ryb24ucmVtb3RlLkJyb3dzZXJXaW5kb3cuZnJvbUlkIEB0YXJnZXRXaW5JRFxuICAgICAgICB0YXJnZXRXaW4ud2ViQ29udGVudHMuc2VuZCAncG9wdXBDbG9zZSdcblxuICAgIGdldFdpbjogLT4gcmVxdWlyZSgnZWxlY3Ryb24nKS5yZW1vdGUuZ2V0Q3VycmVudFdpbmRvdygpXG5cbiAgICBzZWxlY3Q6IChpdGVtKSAtPiBcbiAgICAgICAgcmV0dXJuIGlmIG5vdCBpdGVtP1xuICAgICAgICBAc2VsZWN0ZWQ/LmNsYXNzTGlzdC5yZW1vdmUgJ3NlbGVjdGVkJ1xuICAgICAgICBAc2VsZWN0ZWQgPSBpdGVtXG4gICAgICAgIEBzZWxlY3RlZC5jbGFzc0xpc3QuYWRkICdzZWxlY3RlZCdcbiAgICAgICAgXG4gICAgYWN0aXZhdGU6IChpdGVtKSAtPlxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICB0YXJnZXRXaW4gPSBlbGVjdHJvbi5yZW1vdGUuQnJvd3NlcldpbmRvdy5mcm9tSWQgQHRhcmdldFdpbklEXG4gICAgICAgIHRhcmdldFdpbi53ZWJDb250ZW50cy5zZW5kICdwb3B1cEl0ZW0nLCBpdGVtLml0ZW0uaXBjID8gaXRlbS5pdGVtLnRleHRcbiAgICAgICAgQGNsb3NlKClcbiAgICAgXG4gICAgb25Ib3ZlcjogKGV2ZW50KSA9PiBAc2VsZWN0IGV2ZW50LnRhcmdldCAgIFxuICAgIFxuICAgIG9uS2V5RG93bjogKGV2ZW50KSA9PlxuICAgICAgICBcbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgeyBtb2QsIGtleSwgY29tYm8gfSA9IGtleWluZm8uZm9yRXZlbnQgZXZlbnRcbiAgICAgICAgc3dpdGNoIGNvbWJvXG4gICAgICAgICAgICB3aGVuICdlbmQnLCAncGFnZSBkb3duJyB0aGVuIHJldHVybiBAc2VsZWN0IEBpdGVtcy5sYXN0Q2hpbGRcbiAgICAgICAgICAgIHdoZW4gJ2hvbWUnLCAncGFnZSB1cCcgIHRoZW4gcmV0dXJuIEBzZWxlY3QgQGl0ZW1zLmZpcnN0Q2hpbGRcbiAgICAgICAgICAgIHdoZW4gJ2VudGVyJyAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBhY3RpdmF0ZSBAc2VsZWN0ZWRcbiAgICAgICAgICAgIHdoZW4gJ2VzYycsICdzcGFjZScgICAgIHRoZW4gcmV0dXJuIEBjbG9zZSgpXG4gICAgICAgICAgICB3aGVuICdkb3duJyAgICAgICAgICAgICB0aGVuIHJldHVybiBAc2VsZWN0IEBzZWxlY3RlZD8ubmV4dFNpYmxpbmcgPyBAaXRlbXMuZmlyc3RDaGlsZCBcbiAgICAgICAgICAgIHdoZW4gJ3VwJyAgICAgICAgICAgICAgIHRoZW4gcmV0dXJuIEBzZWxlY3QgQHNlbGVjdGVkPy5wcmV2aW91c1NpYmxpbmcgPyBAaXRlbXMubGFzdENoaWxkIFxuICAgICAgICAgICAgd2hlbiAncmlnaHQnICAgICAgICAgICAgdGhlbiByZXR1cm4gQHNlbGVjdCBAc2VsZWN0ZWQ/Lm5leHRTaWJsaW5nXG4gICAgICAgICAgICB3aGVuICdsZWZ0JyAgICAgICAgICAgICB0aGVuIHJldHVybiBAc2VsZWN0IEBzZWxlY3RlZD8ucHJldmlvdXNTaWJsaW5nXG4gICAgICAgIHJldHVybiBpZiBrZXkubGVuZ3RoIDwgMVxuICAgICAgICB0YXJnZXRXaW4gPSBlbGVjdHJvbi5yZW1vdGUuQnJvd3NlcldpbmRvdy5mcm9tSWQgQHRhcmdldFdpbklEXG4gICAgICAgIHRhcmdldFdpbi53ZWJDb250ZW50cy5zZW5kICdwb3B1cE1vZEtleUNvbWJvJywgbW9kLCBrZXksIGNvbWJvXG4gICAgICAgIEBjbG9zZSgpXG4gICAgIFxuICAgIG9uQ2xpY2s6IChlKSA9PiBAYWN0aXZhdGUgZS50YXJnZXRcblxubW9kdWxlLmV4cG9ydHMgPSBQb3B1cFdpbmRvd1xuIl19
//# sourceURL=../coffee/popupwindow.coffee