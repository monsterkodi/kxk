(function() {
  /*
  00000000   00000000   00000000  00000000   0000000
  000   000  000   000  000       000       000     
  00000000   0000000    0000000   000000    0000000 
  000        000   000  000       000            000
  000        000   000  00000000  000       0000000 
  */
  var Prefs, error, log, store, watch;

  ({store, watch, error, log} = require('./kxk'));

  Prefs = (function() {
    class Prefs {
      static init(defs = {}) {
        if (this.store != null) {
          return error('prefs.init -- duplicate stores?');
        }
        this.store = new store('prefs', {
          defaults: defs
        });
        this.store.on('willSave', this.unwatch);
        this.store.on('didSave', this.watch);
        return this.watch();
      }

      static unwatch() {
        var ref;
        if (Prefs.store.app == null) {
          return;
        }
        if ((ref = Prefs.watcher) != null) {
          ref.close();
        }
        return Prefs.watcher = null;
      }

      static watch() {
        if (Prefs.store.app == null) {
          return;
        }
        Prefs.unwatch();
        Prefs.watcher = watch.watch(Prefs.store.file, {
          ignoreInitial: true,
          usePolling: false,
          useFsEvents: true
        });
        return Prefs.watcher.on('change', Prefs.onFileChange).on('unlink', Prefs.onFileUnlink).on('error', function(err) {
          return log('Prefs watch error', err);
        });
      }

      static onFileChange() {
        return Prefs.store.reload();
      }

      static onFileUnlink() {
        Prefs.unwatch();
        return Prefs.store.clear();
      }

      static get(key, value) {
        if (this.store) {
          return this.store.get(key, value);
        } else {
          return value;
        }
      }

      static set(key, value) {
        this.unwatch();
        this.store.set(key, value);
        return this.watch();
      }

      static del(key, value) {
        this.unwatch();
        this.store.del(key);
        return this.watch();
      }

      static save() {
        var ref;
        return (ref = this.store) != null ? ref.save() : void 0;
      }

    };

    Prefs.store = null;

    Prefs.watcher = null;

    return Prefs;

  }).call(this);

  module.exports = Prefs;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlZnMuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbImNvZmZlZS9wcmVmcy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFBQTs7Ozs7OztBQUFBLE1BQUEsS0FBQSxFQUFBLEtBQUEsRUFBQSxHQUFBLEVBQUEsS0FBQSxFQUFBOztFQVFBLENBQUEsQ0FBRSxLQUFGLEVBQVMsS0FBVCxFQUFnQixLQUFoQixFQUF1QixHQUF2QixDQUFBLEdBQStCLE9BQUEsQ0FBUSxPQUFSLENBQS9COztFQUVNO0lBQU4sTUFBQSxNQUFBO01BS1csT0FBTixJQUFNLENBQUMsT0FBSyxDQUFBLENBQU4sQ0FBQTtRQUVILElBQWtELGtCQUFsRDtBQUFBLGlCQUFPLEtBQUEsQ0FBTSxpQ0FBTixFQUFQOztRQUNBLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsT0FBVixFQUFtQjtVQUFBLFFBQUEsRUFBUztRQUFULENBQW5CO1FBQ1QsSUFBQyxDQUFBLEtBQUssQ0FBQyxFQUFQLENBQVUsVUFBVixFQUFzQixJQUFDLENBQUEsT0FBdkI7UUFDQSxJQUFDLENBQUEsS0FBSyxDQUFDLEVBQVAsQ0FBVSxTQUFWLEVBQXNCLElBQUMsQ0FBQSxLQUF2QjtlQUNBLElBQUMsQ0FBQSxLQUFELENBQUE7TUFORzs7TUFRRyxPQUFULE9BQVMsQ0FBQSxDQUFBO0FBRU4sWUFBQTtRQUFBLElBQWMsdUJBQWQ7QUFBQSxpQkFBQTs7O2FBRVEsQ0FBRSxLQUFWLENBQUE7O2VBQ0EsS0FBQyxDQUFBLE9BQUQsR0FBVztNQUxMOztNQU9GLE9BQVAsS0FBTyxDQUFBLENBQUE7UUFFSixJQUFjLHVCQUFkO0FBQUEsaUJBQUE7O1FBRUEsS0FBQyxDQUFBLE9BQUQsQ0FBQTtRQUNBLEtBQUMsQ0FBQSxPQUFELEdBQVcsS0FBSyxDQUFDLEtBQU4sQ0FBWSxLQUFDLENBQUEsS0FBSyxDQUFDLElBQW5CLEVBQ1A7VUFBQSxhQUFBLEVBQWdCLElBQWhCO1VBQ0EsVUFBQSxFQUFnQixLQURoQjtVQUVBLFdBQUEsRUFBZ0I7UUFGaEIsQ0FETztlQUtYLEtBQUMsQ0FBQSxPQUNHLENBQUMsRUFETCxDQUNRLFFBRFIsRUFDa0IsS0FBQyxDQUFBLFlBRG5CLENBRUksQ0FBQyxFQUZMLENBRVEsUUFGUixFQUVrQixLQUFDLENBQUEsWUFGbkIsQ0FHSSxDQUFDLEVBSEwsQ0FHUSxPQUhSLEVBR2tCLFFBQUEsQ0FBQyxHQUFELENBQUE7aUJBQVMsR0FBQSxDQUFJLG1CQUFKLEVBQXlCLEdBQXpCO1FBQVQsQ0FIbEI7TUFWSTs7TUFlTyxPQUFkLFlBQWMsQ0FBQSxDQUFBO2VBQUcsS0FBQyxDQUFBLEtBQUssQ0FBQyxNQUFQLENBQUE7TUFBSDs7TUFDQSxPQUFkLFlBQWMsQ0FBQSxDQUFBO1FBQUcsS0FBQyxDQUFBLE9BQUQsQ0FBQTtlQUFZLEtBQUMsQ0FBQSxLQUFLLENBQUMsS0FBUCxDQUFBO01BQWY7O01BRVIsT0FBTixHQUFNLENBQUMsR0FBRCxFQUFNLEtBQU4sQ0FBQTtRQUFnQixJQUFHLElBQUMsQ0FBQSxLQUFKO2lCQUFlLElBQUMsQ0FBQSxLQUFLLENBQUMsR0FBUCxDQUFXLEdBQVgsRUFBZ0IsS0FBaEIsRUFBZjtTQUFBLE1BQUE7aUJBQTBDLE1BQTFDOztNQUFoQjs7TUFDQSxPQUFOLEdBQU0sQ0FBQyxHQUFELEVBQU0sS0FBTixDQUFBO1FBQWdCLElBQUMsQ0FBQSxPQUFELENBQUE7UUFBWSxJQUFDLENBQUEsS0FBSyxDQUFDLEdBQVAsQ0FBVyxHQUFYLEVBQWdCLEtBQWhCO2VBQXdCLElBQUMsQ0FBQSxLQUFELENBQUE7TUFBcEQ7O01BQ0EsT0FBTixHQUFNLENBQUMsR0FBRCxFQUFNLEtBQU4sQ0FBQTtRQUFnQixJQUFDLENBQUEsT0FBRCxDQUFBO1FBQVksSUFBQyxDQUFBLEtBQUssQ0FBQyxHQUFQLENBQVcsR0FBWDtlQUFpQixJQUFDLENBQUEsS0FBRCxDQUFBO01BQTdDOztNQUNhLE9BQW5CLElBQW1CLENBQUEsQ0FBQTtBQUFHLFlBQUE7K0NBQU0sQ0FBRSxJQUFSLENBQUE7TUFBSDs7SUF6Q3hCOztJQUVJLEtBQUMsQ0FBQSxLQUFELEdBQVc7O0lBQ1gsS0FBQyxDQUFBLE9BQUQsR0FBVzs7Ozs7O0VBd0NmLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0FBckRqQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwMDAwMDBcbjAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgXG4wMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMCAgICAwMDAwMDAwIFxuMDAwICAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAwMDBcbjAwMCAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgXG4jIyNcblxueyBzdG9yZSwgd2F0Y2gsIGVycm9yLCBsb2cgfSA9IHJlcXVpcmUgJy4va3hrJ1xuXG5jbGFzcyBQcmVmc1xuICAgIFxuICAgIEBzdG9yZSAgID0gbnVsbFxuICAgIEB3YXRjaGVyID0gbnVsbFxuICAgIFxuICAgIEBpbml0OiAoZGVmcz17fSkgLT4gXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3IgJ3ByZWZzLmluaXQgLS0gZHVwbGljYXRlIHN0b3Jlcz8nIGlmIEBzdG9yZT9cbiAgICAgICAgQHN0b3JlID0gbmV3IHN0b3JlICdwcmVmcycsIGRlZmF1bHRzOmRlZnNcbiAgICAgICAgQHN0b3JlLm9uICd3aWxsU2F2ZScsIEB1bndhdGNoXG4gICAgICAgIEBzdG9yZS5vbiAnZGlkU2F2ZScsICBAd2F0Y2hcbiAgICAgICAgQHdhdGNoKCkgXG4gICAgICBcbiAgICBAdW53YXRjaDogPT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpZiBub3QgQHN0b3JlLmFwcD9cbiAgICAgICAgXG4gICAgICAgIEB3YXRjaGVyPy5jbG9zZSgpXG4gICAgICAgIEB3YXRjaGVyID0gbnVsbFxuICAgICAgICBcbiAgICBAd2F0Y2g6ID0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gaWYgbm90IEBzdG9yZS5hcHA/XG4gICAgICAgIFxuICAgICAgICBAdW53YXRjaCgpXG4gICAgICAgIEB3YXRjaGVyID0gd2F0Y2gud2F0Y2ggQHN0b3JlLmZpbGUsXG4gICAgICAgICAgICBpZ25vcmVJbml0aWFsOiAgdHJ1ZVxuICAgICAgICAgICAgdXNlUG9sbGluZzogICAgIGZhbHNlXG4gICAgICAgICAgICB1c2VGc0V2ZW50czogICAgdHJ1ZVxuXG4gICAgICAgIEB3YXRjaGVyXG4gICAgICAgICAgICAub24gJ2NoYW5nZScsIEBvbkZpbGVDaGFuZ2VcbiAgICAgICAgICAgIC5vbiAndW5saW5rJywgQG9uRmlsZVVubGlua1xuICAgICAgICAgICAgLm9uICdlcnJvcicgLCAoZXJyKSAtPiBsb2cgJ1ByZWZzIHdhdGNoIGVycm9yJywgZXJyXG4gICAgICAgIFxuICAgIEBvbkZpbGVDaGFuZ2U6ID0+IEBzdG9yZS5yZWxvYWQoKVxuICAgIEBvbkZpbGVVbmxpbms6ID0+IEB1bndhdGNoKCk7IEBzdG9yZS5jbGVhcigpXG4gICAgICAgICAgICBcbiAgICBAZ2V0OiAgKGtleSwgdmFsdWUpIC0+IGlmIEBzdG9yZSB0aGVuIEBzdG9yZS5nZXQga2V5LCB2YWx1ZSBlbHNlIHZhbHVlXG4gICAgQHNldDogIChrZXksIHZhbHVlKSAtPiBAdW53YXRjaCgpOyBAc3RvcmUuc2V0KGtleSwgdmFsdWUpOyBAd2F0Y2goKVxuICAgIEBkZWw6ICAoa2V5LCB2YWx1ZSkgLT4gQHVud2F0Y2goKTsgQHN0b3JlLmRlbChrZXkpOyBAd2F0Y2goKVxuICAgIEBzYXZlOiAgICAgICAgICAgICAgLT4gQHN0b3JlPy5zYXZlKClcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFByZWZzXG4iXX0=
//# sourceURL=C:/Users/t.kohnhorst/s/kxk/coffee/prefs.coffee