(function() {
  /*
   0000000  000000000   0000000   00000000   00000000  
  000          000     000   000  000   000  000       
  0000000      000     000   000  0000000    0000000   
       000     000     000   000  000   000  000       
  0000000      000      0000000   000   000  00000000  
  */
  var Emitter, Store, _, atomic, error, first, fs, log, noon, post, sds, slash,
    boundMethodCheck = function(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new Error('Bound instance method accessed before binding'); } };

  ({noon, post, atomic, first, sds, slash, fs, log, error, _} = require('./kxk'));

  Emitter = require('events');

  Store = (function() {
    // simple key value store with delayed saving to userData folder
    // does sync changes between processes
    class Store extends Emitter {
      static addStore(store) {
        if (_.isEmpty(this.stores)) {
          post.onGet('store', (name, action) => {
            var ref;
            switch (action) {
              case 'data':
                return (ref = this.stores[name]) != null ? ref.data : void 0;
            }
          });
        }
        return this.stores[store.name] = store;
      }

      constructor(name, opt = {}) {
        var electron, ref;
        super();
        
        //  0000000   0000000   000   000  00000000
        // 000       000   000  000   000  000     
        // 0000000   000000000   000 000   0000000 
        //      000  000   000     000     000     
        // 0000000   000   000      0      00000000
        this.save = this.save.bind(this);
        this.name = name;
        if (opt.separator == null) {
          opt.separator = ':';
        }
        if (opt.timeout == null) {
          opt.timeout = 4000;
        }
        if (!this.name) {
          return error('no name for store?');
        }
        electron = require('electron');
        this.app = electron.app;
        this.sep = opt.separator;
        if (this.app) {
          Store.addStore(this);
          this.timer = null;
          this.file = (ref = opt.file) != null ? ref : slash.join(slash.userData(), `${this.name}.noon`);
          this.timeout = opt.timeout;
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'set':
                this.set.apply(this, args);
                break;
              case 'get':
                this.get.apply(this, args);
                break;
              case 'del':
                this.del.apply(this, args);
                break;
              case 'clear':
                this.clear();
                break;
              case 'save':
                this.save();
            }
            return this;
          });
        } else {
          this.file = slash.join(slash.userData(), `${this.name}.noon`);
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'data':
                return this.data = args[0];
              case 'set':
                return sds.set(this.data, this.keypath(args[0]), args[1]);
              case 'get':
                return sds.get(this.data, this.keypath(args[0]), args[1]);
              case 'del':
                return sds.set(this.data, this.keypath(args[0]));
            }
          });
        }
        this.data = this.load();
        if (opt.defaults != null) {
          this.data = _.defaults(this.data, opt.defaults);
        }
      }

      keypath(key) {
        return key.split(this.sep);
      }

      
      //  0000000   00000000  000000000
      // 000        000          000   
      // 000  0000  0000000      000   
      // 000   000  000          000   
      //  0000000   00000000     000   
      get(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return value;
        }
        return _.clone(sds.get(this.data, this.keypath(key), value));
      }

      
      //  0000000  00000000  000000000  
      // 000       000          000     
      // 0000000   0000000      000     
      //      000  000          000     
      // 0000000   00000000     000     
      set(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return;
        }
        if (_.isEqual(this.get(key), value)) {
          return;
        }
        sds.set(this.data, this.keypath(key), value);
        if (this.app) {
          clearTimeout(this.timer);
          this.timer = setTimeout(this.save, this.timeout);
          return post.toWins('store', this.name, 'set', key, value);
        } else {
          return post.toMain('store', this.name, 'set', key, value);
        }
      }

      del(key) {
        return this.set(key);
      }

      clear() {
        this.data = {};
        if (this.app) {
          if (this.timer) {
            clearTimeout(this.timer);
          }
          return post.toWins('store', this.name, 'data', {});
        } else {
          return post.toMain('store', this.name, 'clear');
        }
      }

      
      // 000       0000000    0000000   0000000    
      // 000      000   000  000   000  000   000  
      // 000      000   000  000000000  000   000  
      // 000      000   000  000   000  000   000  
      // 0000000   0000000   000   000  0000000    
      reload() {
        if (this.app) {
          this.data = this.load();
          return post.toWins('store', this.name, 'data', this.data);
        }
      }

      load() {
        var err;
        if (this.app) {
          try {
            return noon.load(this.file);
          } catch (error1) {
            err = error1;
            return {};
          }
        } else {
          return post.get('store', this.name, 'data');
        }
      }

      save() {
        var err;
        boundMethodCheck(this, Store);
        if (this.app) {
          if (!this.file) {
            return;
          }
          if (_.isEmpty(this.data)) {
            return;
          }
          this.emit('willSave');
          clearTimeout(this.timer);
          this.timer = null;
          try {
            atomic.sync(this.file, noon.stringify(this.data, {
              indent: 2,
              maxalign: 8
            }) + '\n');
          } catch (error1) {
            err = error1;
            error(`store.save -- can't save to '${this.file}:`, err);
          }
          return this.emit('didSave');
        } else {
          return post.toMain('store', this.name, 'save');
        }
      }

    };

    Store.stores = {};

    return Store;

  }).call(this);

  module.exports = Store;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3N0b3JlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxPQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUE7SUFBQTs7RUFRQSxDQUFBLENBQUUsSUFBRixFQUFRLElBQVIsRUFBYyxNQUFkLEVBQXNCLEtBQXRCLEVBQTZCLEdBQTdCLEVBQWtDLEtBQWxDLEVBQXlDLEVBQXpDLEVBQTZDLEdBQTdDLEVBQWtELEtBQWxELEVBQXlELENBQXpELENBQUEsR0FBK0QsT0FBQSxDQUFRLE9BQVIsQ0FBL0Q7O0VBRUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxRQUFSOztFQUtKOzs7SUFBTixNQUFBLE1BQUEsUUFBb0IsUUFBcEI7TUFHZSxPQUFWLFFBQVUsQ0FBQyxLQUFELENBQUE7UUFFUCxJQUFHLENBQUMsQ0FBQyxPQUFGLENBQVUsSUFBQyxDQUFBLE1BQVgsQ0FBSDtVQUNJLElBQUksQ0FBQyxLQUFMLENBQVcsT0FBWCxFQUFvQixDQUFDLElBQUQsRUFBTyxNQUFQLENBQUEsR0FBQTtBQUNoQixnQkFBQTtBQUFBLG9CQUFPLE1BQVA7QUFBQSxtQkFDUyxNQURUO0FBRVEsOERBQW9CLENBQUU7QUFGOUI7VUFEZ0IsQ0FBcEIsRUFESjs7ZUFNQSxJQUFDLENBQUEsTUFBTyxDQUFBLEtBQUssQ0FBQyxJQUFOLENBQVIsR0FBc0I7TUFSZjs7TUFVWCxXQUFhLENBQUMsSUFBRCxFQUFPLE1BQUksQ0FBQSxDQUFYLENBQUE7QUFFVCxZQUFBLFFBQUEsRUFBQTs7Ozs7Ozs7WUFtSEosQ0FBQSxXQUFBLENBQUE7UUFqSEksSUFBQyxDQUFBLElBQUQsR0FBUTs7VUFDUixHQUFHLENBQUMs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Q0FBQyxPQUFGLENBQVUsSUFBQyxDQUFBLElBQVgsQ0FBVjtBQUFBLG1CQUFBOztVQUVBLElBQUMsQ0FBQSxJQUFELENBQU0sVUFBTjtVQUVBLFlBQUEsQ0FBYSxJQUFDLENBQUEsS0FBZDtVQUNBLElBQUMsQ0FBQSxLQUFELEdBQVM7QUFFVDtZQUNJLE1BQU0sQ0FBQyxJQUFQLENBQVksSUFBQyxDQUFBLElBQWIsRUFBbUIsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFDLENBQUEsSUFBaEIsRUFBc0I7Y0FBQyxNQUFBLEVBQVEsQ0FBVDtjQUFZLFFBQUEsRUFBVTtZQUF0QixDQUF0QixDQUFBLEdBQWdELElBQW5FLEVBREo7V0FBQSxjQUFBO1lBRU07WUFDRixLQUFBLENBQU0sQ0FBQSw2QkFBQSxDQUFBLENBQWdDLElBQUMsQ0FBQSxJQUFqQyxDQUFzQyxDQUF0QyxDQUFOLEVBQWdELEdBQWhELEVBSEo7O2lCQUtBLElBQUMsQ0FBQSxJQUFELENBQU0sU0FBTixFQWRKO1NBQUEsTUFBQTtpQkFnQkksSUFBSSxDQUFDLE1BQUwsQ0FBWSxPQUFaLEVBQXFCLElBQUMsQ0FBQSxJQUF0QixFQUE0QixNQUE1QixFQWhCSjs7TUFERTs7SUFsSVY7O0lBRUksS0FBQyxDQUFBLE1BQUQsR0FBVSxDQUFBOzs7Ozs7RUFtSmQsTUFBTSxDQUFDLE9BQVAsR0FBaUI7QUFwS2pCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4gMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIFxuMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbjAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICAwMDAwMDAwICAgXG4gICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuMDAwMDAwMCAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICBcbiMjI1xuXG57IG5vb24sIHBvc3QsIGF0b21pYywgZmlyc3QsIHNkcywgc2xhc2gsIGZzLCBsb2csIGVycm9yLCBfIH0gPSByZXF1aXJlICcuL2t4aydcblxuRW1pdHRlciA9IHJlcXVpcmUgJ2V2ZW50cydcblxuIyBzaW1wbGUga2V5IHZhbHVlIHN0b3JlIHdpdGggZGVsYXllZCBzYXZpbmcgdG8gdXNlckRhdGEgZm9sZGVyXG4jIGRvZXMgc3luYyBjaGFuZ2VzIGJldHdlZW4gcHJvY2Vzc2VzXG5cbmNsYXNzIFN0b3JlIGV4dGVuZHMgRW1pdHRlclxuXG4gICAgQHN0b3JlcyA9IHt9XG4gICAgQGFkZFN0b3JlOiAoc3RvcmUpIC0+XG5cbiAgICAgICAgaWYgXy5pc0VtcHR5IEBzdG9yZXNcbiAgICAgICAgICAgIHBvc3Qub25HZXQgJ3N0b3JlJywgKG5hbWUsIGFjdGlvbikgPT5cbiAgICAgICAgICAgICAgICBzd2l0Y2ggYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2RhdGEnXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQHN0b3Jlc1tuYW1lXT8uZGF0YVxuICAgIFxuICAgICAgICBAc3RvcmVzW3N0b3JlLm5hbWVdID0gc3RvcmVcblxuICAgIGNvbnN0cnVjdG9yOiAobmFtZSwgb3B0PXt9KSAtPlxuXG4gICAgICAgIHN1cGVyKClcbiAgICAgICAgXG4gICAgICAgIEBuYW1lID0gbmFtZVxuICAgICAgICBvcHQuc2VwYXJhdG9yID89ICc6J1xuICAgICAgICBvcHQudGltZW91dCAgID89IDQwMDBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBlcnJvciAnbm8gbmFtZSBmb3Igc3RvcmU/JyBpZiBub3QgQG5hbWVcblxuICAgICAgICBlbGVjdHJvbiA9IHJlcXVpcmUgJ2VsZWN0cm9uJ1xuICAgICAgICBAYXBwID0gZWxlY3Ryb24uYXBwXG4gICAgICAgIEBzZXAgPSBvcHQuc2VwYXJhdG9yXG4gICAgICAgIFxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFN0b3JlLmFkZFN0b3JlIEBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQHRpbWVyICAgPSBudWxsXG4gICAgICAgICAgICBAZmlsZSAgICA9IG9wdC5maWxlID8gc2xhc2guam9pbiBzbGFzaC51c2VyRGF0YSgpLCBcIiN7QG5hbWV9Lm5vb25cIlxuICAgICAgICAgICAgQHRpbWVvdXQgPSBvcHQudGltZW91dFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgcG9zdC5vbiAnc3RvcmUnLCAobmFtZSwgYWN0aW9uLCBhcmdzLi4uKSA9PlxuICAgICAgICAgICAgICAgIHJldHVybiBpZiBAbmFtZSAhPSBuYW1lXG4gICAgICAgICAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgICAgICAgICB3aGVuICdzZXQnICAgdGhlbiBAc2V0LmFwcGx5IEAsIGFyZ3NcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnZ2V0JyAgIHRoZW4gQGdldC5hcHBseSBALCBhcmdzXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2RlbCcgICB0aGVuIEBkZWwuYXBwbHkgQCwgYXJnc1xuICAgICAgICAgICAgICAgICAgICB3aGVuICdjbGVhcicgdGhlbiBAY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdzYXZlJyAgdGhlbiBAc2F2ZSgpXG4gICAgICAgICAgICAgICAgQFxuICAgICAgICAgICAgICAgIFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBmaWxlID0gc2xhc2guam9pbiBzbGFzaC51c2VyRGF0YSgpLCBcIiN7QG5hbWV9Lm5vb25cIlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBwb3N0Lm9uICdzdG9yZScsIChuYW1lLCBhY3Rpb24sIGFyZ3MuLi4pID0+XG4gICAgICAgICAgICAgICAgcmV0dXJuIGlmIEBuYW1lICE9IG5hbWVcbiAgICAgICAgICAgICAgICBzd2l0Y2ggYWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2RhdGEnIHRoZW4gQGRhdGEgPSBhcmdzWzBdXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ3NldCcgIHRoZW4gc2RzLnNldCBAZGF0YSwgQGtleXBhdGgoYXJnc1swXSksIGFyZ3NbMV1cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnZ2V0JyAgdGhlbiBzZHMuZ2V0IEBkYXRhLCBAa2V5cGF0aChhcmdzWzBdKSwgYXJnc1sxXVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkZWwnICB0aGVuIHNkcy5zZXQgQGRhdGEsIEBrZXlwYXRoKGFyZ3NbMF0pXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBkYXRhID0gQGxvYWQoKVxuICAgICAgICBAZGF0YSA9IF8uZGVmYXVsdHMgQGRhdGEsIG9wdC5kZWZhdWx0cyBpZiBvcHQuZGVmYXVsdHM/XG5cbiAgICBrZXlwYXRoOiAoa2V5KSAtPiBrZXkuc3BsaXQgQHNlcFxuICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwMDAwMCAgICAgIDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAgICAwMDAgICBcbiAgICAgICAgXG4gICAgZ2V0OiAoa2V5LCB2YWx1ZSkgLT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB2YWx1ZSBpZiBub3Qga2V5Py5zcGxpdD9cbiAgICAgICAgXy5jbG9uZSBzZHMuZ2V0IEBkYXRhLCBAa2V5cGF0aChrZXkpLCB2YWx1ZVxuICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgc2V0OiAoa2V5LCB2YWx1ZSkgLT5cblxuICAgICAgICByZXR1cm4gaWYgbm90IGtleT8uc3BsaXQ/XG4gICAgICAgIHJldHVybiBpZiBfLmlzRXF1YWwgQGdldChrZXkpLCB2YWx1ZVxuXG4gICAgICAgIHNkcy5zZXQgQGRhdGEsIEBrZXlwYXRoKGtleSksIHZhbHVlXG4gICAgICAgIGlmIEBhcHBcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCBAdGltZXJcbiAgICAgICAgICAgIEB0aW1lciA9IHNldFRpbWVvdXQgQHNhdmUsIEB0aW1lb3V0XG4gICAgICAgICAgICBwb3N0LnRvV2lucyAnc3RvcmUnLCBAbmFtZSwgJ3NldCcsIGtleSwgdmFsdWVcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC50b01haW4gJ3N0b3JlJywgQG5hbWUsICdzZXQnLCBrZXksIHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIFxuICAgIGRlbDogKGtleSkgLT4gQHNldCBrZXlcbiAgICBcbiAgICBjbGVhcjogLT5cbiAgICAgICAgXG4gICAgICAgIEBkYXRhID0ge31cbiAgICAgICAgXG4gICAgICAgIGlmIEBhcHBcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCBAdGltZXIgaWYgQHRpbWVyXG4gICAgICAgICAgICBwb3N0LnRvV2lucyAnc3RvcmUnLCBAbmFtZSwgJ2RhdGEnLCB7fVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwb3N0LnRvTWFpbiAnc3RvcmUnLCBAbmFtZSwgJ2NsZWFyJ1xuICAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcmVsb2FkOiAtPlxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBAZGF0YSA9IEBsb2FkKClcbiAgICAgICAgICAgIHBvc3QudG9XaW5zICdzdG9yZScsIEBuYW1lLCAnZGF0YScsIEBkYXRhXG4gICAgXG4gICAgbG9hZDogLT5cbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgdHJ5XG4gICAgICAgICAgICAgICAgbm9vbi5sb2FkIEBmaWxlXG4gICAgICAgICAgICBjYXRjaCBlcnJcbiAgICAgICAgICAgICAgICB7fVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBwb3N0LmdldCAnc3RvcmUnLCBAbmFtZSwgJ2RhdGEnXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwMCAgIDAwMCAwMDAgICAwMDAwMDAwIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgIDAgICAgICAwMDAwMDAwMFxuXG4gICAgc2F2ZTogPT5cbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgcmV0dXJuIGlmIG5vdCBAZmlsZVxuICAgICAgICAgICAgcmV0dXJuIGlmIF8uaXNFbXB0eSBAZGF0YVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBAZW1pdCAnd2lsbFNhdmUnXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCBAdGltZXJcbiAgICAgICAgICAgIEB0aW1lciA9IG51bGxcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdHJ5XG4gICAgICAgICAgICAgICAgYXRvbWljLnN5bmMgQGZpbGUsIG5vb24uc3RyaW5naWZ5KEBkYXRhLCB7aW5kZW50OiAyLCBtYXhhbGlnbjogOH0pKydcXG4nXG4gICAgICAgICAgICBjYXRjaCBlcnJcbiAgICAgICAgICAgICAgICBlcnJvciBcInN0b3JlLnNhdmUgLS0gY2FuJ3Qgc2F2ZSB0byAnI3tAZmlsZX06XCIsIGVyclxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgQGVtaXQgJ2RpZFNhdmUnXG4gICAgICAgIGVsc2UgXG4gICAgICAgICAgICBwb3N0LnRvTWFpbiAnc3RvcmUnLCBAbmFtZSwgJ3NhdmUnIFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gU3RvcmVcbiJdfQ==
//# sourceURL=../coffee/store.coffee