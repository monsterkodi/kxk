(function() {
  /*
   0000000  000000000   0000000   00000000   00000000  
  000          000     000   000  000   000  000       
  0000000      000     000   000  0000000    0000000   
       000     000     000   000  000   000  000       
  0000000      000      0000000   000   000  00000000  
  */
  var Emitter, Store, _, atomic, error, first, fs, log, noon, post, sds, slash,
    boundMethodCheck = function(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new Error('Bound instance method accessed before binding'); } };

  ({noon, post, atomic, first, sds, slash, fs, log, error, _} = require('./kxk'));

  Emitter = require('events');

  Store = (function() {
    // simple key value store with delayed saving to userData folder
    // does sync changes between processes
    class Store extends Emitter {
      static addStore(store) {
        if (_.isEmpty(this.stores)) {
          post.onGet('store', (name, action) => {
            var ref;
            switch (action) {
              case 'data':
                return (ref = this.stores[name]) != null ? ref.data : void 0;
            }
          });
        }
        return this.stores[store.name] = store;
      }

      constructor(name, opt = {}) {
        var app, electron, ref;
        super();
        
        //  0000000   0000000   000   000  00000000
        // 000       000   000  000   000  000     
        // 0000000   000000000   000 000   0000000 
        //      000  000   000     000     000     
        // 0000000   000   000      0      00000000
        this.save = this.save.bind(this);
        this.name = name;
        if (opt.separator == null) {
          opt.separator = ':';
        }
        if (opt.timeout == null) {
          opt.timeout = 4000;
        }
        if (!this.name) {
          return error('no name for store?');
        }
        electron = require('electron');
        this.app = electron.app;
        this.sep = opt.separator;
        if (this.app) {
          Store.addStore(this);
          this.timer = null;
          this.file = (ref = opt.file) != null ? ref : (this.app != null) && slash.join(this.app.getPath('userData'), `${this.name}.noon`);
          this.timeout = opt.timeout;
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'set':
                this.set.apply(this, args);
                break;
              case 'get':
                this.get.apply(this, args);
                break;
              case 'del':
                this.del.apply(this, args);
                break;
              case 'clear':
                this.clear();
                break;
              case 'save':
                this.save();
            }
            return this;
          });
        } else {
          app = electron.remote.app;
          this.file = slash.join(app.getPath('userData'), `${this.name}.noon`);
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'data':
                return this.data = args[0];
              case 'set':
                return sds.set(this.data, this.keypath(args[0]), args[1]);
              case 'get':
                return sds.get(this.data, this.keypath(args[0]), args[1]);
              case 'del':
                return sds.set(this.data, this.keypath(args[0]));
            }
          });
        }
        this.data = this.load();
        if (opt.defaults != null) {
          this.data = _.defaults(this.data, opt.defaults);
        }
      }

      keypath(key) {
        return key.split(this.sep);
      }

      
      //  0000000   00000000  000000000
      // 000        000          000   
      // 000  0000  0000000      000   
      // 000   000  000          000   
      //  0000000   00000000     000   
      get(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return value;
        }
        return _.clone(sds.get(this.data, this.keypath(key), value));
      }

      
      //  0000000  00000000  000000000  
      // 000       000          000     
      // 0000000   0000000      000     
      //      000  000          000     
      // 0000000   00000000     000     
      set(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return;
        }
        if (_.isEqual(this.get(key), value)) {
          return;
        }
        // return if @get(key) == value
        sds.set(this.data, this.keypath(key), value);
        if (this.app) {
          clearTimeout(this.timer);
          this.timer = setTimeout(this.save, this.timeout);
          return post.toWins('store', this.name, 'set', key, value);
        } else {
          return post.toMain('store', this.name, 'set', key, value);
        }
      }

      del(key) {
        return this.set(key);
      }

      clear() {
        this.data = {};
        if (this.app) {
          if (this.timer) {
            clearTimeout(this.timer);
          }
          return post.toWins('store', this.name, 'data', {});
        } else {
          return post.toMain('store', this.name, 'clear');
        }
      }

      
      // 000       0000000    0000000   0000000    
      // 000      000   000  000   000  000   000  
      // 000      000   000  000000000  000   000  
      // 000      000   000  000   000  000   000  
      // 0000000   0000000   000   000  0000000    
      reload() {
        if (this.app) {
          this.data = this.load();
          return post.toWins('store', this.name, 'data', this.data);
        }
      }

      load() {
        var err;
        if (this.app) {
          try {
            return noon.load(this.file);
          } catch (error1) {
            err = error1;
            return {};
          }
        } else {
          return post.get('store', this.name, 'data');
        }
      }

      save() {
        var err;
        boundMethodCheck(this, Store);
        if (this.app) {
          if (!this.file) {
            return;
          }
          if (_.isEmpty(this.data)) {
            return;
          }
          this.emit('willSave');
          clearTimeout(this.timer);
          this.timer = null;
          try {
            atomic.sync(this.file, noon.stringify(this.data, {
              indent: 2,
              maxalign: 8
            }) + '\n');
          } catch (error1) {
            err = error1;
            error(`store.save -- can't save to '${this.file}:`, err);
          }
          return this.emit('didSave');
        } else {
          return post.toMain('store', this.name, 'save');
        }
      }

    };

    Store.stores = {};

    return Store;

  }).call(this);

  module.exports = Store;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3N0b3JlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxPQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUE7SUFBQTs7RUFRQSxDQUFBLENBQUUsSUFBRixFQUFRLElBQVIsRUFBYyxNQUFkLEVBQXNCLEtBQXRCLEVBQTZCLEdBQTdCLEVBQWtDLEtBQWxDLEVBQXlDLEVBQXpDLEVBQTZDLEdBQTdDLEVBQWtELEtBQWxELEVBQXlELENBQXpELENBQUEsR0FBK0QsT0FBQSxDQUFRLE9BQVIsQ0FBL0Q7O0VBRUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxRQUFSOztFQUtKOzs7SUFBTixNQUFBLE1BQUEsUUFBb0IsUUFBcEI7TUFHZSxPQUFWLFFBQVUsQ0FBQyxLQUFELENBQUE7UUFFUCxJQUFHLENBQUMsQ0FBQyxPQUFGLENBQVUsSUFBQyxDQUFBLE1BQVgsQ0FBSDtVQUNJLElBQUksQ0FBQyxLQUFMLENBQVcsT0FBWCxFQUFvQixDQUFDLElBQUQsRUFBTyxNQUFQLENBQUEsR0FBQTtBQUNoQixnQkFBQTtBQUFBLG9CQUFPLE1BQVA7QUFBQSxtQkFDUyxNQURUO0FBRVEsOERBQW9CLENBQUU7QUFGOUI7VUFEZ0IsQ0FBcEIsRUFESjs7ZUFNQSxJQUFDLENBQUEsTUFBTyxDQUFBLEtBQUssQ0FBQyxJQUFOLENBQVIsR0FBc0I7TUFSZjs7TUFVWCxXQUFhLENBQUMsSUFBRCxFQUFPLE1BQUksQ0FBQSxDQUFYLENBQUE7QUFFVCxZQUFBLEdBQUEsRUFBQSxRQUFBLEVBQUE7Ozs7Ozs7O1lBb0hKLENBQUEsV0FBQSxDQUFBO1FBbEhJLElBQUMsQ0FBQSxJQUFELEdBQVE7O1VBQ1Is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QW9JRSxJQUFHLElBQUMsQ0FBQSxHQUFKO1VBQ0ksSUFBVSxDQUFJLElBQUMsQ0FBQSxJQUFmO0FBQUEsbUJBQUE7O1VBQ0EsSUFBVSxDQUFDLENBQUMsT0FBRixDQUFVLElBQUMsQ0FBQSxJQUFYLENBQVY7QUFBQSxtQkFBQTs7VUFFQSxJQUFDLENBQUEsSUFBRCxDQUFNLFVBQU47VUFFQSxZQUFBLENBQWEsSUFBQyxDQUFBLEtBQWQ7VUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTO0FBRVQ7WUFDSSxNQUFNLENBQUMsSUFBUCxDQUFZLElBQUMsQ0FBQSxJQUFiLEVBQW1CLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBQyxDQUFBLElBQWhCLEVBQXNCO2NBQUMsTUFBQSxFQUFRLENBQVQ7Y0FBWSxRQUFBLEVBQVU7WUFBdEIsQ0FBdEIsQ0FBQSxHQUFnRCxJQUFuRSxFQURKO1dBQUEsY0FBQTtZQUVNO1lBQ0YsS0FBQSxDQUFNLENBQUEsNkJBQUEsQ0FBQSxDQUFnQyxJQUFDLENBQUEsSUFBakMsQ0FBc0MsQ0FBdEMsQ0FBTixFQUFnRCxHQUFoRCxFQUhKOztpQkFLQSxJQUFDLENBQUEsSUFBRCxDQUFNLFNBQU4sRUFkSjtTQUFBLE1BQUE7aUJBZ0JJLElBQUksQ0FBQyxNQUFMLENBQVksT0FBWixFQUFxQixJQUFDLENBQUEsSUFBdEIsRUFBNEIsTUFBNUIsRUFoQko7O01BREU7O0lBbklWOztJQUVJLEtBQUMsQ0FBQSxNQUFELEdBQVUsQ0FBQTs7Ozs7O0VBb0pkLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0FBcktqQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuIDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICBcbjAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4wMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIFxuICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbjAwMDAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4jIyNcblxueyBub29uLCBwb3N0LCBhdG9taWMsIGZpcnN0LCBzZHMsIHNsYXNoLCBmcywgbG9nLCBlcnJvciwgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbkVtaXR0ZXIgPSByZXF1aXJlICdldmVudHMnXG5cbiMgc2ltcGxlIGtleSB2YWx1ZSBzdG9yZSB3aXRoIGRlbGF5ZWQgc2F2aW5nIHRvIHVzZXJEYXRhIGZvbGRlclxuIyBkb2VzIHN5bmMgY2hhbmdlcyBiZXR3ZWVuIHByb2Nlc3Nlc1xuXG5jbGFzcyBTdG9yZSBleHRlbmRzIEVtaXR0ZXJcblxuICAgIEBzdG9yZXMgPSB7fVxuICAgIEBhZGRTdG9yZTogKHN0b3JlKSAtPlxuXG4gICAgICAgIGlmIF8uaXNFbXB0eSBAc3RvcmVzXG4gICAgICAgICAgICBwb3N0Lm9uR2V0ICdzdG9yZScsIChuYW1lLCBhY3Rpb24pID0+XG4gICAgICAgICAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkYXRhJ1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEBzdG9yZXNbbmFtZV0/LmRhdGFcbiAgICBcbiAgICAgICAgQHN0b3Jlc1tzdG9yZS5uYW1lXSA9IHN0b3JlXG5cbiAgICBjb25zdHJ1Y3RvcjogKG5hbWUsIG9wdD17fSkgLT5cblxuICAgICAgICBzdXBlcigpXG4gICAgICAgIFxuICAgICAgICBAbmFtZSA9IG5hbWVcbiAgICAgICAgb3B0LnNlcGFyYXRvciA/PSAnOidcbiAgICAgICAgb3B0LnRpbWVvdXQgICA/PSA0MDAwXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3IgJ25vIG5hbWUgZm9yIHN0b3JlPycgaWYgbm90IEBuYW1lXG5cbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgQGFwcCA9IGVsZWN0cm9uLmFwcFxuICAgICAgICBAc2VwID0gb3B0LnNlcGFyYXRvclxuICAgICAgICBcbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBTdG9yZS5hZGRTdG9yZSBAXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEB0aW1lciAgID0gbnVsbFxuICAgICAgICAgICAgQGZpbGUgICAgPSBvcHQuZmlsZSA/IChAYXBwPyBhbmQgc2xhc2guam9pbihAYXBwLmdldFBhdGgoJ3VzZXJEYXRhJyksIFwiI3tAbmFtZX0ubm9vblwiKSlcbiAgICAgICAgICAgIEB0aW1lb3V0ID0gb3B0LnRpbWVvdXRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHBvc3Qub24gJ3N0b3JlJywgKG5hbWUsIGFjdGlvbiwgYXJncy4uLikgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gaWYgQG5hbWUgIT0gbmFtZVxuICAgICAgICAgICAgICAgIHN3aXRjaCBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnc2V0JyAgIHRoZW4gQHNldC5hcHBseSBALCBhcmdzXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2dldCcgICB0aGVuIEBnZXQuYXBwbHkgQCwgYXJnc1xuICAgICAgICAgICAgICAgICAgICB3aGVuICdkZWwnICAgdGhlbiBAZGVsLmFwcGx5IEAsIGFyZ3NcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnY2xlYXInIHRoZW4gQGNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnc2F2ZScgIHRoZW4gQHNhdmUoKVxuICAgICAgICAgICAgICAgIEBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhcHAgPSBlbGVjdHJvbi5yZW1vdGUuYXBwXG4gICAgICAgICAgICBAZmlsZSA9IHNsYXNoLmpvaW4gYXBwLmdldFBhdGgoJ3VzZXJEYXRhJyksIFwiI3tAbmFtZX0ubm9vblwiXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHBvc3Qub24gJ3N0b3JlJywgKG5hbWUsIGFjdGlvbiwgYXJncy4uLikgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gaWYgQG5hbWUgIT0gbmFtZVxuICAgICAgICAgICAgICAgIHN3aXRjaCBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnZGF0YScgdGhlbiBAZGF0YSA9IGFyZ3NbMF1cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnc2V0JyAgdGhlbiBzZHMuc2V0IEBkYXRhLCBAa2V5cGF0aChhcmdzWzBdKSwgYXJnc1sxXVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdnZXQnICB0aGVuIHNkcy5nZXQgQGRhdGEsIEBrZXlwYXRoKGFyZ3NbMF0pLCBhcmdzWzFdXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2RlbCcgIHRoZW4gc2RzLnNldCBAZGF0YSwgQGtleXBhdGgoYXJnc1swXSlcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQGRhdGEgPSBAbG9hZCgpXG4gICAgICAgIEBkYXRhID0gXy5kZWZhdWx0cyBAZGF0YSwgb3B0LmRlZmF1bHRzIGlmIG9wdC5kZWZhdWx0cz9cblxuICAgIGtleXBhdGg6IChrZXkpIC0+IGtleS5zcGxpdCBAc2VwXG4gICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgICAgICAgIDAwMCAgIFxuICAgICMgMDAwICAwMDAwICAwMDAwMDAwICAgICAgMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgIFxuICAgICAgICBcbiAgICBnZXQ6IChrZXksIHZhbHVlKSAtPlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHZhbHVlIGlmIG5vdCBrZXk/LnNwbGl0P1xuICAgICAgICBfLmNsb25lIHNkcy5nZXQgQGRhdGEsIEBrZXlwYXRoKGtleSksIHZhbHVlXG4gICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICBcbiAgICAjICAgICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBzZXQ6IChrZXksIHZhbHVlKSAtPlxuXG4gICAgICAgIHJldHVybiBpZiBub3Qga2V5Py5zcGxpdD9cbiAgICAgICAgcmV0dXJuIGlmIF8uaXNFcXVhbCBAZ2V0KGtleSksIHZhbHVlXG4gICAgICAgICMgcmV0dXJuIGlmIEBnZXQoa2V5KSA9PSB2YWx1ZVxuICAgICAgICBzZHMuc2V0IEBkYXRhLCBAa2V5cGF0aChrZXkpLCB2YWx1ZVxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQgQHRpbWVyXG4gICAgICAgICAgICBAdGltZXIgPSBzZXRUaW1lb3V0IEBzYXZlLCBAdGltZW91dFxuICAgICAgICAgICAgcG9zdC50b1dpbnMgJ3N0b3JlJywgQG5hbWUsICdzZXQnLCBrZXksIHZhbHVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHBvc3QudG9NYWluICdzdG9yZScsIEBuYW1lLCAnc2V0Jywga2V5LCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICBcbiAgICBkZWw6IChrZXkpIC0+IEBzZXQga2V5XG4gICAgXG4gICAgY2xlYXI6IC0+XG4gICAgICAgIFxuICAgICAgICBAZGF0YSA9IHt9XG4gICAgICAgIFxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQgQHRpbWVyIGlmIEB0aW1lclxuICAgICAgICAgICAgcG9zdC50b1dpbnMgJ3N0b3JlJywgQG5hbWUsICdkYXRhJywge31cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC50b01haW4gJ3N0b3JlJywgQG5hbWUsICdjbGVhcidcbiAgICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHJlbG9hZDogLT5cbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgQGRhdGEgPSBAbG9hZCgpXG4gICAgICAgICAgICBwb3N0LnRvV2lucyAnc3RvcmUnLCBAbmFtZSwgJ2RhdGEnLCBAZGF0YVxuICAgIFxuICAgIGxvYWQ6IC0+XG4gICAgICAgIGlmIEBhcHBcbiAgICAgICAgICAgIHRyeVxuICAgICAgICAgICAgICAgIG5vb24ubG9hZCBAZmlsZVxuICAgICAgICAgICAgY2F0Y2ggZXJyXG4gICAgICAgICAgICAgICAge31cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC5nZXQgJ3N0b3JlJywgQG5hbWUsICdkYXRhJ1xuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgICAwMDAgMDAwICAgMDAwMDAwMCBcbiAgICAjICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgICAgICAwICAgICAgMDAwMDAwMDBcblxuICAgIHNhdmU6ID0+XG4gICAgICAgIGlmIEBhcHBcbiAgICAgICAgICAgIHJldHVybiBpZiBub3QgQGZpbGVcbiAgICAgICAgICAgIHJldHVybiBpZiBfLmlzRW1wdHkgQGRhdGFcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQGVtaXQgJ3dpbGxTYXZlJ1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQgQHRpbWVyXG4gICAgICAgICAgICBAdGltZXIgPSBudWxsXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHRyeVxuICAgICAgICAgICAgICAgIGF0b21pYy5zeW5jIEBmaWxlLCBub29uLnN0cmluZ2lmeShAZGF0YSwge2luZGVudDogMiwgbWF4YWxpZ246IDh9KSsnXFxuJ1xuICAgICAgICAgICAgY2F0Y2ggZXJyXG4gICAgICAgICAgICAgICAgZXJyb3IgXCJzdG9yZS5zYXZlIC0tIGNhbid0IHNhdmUgdG8gJyN7QGZpbGV9OlwiLCBlcnJcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIEBlbWl0ICdkaWRTYXZlJ1xuICAgICAgICBlbHNlIFxuICAgICAgICAgICAgcG9zdC50b01haW4gJ3N0b3JlJywgQG5hbWUsICdzYXZlJyBcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFN0b3JlXG4iXX0=
//# sourceURL=../coffee/store.coffee