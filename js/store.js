(function() {
  /*
   0000000  000000000   0000000   00000000   00000000  
  000          000     000   000  000   000  000       
  0000000      000     000   000  0000000    0000000   
       000     000     000   000  000   000  000       
  0000000      000      0000000   000   000  00000000  
  */
  var Emitter, Store, _, atomic, error, first, fs, log, noon, post, sds, slash,
    boundMethodCheck = function(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new Error('Bound instance method accessed before binding'); } };

  ({noon, post, atomic, first, sds, slash, fs, log, error, _} = require('./kxk'));

  Emitter = require('events');

  Store = (function() {
    // simple key value store with delayed saving to userData folder
    // does sync changes between processes
    class Store extends Emitter {
      static addStore(store) {
        if (_.isEmpty(this.stores)) {
          post.onGet('store', (name, action) => {
            var ref;
            switch (action) {
              case 'data':
                return (ref = this.stores[name]) != null ? ref.data : void 0;
            }
          });
        }
        return this.stores[store.name] = store;
      }

      constructor(name, opt = {}) {
        var electron, ref;
        super();
        
        //  0000000   0000000   000   000  00000000
        // 000       000   000  000   000  000     
        // 0000000   000000000   000 000   0000000 
        //      000  000   000     000     000     
        // 0000000   000   000      0      00000000
        this.save = this.save.bind(this);
        this.name = name;
        if (opt.separator == null) {
          opt.separator = ':';
        }
        if (opt.timeout == null) {
          opt.timeout = 4000;
        }
        if (!this.name) {
          return error('no name for store?');
        }
        electron = require('electron');
        this.app = electron.app;
        this.sep = opt.separator;
        if (this.app) {
          Store.addStore(this);
          this.timer = null;
          this.file = (ref = opt.file) != null ? ref : slash.join(slash.userData(), `${this.name}.noon`);
          this.timeout = opt.timeout;
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'set':
                this.set.apply(this, args);
                break;
              case 'get':
                this.get.apply(this, args);
                break;
              case 'del':
                this.del.apply(this, args);
                break;
              case 'clear':
                this.clear();
                break;
              case 'save':
                this.save();
            }
            return this;
          });
        } else {
          this.file = slash.join(slash.userData(), `${this.name}.noon`);
          post.on('store', (name, action, ...args) => {
            if (this.name !== name) {
              return;
            }
            switch (action) {
              case 'data':
                return this.data = args[0];
              case 'set':
                return sds.set(this.data, this.keypath(args[0]), args[1]);
              case 'get':
                return sds.get(this.data, this.keypath(args[0]), args[1]);
              case 'del':
                return sds.set(this.data, this.keypath(args[0]));
            }
          });
        }
        this.data = this.load();
        if (opt.defaults != null) {
          this.data = _.defaults(this.data, opt.defaults);
        }
      }

      keypath(key) {
        return key.split(this.sep);
      }

      
      //  0000000   00000000  000000000
      // 000        000          000   
      // 000  0000  0000000      000   
      // 000   000  000          000   
      //  0000000   00000000     000   
      get(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return value;
        }
        return _.clone(sds.get(this.data, this.keypath(key), value));
      }

      
      //  0000000  00000000  000000000  
      // 000       000          000     
      // 0000000   0000000      000     
      //      000  000          000     
      // 0000000   00000000     000     
      set(key, value) {
        if ((key != null ? key.split : void 0) == null) {
          return;
        }
        if (_.isEqual(this.get(key), value)) {
          return;
        }
        sds.set(this.data, this.keypath(key), value);
        if (this.app) {
          clearTimeout(this.timer);
          this.timer = setTimeout(this.save, this.timeout);
          return post.toWins('store', this.name, 'set', key, value);
        } else {
          return post.toMain('store', this.name, 'set', key, value);
        }
      }

      del(key) {
        return this.set(key);
      }

      clear() {
        this.data = {};
        if (this.app) {
          if (this.timer) {
            clearTimeout(this.timer);
          }
          return post.toWins('store', this.name, 'data', {});
        } else {
          return post.toMain('store', this.name, 'clear');
        }
      }

      
      // 000       0000000    0000000   0000000    
      // 000      000   000  000   000  000   000  
      // 000      000   000  000000000  000   000  
      // 000      000   000  000   000  000   000  
      // 0000000   0000000   000   000  0000000    
      reload() {
        if (this.app) {
          this.data = this.load();
          return post.toWins('store', this.name, 'data', this.data);
        }
      }

      load() {
        var err;
        if (this.app) {
          try {
            return noon.load(this.file);
          } catch (error1) {
            err = error1;
            return {};
          }
        } else {
          return post.get('store', this.name, 'data');
        }
      }

      save() {
        var err;
        boundMethodCheck(this, Store);
        if (this.app) {
          if (!this.file) {
            return;
          }
          if (_.isEmpty(this.data)) {
            return;
          }
          this.emit('willSave');
          clearTimeout(this.timer);
          this.timer = null;
          try {
            atomic.sync(this.file, noon.stringify(this.data, {
              indent: 2,
              maxalign: 8
            }) + '\n');
          } catch (error1) {
            err = error1;
            error(`store.save -- can't save to '${this.file}:`, err);
          }
          return this.emit('didSave');
        } else {
          return post.toMain('store', this.name, 'save');
        }
      }

    };

    Store.stores = {};

    return Store;

  }).call(this);

  module.exports = Store;

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmUuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiLi4vY29mZmVlL3N0b3JlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUFBOzs7Ozs7O0FBQUEsTUFBQSxPQUFBLEVBQUEsS0FBQSxFQUFBLENBQUEsRUFBQSxNQUFBLEVBQUEsS0FBQSxFQUFBLEtBQUEsRUFBQSxFQUFBLEVBQUEsR0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLEtBQUE7SUFBQTs7RUFRQSxDQUFBLENBQUUsSUFBRixFQUFRLElBQVIsRUFBYyxNQUFkLEVBQXNCLEtBQXRCLEVBQTZCLEdBQTdCLEVBQWtDLEtBQWxDLEVBQXlDLEVBQXpDLEVBQTZDLEdBQTdDLEVBQWtELEtBQWxELEVBQXlELENBQXpELENBQUEsR0FBK0QsT0FBQSxDQUFRLE9BQVIsQ0FBL0Q7O0VBRUEsT0FBQSxHQUFVLE9BQUEsQ0FBUSxRQUFSOztFQUtKOzs7SUFBTixNQUFBLE1BQUEsUUFBb0IsUUFBcEI7TUFHZSxPQUFWLFFBQVUsQ0FBQyxLQUFELENBQUE7UUFFUCxJQUFHLENBQUMsQ0FBQyxPQUFGLENBQVUsSUFBQyxDQUFBLE1BQVgsQ0FBSDtVQUNJLElBQUksQ0FBQyxLQUFMLENBQVcsT0FBWCxFQUFvQixDQUFDLElBQUQsRUFBTyxNQUFQLENBQUEsR0FBQTtBQUNoQixnQkFBQTtBQUFBLG9CQUFPLE1BQVA7QUFBQSxtQkFDUyxNQURUO0FBRVEsOERBQW9CLENBQUU7QUFGOUI7VUFEZ0IsQ0FBcEIsRUFESjs7ZUFNQSxJQUFDLENBQUEsTUFBTyxDQUFBLEtBQUssQ0FBQyxJQUFOLENBQVIsR0FBc0I7TUFSZjs7TUFVWCxXQUFhLENBQUMsSUFBRCxFQUFPLE1BQUksQ0FBQSxDQUFYLENBQUE7QUFFVCxZQUFBLFFBQUEsRUFBQTs7Ozs7Ozs7WUFvSEosQ0FBQSxXQUFBLENBQUE7UUFsSEksSUFBQyxDQUFBLElBQUQsR0FBUTs7VUFDUixHQUFHLENBQUMsWUFBYTs7O1VBQ2pCLEdBQUcsQ0FBQyxVQUFhOztRQUVqQixJQUFxQyxDQUFJLElBQUMsQ0FBQSxJQUExQztBQUFBLGlCQUFPLEtBQUEsQ0FBTSxvQkFBTixFQUFQOztRQUVBLFFBQUEsR0FBVyxPQUFBLENBQVEsVUFBUjtRQUNYLElBQUMsQ0FBQSxHQUFELEdBQU8sUUFBUSxDQUFDO1FBQ2hCLElBQUMsQ0FBQSxHQUFELEdBQU8sR0FBRyxDQUFDO1FBRVgsSUFBRyxJQUFDLENBQUEsR0FBSjtVQUVJLEtBQUssQ0FBQyxRQUFOLENBQWUsSUFBZjtVQUVBLElBQUMsQ0FBQSxLQUFELEdBQVc7VUFDWCxJQUFDLENBQUEsSUFBRCxvQ0FBc0IsS0FBSyxDQUFDLElBQU4sQ0FBVyxLQUFLLENBQUMsUUFBTixDQUFBLENBQVgsRUFBNkIsQ0FBQSxDQUFBLENBQUcsSUFBQyxDQUFBLElBQUosQ0FBUyxLQUFULENBQTdCO1VBQ3RCLElBQUMsQ0FBQSxPQUFELEdBQVcsR0FBRyxDQUFDO1VBRWYsSUFBSSxDQUFDLEVBQUwsQ0FBUSxPQUFSLEVBQWlCLENBQUMsSUFBRCxFQUFPLE1BQVAsRUFBQSxHQUFlLElBQWYsQ0FBQSxHQUFBO1lBQ2IsSUFBVSxJQUFDLENBQUEsSUFBRCxLQUFTLElBQW5CO0FBQUEscUJBQUE7O0FBQ0Esb0JBQU8sTUFBUDtBQUFBLG1CQUNTLEtBRFQ7Z0JBQ3NCLElBQUMsQ0FBQSxHQUFHLENBQUMsS0FBTCxDQUFXLElBQVgsRUFBYyxJQUFkO0FBQWI7QUFEVCxtQkFFUyxLQUZUO2dCQUVzQixJQUFDLENBQUEsR0FBRyxDQUFDLEtBQUwsQ0FBVyxJQUFYLEVBQWMsSUFBZDtBQUFiO0FBRlQsbUJBR1MsS0FIVDtnQkFHc0IsSUFBQyxDQUFBLEdBQUcsQ0FBQyxLQUFMLENBQVcsSUFBWCxFQUFjLElBQWQ7QUFBYjtBQUhULG1CQUlTLE9BSlQ7Z0JBSXNCLElBQUMsQ0FBQSxLQUFELENBQUE7QUFBYjtBQUpULG1CQUtTLE1BTFQ7Z0JBS3NCLElBQUMsQ0FBQSxJQUFELENBQUE7QUFMdEI7bUJBTUE7VUFSYSxDQUFqQixFQVJKO1NBQUEsTUFBQTtVQW9CSSxJQUFDLENBQUEsSUFBRCxHQUFRLEtBQUssQ0FBQyxJQUFOLENBQVcsS0FBSyxDQUFDLFFBQU4sQ0FBQSxDQUFYLEVBQTZCLENBQUEsQ0FBQSxDQUFHLElBQUMsQ0FBQSxJQUFKLENBQVMsS0FBVCxDQUE3QjtVQUVSLElBQUksQ0FBQyxFQUFMLENBQVEsT0FBUixFQUFpQixDQUFDLElBQUQsRUFBTyxNQUFQLEVBQUEsR0FBZSxJQUFmLENBQUEsR0FBQTtZQUNiLElBQVUsSUFBQyxDQUFBLElBQUQsS0FBUyxJQUFuQjtBQUFBLHFCQUFBOztBQUNBLG9CQUFPLE1BQVA7QUFBQSxtQkFDUyxNQURUO3VCQUNxQixJQUFDLENBQUEsSUFBRCxHQUFRLElBQUssQ0FBQSxDQUFBO0FBRGxDLG1CQUVTLEtBRlQ7dUJBRXFCLEdBQUcsQ0FBQyxHQUFKLENBQVEsSUFBQyxDQUFBLElBQVQsRUFBZSxJQUFDLENBQUEsT0FBRCxDQUFTLElBQUssQ0FBQSxDQUFBLENBQWQsQ0FBZixFQUFrQyxJQUFLLENBQUEsQ0FBQSxDQUF2QztBQUZyQixtQkFHUyxLQUhUO3VCQUdxQixHQUFHLENBQUMsR0FBSixDQUFRLElBQUMsQ0FBQSxJQUFULEVBQWUsSUFBQyxDQUFBLE9BQUQsQ0FBUyxJQUFLLENBQUEsQ0FBQSxDQUFkLENBQWYsRUFBa0MsSUFBSyxDQUFBLENBQUEsQ0FBdkM7QUFIckIsbUJBSVMsS0FKVDt1QkFJcUIsR0FBRyxDQUFDLEdBQUosQ0FBUSxJQUFDLENBQUEsSUFBVCxFQUFlLElBQUMsQ0FBQSxPQUFELENBQVMsSUFBSyxDQUFBLENBQUEsQ0FBZCxDQUFmO0FBSnJCO1VBRmEsQ0FBakIsRUF0Qko7O1FBOEJBLElBQUMsQ0FBQSxJQUFELEdBQVEsSUFBQyxDQUFBLElBQUQsQ0FBQTtRQUNSLElBQTBDLG9CQUExQztVQUFBLElBQUMsQ0FBQSxJQUFELEdBQVEsQ0FBQyxDQUFDLFFBQUYsQ0FBVyxJQUFDLENBQUEsSUFBWixFQUFrQixHQUFHLENBQUMsUUFBdEIsRUFBUjs7TUE3Q1M7O01BK0NiLE9BQVMsQ0FBQyxHQUFELENBQUE7ZUFBUyxHQUFHLENBQUMsS0FBSixDQUFVLElBQUMsQ0FBQSxHQUFYO01BQVQsQ0ExRFQ7Ozs7Ozs7O01Ba0VBLEdBQUssQ0FBQyxHQUFELEVBQU0sS0FBTixDQUFBO1FBRUQsSUFBb0IsMENBQXBCO0FBQUEsaUJBQU8sTUFBUDs7ZUFDQSxDQUFDLENBQUMsS0FBRixDQUFRLEdBQUcsQ0FBQyxHQUFKLENBQVEsSUFBQyxDQUFBLElBQVQsRUFBZSxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsQ0FBZixFQUE4QixLQUE5QixDQUFSO01BSEMsQ0FsRUw7Ozs7Ozs7O01BNkVBLEdBQUssQ0FBQyxHQUFELEVBQU0sS0FBTixDQUFBO1FBRUQsSUFBYywwQ0FBZDtBQUFBLGlCQUFBOztRQUNBLElBQVUsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxJQUFDLENBQUEsR0FBRCxDQUFLLEdBQUwsQ0FBVixFQUFxQixLQUFyQixDQUFWO0FBQUEsaUJBQUE7O1FBRUEsR0FBRyxDQUFDLEdBQUosQ0FBUSxJQUFDLENBQUEsSUFBVCxFQUFlLElBQUMsQ0FBQSxPQUFELENBQVMsR0FBVCxDQUFmLEVBQThCLEtBQTlCO1FBQ0EsSUFBRyxJQUFDLENBQUEsR0FBSjtVQUNJLFlBQUEsQ0FBYSxJQUFDLENBQUEsS0FBZDtVQUNBLElBQUMsQ0FBQSxLQUFELEdBQVMsVUFBQSxDQUFXLElBQUMsQ0FBQSxJQUFaLEVBQWtCLElBQUMsQ0FBQSxPQUFuQjtpQkFDVCxJQUFJLENBQUMsTUFBTCxDQUFZLE9BQVosRUFBcUIsSUFBQyxDQUFBLElBQXRCLEVBQTRCLEtBQTVCLEVBQW1DLEdBQW5DLEVBQXdDLEtBQXhDLEVBSEo7U0FBQSxNQUFBO2lCQUtJLElBQUksQ0FBQyxNQUFMLENBQVksT0FBWixFQUFxQixJQUFDLENBQUEsSUFBdEIsRUFBNEIsS0FBNUIsRUFBbUMsR0FBbkMsRUFBd0MsS0FBeEMsRUFMSjs7TUFOQzs7TUFhTCxHQUFLLENBQUMsR0FBRCxDQUFBO2VBQVMsSUFBQyxDQUFBLEdBQUQsQ0FBSyxHQUFMO01BQVQ7O01BRUwsS0FBTyxDQUFBLENBQUE7UUFFSCxJQUFDLENBQUEsSUFBRCxHQUFRLENBQUE7UUFFUixJQUFHLElBQUMsQ0FBQSxHQUFKO1VBQ0ksSUFBdUIsSUFBQyxDQUFBLEtBQXhCO1lBQUEsWUFBQSxDQUFhLElBQUMsQ0FBQSxLQUFkLEVBQUE7O2lCQUNBLElBQUksQ0FBQyxNQUFMLENBQVksT0FBWixFQUFxQixJQUFDLENBQUEsSUFBdEIsRUFBNEIsTUFBNUIsRUFBb0MsQ0FBQSxDQUFwQyxFQUZKO1NBQUEsTUFBQTtpQkFJSSxJQUFJLENBQUMsTUFBTCxDQUFZLE9BQVosRUFBcUIsSUFBQyxDQUFBLElBQXRCLEVBQTRCLE9BQTVCLEVBSko7O01BSkcsQ0E1RlA7Ozs7Ozs7O01BNEdBLE1BQVEsQ0FBQSxDQUFBO1FBQ0osSUFBRyxJQUFDLENBQUEsR0FBSjtVQUNJLElBQUMsQ0FBQSxJQUFELEdBQVEsSUFBQyxDQUFBLElBQUQsQ0FBQTtpQkFDUixJQUFJLENBQUMsTUFBTCxDQUFZLE9BQVosRUFBcUIsSUFBQyxDQUFBLElBQXRCLEVBQTRCLE1BQTVCLEVBQW9DLElBQUMsQ0FBQSxJQUFyQyxFQUZKOztNQURJOztNQUtSLElBQU0sQ0FBQSxDQUFBO0FBRUYsWUFBQTtRQUFBLElBQUcsSUFBQyxDQUFBLEdBQUo7QUFDSTttQkFDSSxJQUFJLENBQUMsSUFBTCxDQUFVLElBQUMsQ0FBQSxJQUFYLEVBREo7V0FBQSxjQUFBO1lBRU07bUJBQ0YsQ0FBQSxFQUhKO1dBREo7U0FBQSxNQUFBO2lCQU1JLElBQUksQ0FBQyxHQUFMLENBQVMsT0FBVCxFQUFrQixJQUFDLENBQUEsSUFBbkIsRUFBeUIsTUFBekIsRUFOSjs7TUFGRTs7TUFnQk4sSUFBTSxDQUFBLENBQUE7QUFFRixZQUFBOytCQXJJRjtRQXFJRSxJQUFHLElBQUMsQ0FBQSxHQUFKO1VBQ0ksSUFBVSxDQUFJLElBQUMsQ0FBQSxJQUFmO0FBQUEsbUJBQUE7O1VBQ0EsSUFBVSxDQUFDLENBQUMsT0FBRixDQUFVLElBQUMsQ0FBQSxJQUFYLENBQVY7QUFBQSxtQkFBQTs7VUFFQSxJQUFDLENBQUEsSUFBRCxDQUFNLFVBQU47VUFFQSxZQUFBLENBQWEsSUFBQyxDQUFBLEtBQWQ7VUFDQSxJQUFDLENBQUEsS0FBRCxHQUFTO0FBRVQ7WUFDSSxNQUFNLENBQUMsSUFBUCxDQUFZLElBQUMsQ0FBQSxJQUFiLEVBQW1CLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBQyxDQUFBLElBQWhCLEVBQXNCO2NBQUMsTUFBQSxFQUFRLENBQVQ7Y0FBWSxRQUFBLEVBQVU7WUFBdEIsQ0FBdEIsQ0FBQSxHQUFnRCxJQUFuRSxFQURKO1dBQUEsY0FBQTtZQUVNO1lBQ0YsS0FBQSxDQUFNLENBQUEsNkJBQUEsQ0FBQSxDQUFnQyxJQUFDLENBQUEsSUFBakMsQ0FBc0MsQ0FBdEMsQ0FBTixFQUFnRCxHQUFoRCxFQUhKOztpQkFLQSxJQUFDLENBQUEsSUFBRCxDQUFNLFNBQU4sRUFkSjtTQUFBLE1BQUE7aUJBZ0JJLElBQUksQ0FBQyxNQUFMLENBQVksT0FBWixFQUFxQixJQUFDLENBQUEsSUFBdEIsRUFBNEIsTUFBNUIsRUFoQko7O01BRkU7O0lBbklWOztJQUVJLEtBQUMsQ0FBQSxNQUFELEdBQVUsQ0FBQTs7Ozs7O0VBcUpkLE1BQU0sQ0FBQyxPQUFQLEdBQWlCO0FBdEtqQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuIDAwMDAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAwICBcbjAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4wMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIFxuICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbjAwMDAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4jIyNcblxueyBub29uLCBwb3N0LCBhdG9taWMsIGZpcnN0LCBzZHMsIHNsYXNoLCBmcywgbG9nLCBlcnJvciwgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbkVtaXR0ZXIgPSByZXF1aXJlICdldmVudHMnXG5cbiMgc2ltcGxlIGtleSB2YWx1ZSBzdG9yZSB3aXRoIGRlbGF5ZWQgc2F2aW5nIHRvIHVzZXJEYXRhIGZvbGRlclxuIyBkb2VzIHN5bmMgY2hhbmdlcyBiZXR3ZWVuIHByb2Nlc3Nlc1xuXG5jbGFzcyBTdG9yZSBleHRlbmRzIEVtaXR0ZXJcblxuICAgIEBzdG9yZXMgPSB7fVxuICAgIEBhZGRTdG9yZTogKHN0b3JlKSAtPlxuXG4gICAgICAgIGlmIF8uaXNFbXB0eSBAc3RvcmVzXG4gICAgICAgICAgICBwb3N0Lm9uR2V0ICdzdG9yZScsIChuYW1lLCBhY3Rpb24pID0+XG4gICAgICAgICAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkYXRhJ1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEBzdG9yZXNbbmFtZV0/LmRhdGFcbiAgICBcbiAgICAgICAgQHN0b3Jlc1tzdG9yZS5uYW1lXSA9IHN0b3JlXG5cbiAgICBjb25zdHJ1Y3RvcjogKG5hbWUsIG9wdD17fSkgLT5cblxuICAgICAgICBzdXBlcigpXG4gICAgICAgIFxuICAgICAgICBAbmFtZSA9IG5hbWVcbiAgICAgICAgb3B0LnNlcGFyYXRvciA/PSAnOidcbiAgICAgICAgb3B0LnRpbWVvdXQgICA/PSA0MDAwXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZXJyb3IgJ25vIG5hbWUgZm9yIHN0b3JlPycgaWYgbm90IEBuYW1lXG5cbiAgICAgICAgZWxlY3Ryb24gPSByZXF1aXJlICdlbGVjdHJvbidcbiAgICAgICAgQGFwcCA9IGVsZWN0cm9uLmFwcFxuICAgICAgICBAc2VwID0gb3B0LnNlcGFyYXRvclxuICAgICAgICBcbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBTdG9yZS5hZGRTdG9yZSBAXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEB0aW1lciAgID0gbnVsbFxuICAgICAgICAgICAgQGZpbGUgICAgPSBvcHQuZmlsZSA/IHNsYXNoLmpvaW4gc2xhc2gudXNlckRhdGEoKSwgXCIje0BuYW1lfS5ub29uXCJcbiAgICAgICAgICAgIEB0aW1lb3V0ID0gb3B0LnRpbWVvdXRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIHBvc3Qub24gJ3N0b3JlJywgKG5hbWUsIGFjdGlvbiwgYXJncy4uLikgPT5cbiAgICAgICAgICAgICAgICByZXR1cm4gaWYgQG5hbWUgIT0gbmFtZVxuICAgICAgICAgICAgICAgIHN3aXRjaCBhY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnc2V0JyAgIHRoZW4gQHNldC5hcHBseSBALCBhcmdzXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2dldCcgICB0aGVuIEBnZXQuYXBwbHkgQCwgYXJnc1xuICAgICAgICAgICAgICAgICAgICB3aGVuICdkZWwnICAgdGhlbiBAZGVsLmFwcGx5IEAsIGFyZ3NcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnY2xlYXInIHRoZW4gQGNsZWFyKClcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnc2F2ZScgIHRoZW4gQHNhdmUoKVxuICAgICAgICAgICAgICAgIEBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBAZmlsZSA9IHNsYXNoLmpvaW4gc2xhc2gudXNlckRhdGEoKSwgXCIje0BuYW1lfS5ub29uXCJcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcG9zdC5vbiAnc3RvcmUnLCAobmFtZSwgYWN0aW9uLCBhcmdzLi4uKSA9PlxuICAgICAgICAgICAgICAgIHJldHVybiBpZiBAbmFtZSAhPSBuYW1lXG4gICAgICAgICAgICAgICAgc3dpdGNoIGFjdGlvblxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkYXRhJyB0aGVuIEBkYXRhID0gYXJnc1swXVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdzZXQnICB0aGVuIHNkcy5zZXQgQGRhdGEsIEBrZXlwYXRoKGFyZ3NbMF0pLCBhcmdzWzFdXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2dldCcgIHRoZW4gc2RzLmdldCBAZGF0YSwgQGtleXBhdGgoYXJnc1swXSksIGFyZ3NbMV1cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnZGVsJyAgdGhlbiBzZHMuc2V0IEBkYXRhLCBAa2V5cGF0aChhcmdzWzBdKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZGF0YSA9IEBsb2FkKClcbiAgICAgICAgQGRhdGEgPSBfLmRlZmF1bHRzIEBkYXRhLCBvcHQuZGVmYXVsdHMgaWYgb3B0LmRlZmF1bHRzP1xuXG4gICAga2V5cGF0aDogKGtleSkgLT4ga2V5LnNwbGl0IEBzZXBcbiAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwMFxuICAgICMgMDAwICAgICAgICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAwMDAgIDAwMDAgIDAwMDAwMDAgICAgICAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgICAgIDAwMCAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwMCAgICAgMDAwICAgXG4gICAgICAgIFxuICAgIGdldDogKGtleSwgdmFsdWUpIC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdmFsdWUgaWYgbm90IGtleT8uc3BsaXQ/XG4gICAgICAgIF8uY2xvbmUgc2RzLmdldCBAZGF0YSwgQGtleXBhdGgoa2V5KSwgdmFsdWVcbiAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIHNldDogKGtleSwgdmFsdWUpIC0+XG5cbiAgICAgICAgcmV0dXJuIGlmIG5vdCBrZXk/LnNwbGl0P1xuICAgICAgICByZXR1cm4gaWYgXy5pc0VxdWFsIEBnZXQoa2V5KSwgdmFsdWVcblxuICAgICAgICBzZHMuc2V0IEBkYXRhLCBAa2V5cGF0aChrZXkpLCB2YWx1ZVxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQgQHRpbWVyXG4gICAgICAgICAgICBAdGltZXIgPSBzZXRUaW1lb3V0IEBzYXZlLCBAdGltZW91dFxuICAgICAgICAgICAgcG9zdC50b1dpbnMgJ3N0b3JlJywgQG5hbWUsICdzZXQnLCBrZXksIHZhbHVlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHBvc3QudG9NYWluICdzdG9yZScsIEBuYW1lLCAnc2V0Jywga2V5LCB2YWx1ZVxuICAgICAgICAgICAgICAgICAgICBcbiAgICBkZWw6IChrZXkpIC0+IEBzZXQga2V5XG4gICAgXG4gICAgY2xlYXI6IC0+XG4gICAgICAgIFxuICAgICAgICBAZGF0YSA9IHt9XG4gICAgICAgIFxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQgQHRpbWVyIGlmIEB0aW1lclxuICAgICAgICAgICAgcG9zdC50b1dpbnMgJ3N0b3JlJywgQG5hbWUsICdkYXRhJywge31cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcG9zdC50b01haW4gJ3N0b3JlJywgQG5hbWUsICdjbGVhcidcbiAgICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHJlbG9hZDogLT5cbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgQGRhdGEgPSBAbG9hZCgpXG4gICAgICAgICAgICBwb3N0LnRvV2lucyAnc3RvcmUnLCBAbmFtZSwgJ2RhdGEnLCBAZGF0YVxuICAgIFxuICAgIGxvYWQ6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAYXBwXG4gICAgICAgICAgICB0cnlcbiAgICAgICAgICAgICAgICBub29uLmxvYWQgQGZpbGVcbiAgICAgICAgICAgIGNhdGNoIGVyclxuICAgICAgICAgICAgICAgIHt9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHBvc3QuZ2V0ICdzdG9yZScsIEBuYW1lLCAnZGF0YSdcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAgMDAwIDAwMCAgIDAwMDAwMDAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAgICAgMCAgICAgIDAwMDAwMDAwXG5cbiAgICBzYXZlOiA9PlxuICAgICAgICBcbiAgICAgICAgaWYgQGFwcFxuICAgICAgICAgICAgcmV0dXJuIGlmIG5vdCBAZmlsZVxuICAgICAgICAgICAgcmV0dXJuIGlmIF8uaXNFbXB0eSBAZGF0YVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBAZW1pdCAnd2lsbFNhdmUnXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCBAdGltZXJcbiAgICAgICAgICAgIEB0aW1lciA9IG51bGxcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdHJ5XG4gICAgICAgICAgICAgICAgYXRvbWljLnN5bmMgQGZpbGUsIG5vb24uc3RyaW5naWZ5KEBkYXRhLCB7aW5kZW50OiAyLCBtYXhhbGlnbjogOH0pKydcXG4nXG4gICAgICAgICAgICBjYXRjaCBlcnJcbiAgICAgICAgICAgICAgICBlcnJvciBcInN0b3JlLnNhdmUgLS0gY2FuJ3Qgc2F2ZSB0byAnI3tAZmlsZX06XCIsIGVyclxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgQGVtaXQgJ2RpZFNhdmUnXG4gICAgICAgIGVsc2UgXG4gICAgICAgICAgICBwb3N0LnRvTWFpbiAnc3RvcmUnLCBAbmFtZSwgJ3NhdmUnIFxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gU3RvcmVcbiJdfQ==
//# sourceURL=../coffee/store.coffee