
/*
 0000000  00000000    0000000  00     00   0000000   00000000   
000       000   000  000       000   000  000   000  000   000  
0000000   0000000    000       000000000  000000000  00000000   
     000  000   000  000       000 0 000  000   000  000        
0000000   000   000   0000000  000   000  000   000  000
 */
var _, empty, errorStack, errorTrace, filePos, fs, log, logErr, mapConvert, ref, regex1, regex2, slash, sourceMap, str, toCoffee, toJs, valid;

ref = require('./kxk'), fs = ref.fs, valid = ref.valid, empty = ref.empty, slash = ref.slash, str = ref.str, log = ref.log, _ = ref._;

sourceMap = require('source-map');

mapConvert = require('convert-source-map');

regex1 = /^\s+at\s+(\S+)\s+\((.*):(\d+):(\d+)\)/;

regex2 = /^\s+at\s+(.*):(\d+):(\d+)/;

logErr = function(err, sep) {
  var i, len, line, ref1, results, trace;
  if (sep == null) {
    sep = '💥';
  }
  console.log(err);
  trace = errorTrace(err);
  if (valid(trace.lines)) {
    log.flog({
      str: trace.text,
      source: trace.lines[0].file,
      line: trace.lines[0].line,
      sep: sep
    });
    ref1 = trace.lines;
    results = [];
    for (i = 0, len = ref1.length; i < len; i++) {
      line = ref1[i];
      sep = slash.isAbsolute(line.file) || line.file[0] === '~' ? '🐞' : '🔼';
      if (sep === '🐞' || line.file[0] === '.') {
        results.push(log.flog({
          str: '       ' + line.func,
          source: line.file,
          line: line.line,
          sep: sep
        }));
      } else {
        results.push(void 0);
      }
    }
    return results;
  } else {
    return log.flog({
      str: trace.text,
      source: '',
      line: 0,
      sep: sep
    });
  }
};

filePos = function(line) {
  var a, absFile, b, coffeeCol, coffeeFile, coffeeLine, jsFile, mappedLine, match, ref1, ref2, result;
  if (match = regex1.exec(line)) {
    result = {
      func: match[1].replace('.<anonymous>', ''),
      file: match[2],
      line: match[3],
      col: match[4]
    };
    if (slash.ext(result.file) === 'js') {
      mappedLine = toCoffee(result.file, result.line, result.col);
      if (mappedLine != null) {
        result.file = mappedLine[0];
        result.line = mappedLine[1];
        result.col = mappedLine[2];
      }
    } else if (slash.ext(result.file) === 'coffee' && !slash.isAbsolute(result.file)) {
      absFile = slash.resolve(slash.join(process.cwd(), 'coffee', result.file));
      if (slash.fileExists(absFile)) {
        ref1 = toJs(absFile, 1, 0), jsFile = ref1[0], a = ref1[1], b = ref1[2];
        if (slash.fileExists(jsFile)) {
          ref2 = toCoffee(jsFile, result.line, result.col), coffeeFile = ref2[0], coffeeLine = ref2[1], coffeeCol = ref2[2];
          if (slash.fileExists(coffeeFile)) {
            result.file = coffeeFile;
            result.line = coffeeLine;
            result.col = coffeeCol;
          }
        }
      }
    }
  } else if (match = regex2.exec(line)) {
    result = {
      func: slash.file(match[1]),
      file: match[1],
      line: match[2],
      col: match[3]
    };
    if (slash.ext(result.file) === 'js') {
      mappedLine = toCoffee(result.file, result.line, result.col);
      if (mappedLine != null) {
        result.file = mappedLine[0];
        result.line = mappedLine[1];
        result.col = mappedLine[2];
      }
    }
  }
  return result;
};

errorStack = function(err) {
  var fp, i, len, lines, ref1, stackLine;
  lines = [];
  ref1 = err.stack.split('\n');
  for (i = 0, len = ref1.length; i < len; i++) {
    stackLine = ref1[i];
    if (fp = filePos(stackLine)) {
      lines.push("       " + (_.padEnd(fp.func, 30)) + " " + fp.file + ":" + fp.line);
    } else {
      lines.push(stackLine);
    }
  }
  return lines.join('\n');
};

errorTrace = function(err) {
  var fp, i, len, lines, ref1, stackLine, text;
  lines = [];
  text = [];
  ref1 = err.stack.split('\n');
  for (i = 0, len = ref1.length; i < len; i++) {
    stackLine = ref1[i];
    if (fp = filePos(stackLine)) {
      lines.push(fp);
    } else {
      text.push(stackLine);
    }
  }
  return {
    lines: lines,
    text: text.join('\n')
  };
};

toCoffee = function(jsFile, jsLine, jsCol) {
  var coffeeCol, coffeeFile, coffeeLine, consumer, mapData, pos, ref1;
  if (jsCol == null) {
    jsCol = 0;
  }
  jsLine = parseInt(jsLine);
  jsCol = parseInt(jsCol);
  coffeeFile = slash.tilde(jsFile);
  coffeeLine = jsLine;
  coffeeCol = jsCol;
  if (slash.fileExists(jsFile)) {
    mapData = (ref1 = mapConvert.fromSource(fs.readFileSync(jsFile, 'utf8'))) != null ? ref1.toObject() : void 0;
    if (valid(mapData)) {
      if (mapData != null ? mapData.sources[0] : void 0) {
        mapData.sources[0] = slash.resolve(slash.join(slash.dir(jsFile), mapData != null ? mapData.sources[0] : void 0));
      }
      consumer = new sourceMap.SourceMapConsumer(mapData);
      if (consumer.originalPositionFor) {
        pos = consumer.originalPositionFor({
          line: jsLine,
          column: jsCol,
          bias: sourceMap.SourceMapConsumer.LEAST_UPPER_BOUND
        });
        if (valid(pos.line) && valid(pos.column)) {
          coffeeFile = slash.tilde(mapData.sources[0]);
          coffeeLine = pos.line;
          coffeeCol = pos.column;
        } else {
          log('no pos.line', pos);
        }
      } else {
        log('no consumer originalPositionFor', mapData != null, consumer != null);
      }
    }
  }
  return [coffeeFile, coffeeLine, coffeeCol];
};

toJs = function(coffeeFile, coffeeLine, coffeeCol) {
  var consumer, jsFile, mapData, poss, ref1, ref2, ref3;
  if (coffeeCol == null) {
    coffeeCol = 0;
  }
  jsFile = coffeeFile.replace(/\/coffee\//, '/js/');
  jsFile = jsFile.replace(/\.coffee$/, '.js');
  if (!slash.fileExists(jsFile)) {
    return [null, null, null];
  }
  if (coffeeLine == null) {
    return jsFile;
  }
  mapData = (ref1 = mapConvert.fromSource(fs.readFileSync(jsFile, 'utf8'))) != null ? ref1.toObject() : void 0;
  if (valid(mapData)) {
    if (mapData != null ? mapData.sources[0] : void 0) {
      mapData.sources[0] = slash.resolve(slash.join(slash.dir(jsFile), mapData != null ? mapData.sources[0] : void 0));
    }
    consumer = new sourceMap.SourceMapConsumer(mapData);
    if ((consumer != null ? consumer.allGeneratedPositionsFor : void 0) != null) {
      poss = consumer.allGeneratedPositionsFor({
        source: mapData.sources[0],
        line: coffeeLine
      });
      if (valid(poss)) {
        return [jsFile, (ref2 = poss[0]) != null ? ref2.line : void 0, (ref3 = poss[0]) != null ? ref3.column : void 0];
      } else {
        console.log('srcmap.toJs -- empty poss!');
      }
    } else {
      console.log('srcmap.toJs -- no allGeneratedPositionsFor in', consumer);
    }
  }
  return [jsFile, null, null];
};

module.exports = {
  toJs: toJs,
  toCoffee: toCoffee,
  errorStack: errorStack,
  errorTrace: errorTrace,
  logErr: logErr
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjbWFwLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7QUFBQSxJQUFBOztBQVFBLE1BQTJDLE9BQUEsQ0FBUSxPQUFSLENBQTNDLEVBQUUsV0FBRixFQUFNLGlCQUFOLEVBQWEsaUJBQWIsRUFBb0IsaUJBQXBCLEVBQTJCLGFBQTNCLEVBQWdDLGFBQWhDLEVBQXFDOztBQUVyQyxTQUFBLEdBQWEsT0FBQSxDQUFRLFlBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxvQkFBUjs7QUFFYixNQUFBLEdBQWE7O0FBQ2IsTUFBQSxHQUFhOztBQVFiLE1BQUEsR0FBUyxTQUFDLEdBQUQsRUFBTSxHQUFOO0FBR0wsTUFBQTs7SUFIVyxNQUFJOztFQUdmLE9BQU8sQ0FBQyxHQUFSLENBQVksR0FBWjtFQUNBLEtBQUEsR0FBUSxVQUFBLENBQVcsR0FBWDtFQUVSLElBQUcsS0FBQSxDQUFNLEtBQUssQ0FBQyxLQUFaLENBQUg7SUFDSSxHQUFHLENBQUMsSUFBSixDQUFTO01BQUEsR0FBQSxFQUFJLEtBQUssQ0FBQyxJQUFWO01BQWdCLE1BQUEsRUFBTyxLQUFLLENBQUMsS0FBTSxDQUFBLENBQUEsQ0FBRSxDQUFDLElBQXRDO01BQTRDLElBQUEsRUFBSyxLQUFLLENBQUMsS0FBTSxDQUFBLENBQUEsQ0FBRSxDQUFDLElBQWhFO01BQXNFLEdBQUEsRUFBSSxHQUExRTtLQUFUO0FBQ0E7QUFBQTtTQUFBLHNDQUFBOztNQUNJLEdBQUEsR0FBUyxLQUFLLENBQUMsVUFBTixDQUFpQixJQUFJLENBQUMsSUFBdEIsQ0FBQSxJQUErQixJQUFJLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBVixLQUFjLEdBQWhELEdBQXlELElBQXpELEdBQW1FO01BQ3pFLElBQUcsR0FBQSxLQUFPLElBQVAsSUFBZSxJQUFJLENBQUMsSUFBSyxDQUFBLENBQUEsQ0FBVixLQUFnQixHQUFsQztxQkFDSSxHQUFHLENBQUMs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QUFPLFFBQVEsQ0FBQyx3QkFBVCxDQUFrQztRQUFBLE1BQUEsRUFBTyxPQUFPLENBQUMsT0FBUSxDQUFBLENBQUEsQ0FBdkI7UUFBMkIsSUFBQSxFQUFLLFVBQWhDO09BQWxDO01BQ1AsSUFBRyxLQUFBLENBQU0sSUFBTixDQUFIO0FBQ0ksZUFBTyxDQUFDLE1BQUQsaUNBQWdCLENBQUUsYUFBbEIsaUNBQStCLENBQUUsZUFBakMsRUFEWDtPQUFBLE1BQUE7UUFHSSxPQUFPLENBQUMsR0FBUixDQUFZLDRCQUFaLEVBSEo7T0FGSjtLQUFBLE1BQUE7TUFPSSxPQUFPLENBQUMsR0FBUixDQUFZLCtDQUFaLEVBQTZELFFBQTdELEVBUEo7S0FISjs7U0FZQSxDQUFDLE1BQUQsRUFBUyxJQUFULEVBQWUsSUFBZjtBQXZCRzs7QUF5QlAsTUFBTSxDQUFDLE9BQVAsR0FDSTtFQUFBLElBQUEsRUFBWSxJQUFaO0VBQ0EsUUFBQSxFQUFZLFFBRFo7RUFFQSxVQUFBLEVBQVksVUFGWjtFQUdBLFVBQUEsRUFBWSxVQUhaO0VBSUEsTUFBQSxFQUFZLE1BSloiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAwMDAwMDAwICAwMDAwMDAwMCAgICAwMDAwMDAwICAwMCAgICAgMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbjAwMDAwMDAgICAwMDAwMDAwICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgICBcbiAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICBcbjAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgICBcbiMjI1xuXG57IGZzLCB2YWxpZCwgZW1wdHksIHNsYXNoLCBzdHIsIGxvZywgXyB9ID0gcmVxdWlyZSAnLi9reGsnXG5cbnNvdXJjZU1hcCAgPSByZXF1aXJlICdzb3VyY2UtbWFwJ1xubWFwQ29udmVydCA9IHJlcXVpcmUgJ2NvbnZlcnQtc291cmNlLW1hcCdcblxucmVnZXgxICAgICA9IC9eXFxzK2F0XFxzKyhcXFMrKVxccytcXCgoLiopOihcXGQrKTooXFxkKylcXCkvXHJcbnJlZ2V4MiAgICAgPSAvXlxccythdFxccysoLiopOihcXGQrKTooXFxkKykvXHJcblxuIyAwMDAgICAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICBcbiMgMDAwICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4jIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAgIFxuIyAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiMgMDAwMDAwMCAgIDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG5cbmxvZ0VyciA9IChlcnIsIHNlcD0n8J+SpScpIC0+XG4gICAgXG4gICAgIyBjb25zb2xlLmxvZyBlcnJvclN0YWNrIGVyclxuICAgIGNvbnNvbGUubG9nIGVyclxuICAgIHRyYWNlID0gZXJyb3JUcmFjZSBlcnJcbiAgICAjIGNvbnNvbGUubG9nICd0cmFjZTonLCBzdHIodHJhY2UpXG4gICAgaWYgdmFsaWQgdHJhY2UubGluZXNcbiAgICAgICAgbG9nLmZsb2cgc3RyOnRyYWNlLnRleHQsIHNvdXJjZTp0cmFjZS5saW5lc1swXS5maWxlLCBsaW5lOnRyYWNlLmxpbmVzWzBdLmxpbmUsIHNlcDpzZXBcbiAgICAgICAgZm9yIGxpbmUgaW4gdHJhY2UubGluZXNcbiAgICAgICAgICAgIHNlcCA9IGlmIHNsYXNoLmlzQWJzb2x1dGUobGluZS5maWxlKSBvciBsaW5lLmZpbGVbMF09PSd+JyB0aGVuICfwn5CeJyBlbHNlICfwn5S8J1xuICAgICAgICAgICAgaWYgc2VwID09ICfwn5CeJyBvciBsaW5lLmZpbGVbMF0gPT0gJy4nXG4gICAgICAgICAgICAgICAgbG9nLmZsb2cgc3RyOicgICAgICAgJytsaW5lLmZ1bmMsIHNvdXJjZTpsaW5lLmZpbGUsIGxpbmU6bGluZS5saW5lLCBzZXA6c2VwXG4gICAgZWxzZVxuICAgICAgICBsb2cuZmxvZyBzdHI6dHJhY2UudGV4dCwgc291cmNlOicnLCBsaW5lOjAsIHNlcDpzZXBcblxuIyAwMDAwMDAwMCAgMDAwICAwMDAgICAgICAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgICAwMDAwMDAwICBcbiMgMDAwICAgICAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4jIDAwMDAwMCAgICAwMDAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuIyAwMDAgICAgICAgMDAwICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAwMDAgICAwMDAgICAgICAgMDAwICBcbiMgMDAwICAgICAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgXG5cbmZpbGVQb3MgPSAobGluZSkgLT5cblxuICAgIGlmIG1hdGNoID0gcmVnZXgxLmV4ZWMgbGluZVxuICAgICAgICBcbiAgICAgICAgcmVzdWx0ID1cbiAgICAgICAgICAgIGZ1bmM6IG1hdGNoWzFdLnJlcGxhY2UgJy48YW5vbnltb3VzPicsICcnXG4gICAgICAgICAgICBmaWxlOiBtYXRjaFsyXVxyXG4gICAgICAgICAgICBsaW5lOiBtYXRjaFszXVxyXG4gICAgICAgICAgICBjb2w6ICBtYXRjaFs0XVxyXG4gICAgICAgIFxuICAgICAgICBpZiBzbGFzaC5leHQocmVzdWx0LmZpbGUpID09ICdqcydcclxuICAgICAgICAgICAgXG4gICAgICAgICAgICBtYXBwZWRMaW5lID0gdG9Db2ZmZWUgcmVzdWx0LmZpbGUsIHJlc3VsdC5saW5lLCByZXN1bHQuY29sXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIG1hcHBlZExpbmU/XG4gICAgICAgICAgICAgICAgcmVzdWx0LmZpbGUgPSBtYXBwZWRMaW5lWzBdXG4gICAgICAgICAgICAgICAgcmVzdWx0LmxpbmUgPSBtYXBwZWRMaW5lWzFdXG4gICAgICAgICAgICAgICAgcmVzdWx0LmNvbCAgPSBtYXBwZWRMaW5lWzJdXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGVsc2UgaWYgc2xhc2guZXh0KHJlc3VsdC5maWxlKSA9PSAnY29mZmVlJyBhbmQgbm90IHNsYXNoLmlzQWJzb2x1dGUgcmVzdWx0LmZpbGVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBzZWVtcyBsaWtlIGNocm9tZSBpcyByZXNvbHZpbmcgdG8gcmVsYXRpdmUgcGF0aHMgYWxyZWFkeSB3aXRob3V0IG1hcHBpbmcgdGhlIGxpbmUgbnVtYmVycyBjb3JyZWN0bHkgOihcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBjb25zb2xlLmxvZyBcImZpbGVQb3MxIGxpbmU6JyN7bGluZX0nIHJlc3VsdDpcIiwgc3RyIHJlc3VsdFxuICAgICAgICAgICAgIyBjb25zb2xlLmxvZyAncHJvY2Vzcy5jd2QnLCBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICAjIHRyeVxuICAgICAgICAgICAgICAgICMgY29uc29sZS5sb2cgJ2FwcC5nZXRQYXRoKFwiZXhlXCIpJywgcmVxdWlyZSgnZWxlY3Ryb24nKS5yZW1vdGUuYXBwLmdldFBhdGggJ2V4ZSdcbiAgICAgICAgICAgICMgY2F0Y2ggZXJyXG4gICAgICAgICAgICAgICAgIyBjb25zb2xlLmxvZyBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGFic0ZpbGUgPSBzbGFzaC5yZXNvbHZlIHNsYXNoLmpvaW4gcHJvY2Vzcy5jd2QoKSwgJ2NvZmZlZScsIHJlc3VsdC5maWxlXG4gICAgICAgICAgICBpZiBzbGFzaC5maWxlRXhpc3RzIGFic0ZpbGVcbiAgICAgICAgICAgICAgICBbanNGaWxlLGEsYl0gPSB0b0pzIGFic0ZpbGUsIDEsIDBcbiAgICAgICAgICAgICAgICBpZiBzbGFzaC5maWxlRXhpc3RzIGpzRmlsZVxuICAgICAgICAgICAgICAgICAgICBbY29mZmVlRmlsZSwgY29mZmVlTGluZSwgY29mZmVlQ29sXSA9IHRvQ29mZmVlIGpzRmlsZSwgcmVzdWx0LmxpbmUsIHJlc3VsdC5jb2xcbiAgICAgICAgICAgICAgICAgICAgaWYgc2xhc2guZmlsZUV4aXN0cyBjb2ZmZWVGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZmlsZSA9IGNvZmZlZUZpbGUgIyB0aGlzICdmaXgnIHJlbGllcyBvbiBwcm9jZXNzLmN3ZCB0byBiZSB1bmNoYW5nZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5saW5lID0gY29mZmVlTGluZSAjIGFuZCBvbmx5IHdvcmtzIGZvciBhcHAgc3RhcnRlZCBmcm9tIHNvdXJjZVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmNvbCAgPSBjb2ZmZWVDb2wgICMgdmlhIG5vZGVfbW9kdWxlcy9lbGVjdHJvbi4uLiA6KFxuICAgICAgICAgICAgICAgICAgICAgICAgIyB1c2luZyBhcHAuZ2V0UGF0aChcImV4ZVwiKSBhbmQgZmlsdGVyIG91dCBub2RlX21vZHVsZXMgd291bGQgcHJvYmFibHkgYmUgYmV0dGVyXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICBlbHNlIGlmIG1hdGNoID0gcmVnZXgyLmV4ZWMgbGluZVxuICAgICAgICBcbiAgICAgICAgcmVzdWx0ID1cbiAgICAgICAgICAgIGZ1bmM6IHNsYXNoLmZpbGUgbWF0Y2hbMV1cbiAgICAgICAgICAgIGZpbGU6IG1hdGNoWzFdXHJcbiAgICAgICAgICAgIGxpbmU6IG1hdGNoWzJdXHJcbiAgICAgICAgICAgIGNvbDogIG1hdGNoWzNdXHJcbiAgICAgICAgXG4gICAgICAgIGlmIHNsYXNoLmV4dChyZXN1bHQuZmlsZSkgPT0gJ2pzJ1xyXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIG1hcHBlZExpbmUgPSB0b0NvZmZlZSByZXN1bHQuZmlsZSwgcmVzdWx0LmxpbmUsIHJlc3VsdC5jb2xcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgbWFwcGVkTGluZT9cbiAgICAgICAgICAgICAgICByZXN1bHQuZmlsZSA9IG1hcHBlZExpbmVbMF1cbiAgICAgICAgICAgICAgICByZXN1bHQubGluZSA9IG1hcHBlZExpbmVbMV1cbiAgICAgICAgICAgICAgICByZXN1bHQuY29sICA9IG1hcHBlZExpbmVbMl1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgIyBlbHNlIGlmIHNsYXNoLmV4dChyZXN1bHQuZmlsZSkgPT0gJ2NvZmZlZScgYW5kIG5vdCBzbGFzaC5pc0Fic29sdXRlIHJlc3VsdC5maWxlICAgICAgICAgICAgICAgIFxuIyAgICAgICAgICAgICBcbiAgICAgICAgICAgICMgY29uc29sZS5sb2cgXCJmaWxlUG9zMiBGSVhNRSFcIiwgbGluZSwgcmVzdWx0XG4gICAgICAgICAgICBcbiAgICByZXN1bHRcblxuIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAgICAwMDAgIFxuIyAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgIDAwMCAgIFxuIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgIFxuIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgIDAwMCAgIFxuIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIFxuXG5lcnJvclN0YWNrID0gKGVycikgLT5cbiAgICBcbiAgICBsaW5lcyA9IFtdXHJcbiAgICBcbiAgICBmb3Igc3RhY2tMaW5lIGluIGVyci5zdGFjay5zcGxpdCAnXFxuJyBcclxuICAgICAgICBcbiAgICAgICAgaWYgZnAgPSBmaWxlUG9zIHN0YWNrTGluZVxuICAgICAgICAgICAgbGluZXMucHVzaCBcIiAgICAgICAje18ucGFkRW5kIGZwLmZ1bmMsIDMwfSAje2ZwLmZpbGV9OiN7ZnAubGluZX1cIiBcclxuICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgIGxpbmVzLnB1c2ggc3RhY2tMaW5lIFxyXG5cciAgXG4gICAgbGluZXMuam9pbiAnXFxuJ1xuXG4jIDAwMDAwMDAwMCAgMDAwMDAwMDAgICAgMDAwMDAwMCAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG4jICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgXG4jICAgIDAwMCAgICAgMDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgXG4jICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgXG4jICAgIDAwMCAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgXG5cbmVycm9yVHJhY2UgPSAoZXJyKSAtPlxuICAgIFxuICAgIGxpbmVzID0gW11cclxuICAgIHRleHQgID0gW11cblxuICAgIGZvciBzdGFja0xpbmUgaW4gZXJyLnN0YWNrLnNwbGl0ICdcXG4nIFxyXG4gICAgICAgIFxuICAgICAgICBpZiBmcCA9IGZpbGVQb3Mgc3RhY2tMaW5lXG4gICAgICAgICAgICBsaW5lcy5wdXNoIGZwXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgdGV4dC5wdXNoIHN0YWNrTGluZSBcclxuXHIgIFxuICAgIGxpbmVzOiAgbGluZXNcbiAgICB0ZXh0OiAgIHRleHQuam9pbiAnXFxuJ1xuICAgIFxuIyAwMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgIFxuIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMDAwICAgIDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMCAgIFxuIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgIFxuIyAgICAwMDAgICAgICAwMDAwMDAwICAgICAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuXG50b0NvZmZlZSA9IChqc0ZpbGUsIGpzTGluZSwganNDb2w9MCkgLT5cblxuICAgIGpzTGluZSA9IHBhcnNlSW50IGpzTGluZVxuICAgIGpzQ29sICA9IHBhcnNlSW50IGpzQ29sXG4gICAgXG4gICAgY29mZmVlRmlsZSA9IHNsYXNoLnRpbGRlIGpzRmlsZVxuICAgIGNvZmZlZUxpbmUgPSBqc0xpbmVcbiAgICBjb2ZmZWVDb2wgID0ganNDb2xcbiAgICAgICAgXG4gICAgaWYgc2xhc2guZmlsZUV4aXN0cyBqc0ZpbGVcbiAgICAgICAgbWFwRGF0YSA9IG1hcENvbnZlcnQuZnJvbVNvdXJjZShmcy5yZWFkRmlsZVN5bmMganNGaWxlLCAndXRmOCcpPy50b09iamVjdCgpXG4gICAgICAgIGlmIHZhbGlkIG1hcERhdGFcbiAgICAgICAgICAgIG1hcERhdGEuc291cmNlc1swXSA9IHNsYXNoLnJlc29sdmUgc2xhc2guam9pbiBzbGFzaC5kaXIoanNGaWxlKSwgbWFwRGF0YT8uc291cmNlc1swXSBpZiBtYXBEYXRhPy5zb3VyY2VzWzBdXG4gICAgICAgICAgICBjb25zdW1lciA9IG5ldyBzb3VyY2VNYXAuU291cmNlTWFwQ29uc3VtZXIgbWFwRGF0YVxuICAgICAgICAgICAgaWYgY29uc3VtZXIub3JpZ2luYWxQb3NpdGlvbkZvclxuICAgICAgICAgICAgICAgIHBvcyA9IGNvbnN1bWVyLm9yaWdpbmFsUG9zaXRpb25Gb3IgbGluZTpqc0xpbmUsIGNvbHVtbjpqc0NvbCwgYmlhczpzb3VyY2VNYXAuU291cmNlTWFwQ29uc3VtZXIuTEVBU1RfVVBQRVJfQk9VTkRcbiAgICAgICAgICAgICAgICBpZiB2YWxpZChwb3MubGluZSkgYW5kIHZhbGlkKHBvcy5jb2x1bW4pXG4gICAgICAgICAgICAgICAgICAgIGNvZmZlZUZpbGUgPSBzbGFzaC50aWxkZSBtYXBEYXRhLnNvdXJjZXNbMF1cbiAgICAgICAgICAgICAgICAgICAgY29mZmVlTGluZSA9IHBvcy5saW5lIFxuICAgICAgICAgICAgICAgICAgICBjb2ZmZWVDb2wgID0gcG9zLmNvbHVtblxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgbG9nICdubyBwb3MubGluZScsIHBvc1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGxvZyAnbm8gY29uc3VtZXIgb3JpZ2luYWxQb3NpdGlvbkZvcicsIG1hcERhdGE/LCBjb25zdW1lcj9cbiAgICAgICAgXG4gICAgW2NvZmZlZUZpbGUsIGNvZmZlZUxpbmUsIGNvZmZlZUNvbF1cblxuIyAwMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAgICAgICAgMDAwICAgMDAwMDAwMCAgXG4jICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAgICAgICAgICAwMDAgIDAwMCAgICAgICBcbiMgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgICAgICAgIDAwMCAgMDAwMDAwMCAgIFxuIyAgICAwMDAgICAgIDAwMCAgIDAwMCAgICAgICAgMDAwICAgMDAwICAgICAgIDAwMCAgXG4jICAgIDAwMCAgICAgIDAwMDAwMDAgICAgICAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICBcblxudG9KcyA9IChjb2ZmZWVGaWxlLCBjb2ZmZWVMaW5lLCBjb2ZmZWVDb2w9MCkgLT5cbiAgICBcbiAgICBqc0ZpbGUgPSBjb2ZmZWVGaWxlLnJlcGxhY2UgL1xcL2NvZmZlZVxcLy8sICcvanMvJ1xuICAgIGpzRmlsZSA9IGpzRmlsZS5yZXBsYWNlIC9cXC5jb2ZmZWUkLywgJy5qcydcbiAgICBcbiAgICBpZiBub3Qgc2xhc2guZmlsZUV4aXN0cyBqc0ZpbGVcbiAgICAgICAgcmV0dXJuIFtudWxsLCBudWxsLCBudWxsXVxuICAgICAgICBcbiAgICBpZiBub3QgY29mZmVlTGluZT8gdGhlbiByZXR1cm4ganNGaWxlXG4gICAgXG4gICAgbWFwRGF0YSA9IG1hcENvbnZlcnQuZnJvbVNvdXJjZShmcy5yZWFkRmlsZVN5bmMganNGaWxlLCAndXRmOCcpPy50b09iamVjdCgpXG4gICAgaWYgdmFsaWQgbWFwRGF0YVxuICAgICAgICBtYXBEYXRhLnNvdXJjZXNbMF0gPSBzbGFzaC5yZXNvbHZlIHNsYXNoLmpvaW4gc2xhc2guZGlyKGpzRmlsZSksIG1hcERhdGE/LnNvdXJjZXNbMF0gaWYgbWFwRGF0YT8uc291cmNlc1swXVxuICAgICAgICBjb25zdW1lciA9IG5ldyBzb3VyY2VNYXAuU291cmNlTWFwQ29uc3VtZXIgbWFwRGF0YVxuICAgICAgICBpZiBjb25zdW1lcj8uYWxsR2VuZXJhdGVkUG9zaXRpb25zRm9yP1xuICAgICAgICAgICAgcG9zcyA9IGNvbnN1bWVyLmFsbEdlbmVyYXRlZFBvc2l0aW9uc0ZvciBzb3VyY2U6bWFwRGF0YS5zb3VyY2VzWzBdLCBsaW5lOmNvZmZlZUxpbmUjLCBjb2x1bW46Y29mZmVlQ29sXG4gICAgICAgICAgICBpZiB2YWxpZCBwb3NzXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtqc0ZpbGUsIHBvc3NbMF0/LmxpbmUsIHBvc3NbMF0/LmNvbHVtbl1cbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyAnc3JjbWFwLnRvSnMgLS0gZW1wdHkgcG9zcyEnXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGNvbnNvbGUubG9nICdzcmNtYXAudG9KcyAtLSBubyBhbGxHZW5lcmF0ZWRQb3NpdGlvbnNGb3IgaW4nLCBjb25zdW1lclxuICAgICAgICBcbiAgICBbanNGaWxlLCBudWxsLCBudWxsXVxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID1cbiAgICB0b0pzOiAgICAgICB0b0pzXG4gICAgdG9Db2ZmZWU6ICAgdG9Db2ZmZWVcbiAgICBlcnJvclN0YWNrOiBlcnJvclN0YWNrXG4gICAgZXJyb3JUcmFjZTogZXJyb3JUcmFjZVxuICAgIGxvZ0VycjogICAgIGxvZ0VyclxuICAgIFxuICAgICJdfQ==
//# sourceURL=../coffee/srcmap.coffee